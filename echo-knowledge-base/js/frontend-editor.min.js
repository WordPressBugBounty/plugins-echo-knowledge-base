jQuery(document).ready((function(e){let t=e("#epkb-fe__editor");if(e("#epkb-modular-main-page-container").length>0||e("#eckb-article-page-container-v2").length>0||e("#eckb-archive-page-container").length>0){if(t.data("display-frontend-editor-closed")){e("#epkb-fe__toggle").show()}else{a(null)}}else{e("#wp-admin-bar-epkb-edit-mode-button").hide()}let n=e("#epkb-fe__error-form-wrap .epkb-admin__error-form__container");e(".epkb-fe__toggle, #wp-admin-bar-epkb-edit-mode-button").on("click",(function(e){a(e)}));function a(n){if(n){n.preventDefault()}t.css("right","0");t.show();e(".epkb-fe__toggle").hide();e("#epkb-fe__editor .epkb-fe__feature-settings").each((function(){const t=e(this);const n=t.attr("data-row-number");if(n==="none"){t.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").addClass("epkb-fe__settings-section--hide")}else{t.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").removeClass("epkb-fe__settings-section--hide")}}))}e(document).on("click",".epkb-fe__header-close-button",(function(){t.hide();e(".epkb-fe__toggle").show();e("#epkb-fe__action-back").trigger("click");if(t.data("display-frontend-editor-closed")){return}e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_closed_fe_editor",_wpnonce_epkb_ajax_action:epkb_vars.nonce}})}));e(document).on("click","#epkb-fe__help-tab",(function(){t.addClass("epkb-fe__editor--help").removeClass("epkb-fe__editor--home");e("#epkb-fe__editor .epkb-fe__actions").show()}));e(document).on("click",".epkb-fe__feature-select-button",(function(){let n=e(this);let a=n.data("feature");let i=e('.epkb-fe__feature-settings[data-feature="'+a+'"]');e(".epkb-fe__header-title").hide();e('.epkb-fe__header-title[data-title="'+a+'"]').addClass("epkb-fe__header-title--active");t.addClass("epkb-fe__editor--settings").removeClass("epkb-fe__editor--home epkb-fe__editor--help");e(".epkb-fe__feature-select-button").hide();e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active");i.addClass("epkb-fe__feature-settings--active");i.find(".epkb-input-custom-dropdown select").each((function(){o(e(this))}));e("#epkb-fe__editor .epkb-fe__actions").show();e(".epkb-fe__top-actions").hide()}));e(document).on("click","#epkb-fe__action-back",(function(){t.removeClass((function(e,t){return(t.match(/\bepkb-fe__editor--\S+/g)||[]).join(" ")}));e(".epkb-fe__header-title").removeClass("epkb-fe__header-title--active");t.addClass("epkb-fe__editor--home");e(".epkb-fe__feature-select-button").show();e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active");e("#epkb-fe__editor .epkb-fe__actions").hide();e(".epkb-fe__top-actions").show()}));e(document).on("click",".epkb-fe__settings-section-header",(function(){let t=e(this).parent();let n=t.find(".epkb-fe__settings-section-body");if(t.hasClass("epkb-fe__is_opened")){n.stop().slideUp();t.removeClass("epkb-fe__is_opened")}else{n.stop().slideDown();t.addClass("epkb-fe__is_opened")}}));function i(t){let n=e(t).val();let a=e(t).closest(".epkb-fe__feature-settings").find(".epkb-fe__settings-section--module-box:not(.epkb-fe__settings-section--"+n+"-box)");a.addClass("epkb-fe__settings-section--hide");let i=e(t).closest(".epkb-fe__features-list").find(".epkb-fe__settings-section--"+n+"-box");if(!i.length){return}e(i.get().reverse()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide");let n=e(this).data("insert-box-after");e(t).closest(".epkb-fe__feature-settings .epkb-fe__settings-list").find(n).after(this)}));if(n==="categories_articles"){e('[name="kb_main_page_layout"]:checked').trigger("click")}}e('[data-settings-group="ml-row"].epkb-row-module-setting select').each((function(){i(this)}));function o(e){const t=e.closest(".epkb-input-custom-dropdown");if(!t.length)return;const n=t.find(".epkb-input-custom-dropdown__options-list");const a=e.val();const i=e.find("option:selected").text();t.find(".epkb-input-custom-dropdown__input span").text(i);n.find(".epkb-input-custom-dropdown__option").removeClass("epkb-input-custom-dropdown__option--selected");n.find('.epkb-input-custom-dropdown__option[data-value="'+a+'"]').addClass("epkb-input-custom-dropdown__option--selected")}let r=false;function s(n,a){if(r){return}const i=e(n.target).closest(".epkb-fe__feature-settings");const o=i.data("feature");const s=i.data("kb-page-type");const _=t.data("post-id");const d=e('.epkb-ml__row[data-feature="'+o+'"]');const f=d.length>0?d.attr("data-position"):"none";if(e(n.target).hasClass("wp-color-picker")&&a&&a.color){e(n.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",a.color.toString());e(n.target).val(a.color.toString())}let k=u();k[o+"_module_position"]=f;let b="";let h=0;if(s==="archive-page"){const t=e("body");const n=t.attr("class");const a=n?n.match(/tax-(epkb_post_type_\d+_[\w]+)/):null;if(a){b=a[1]}const i=n?n.match(/term-(\d+)/):null;if(i){h=parseInt(i[1])}}if(s==="main-page"){I("show","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(s==="article-page"){I("show","",e("#eckb-article-page-container-v2"))}else if(s==="archive-page"){I("show","",e("#eckb-archive-page-container"))}e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_apply_fe_settings",_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:k,kb_page_type:s,feature_name:o,setting_name:e(n.target).attr("name"),prev_link_css_id:e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]').attr("id"),settings_row_number:f?f:"none",taxonomy:b,term_id:h,kb_post_id:_},success:function(n){if(!n.success){try{let t=JSON.parse(n);if(t.message){e("body").append(e(t.message))}}catch(e){}return}r=true;if(s==="main-page"){l(n);if(n.data.layout_settings_html&&n.data.layout_settings_html.length>0){let t=e('.epkb-fe__feature-settings[data-feature="'+o+'"] .epkb-fe__settings-list');t.html(n.data.layout_settings_html);if(parseInt(f)===1){let n=t.find(".epkb-fe__settings-section--"+o+"-box");if(n.length>0){e(n.get()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide")}))}}else{let a=e('<div id="epkb-fe__layout-change-settings" style="display: none !important;">'+n.data.layout_settings_html_temp+"</div>");let i=a.find(".epkb-fe__settings-section--"+o+"-box");if(i.length>0){e(i.get().reverse()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide");let n=e(this).data("insert-box-after");t.find(n).after(this)}))}}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+o+'"] .epkb-fe__settings-list .epkb-input-custom-dropdown select').trigger("change");e('#epkb-fe__editor .epkb-fe__feature-settings .epkb-fe__settings-list input[type="radio"][checked]').prop("checked",true);p(o);e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+o+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click");e('#epkb-fe__editor  .epkb-settings-control__input__toggle[name="'+o+'"]').trigger("click",true)}if(n.data.faqs_design_settings){i.find('[name="faq_preset_name"]').prop("checked",false);for(const[e,t]of Object.entries(n.data.faqs_design_settings)){const n=i.find('[name="'+e+'"]');c(i,n,e,t)}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+o+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click")}if(n.data.categories_articles_design_settings){i.find('[name="categories_articles_preset"]').val("current").trigger("change");for(const[e,a]of Object.entries(n.data.categories_articles_design_settings)){const n=t.find('[name="'+e+'"]');c(t,n,e,a)}e("#epkb-fe__editor .epkb-fe__settings-list .eckb-conditional-setting-input").trigger("click")}if(n.data.inline_styles){e('[id^="epkb-mp-frontend-modular-"][id$="-layout-inline-css"]').html(n.data.inline_styles)}if(n.data.preview_html){let t=e('.epkb-ml__row[data-feature="'+o+'"]');if(t.length>0){t.html(n.data.preview_html)}}setTimeout((function(){e(window).trigger("resize")}),100)}if(s==="article-page"){if(n.data.preview_html){const t=e(n.data.preview_html);const a=t.filter("#eckb-template-update-data");if(a.length){const t=JSON.parse(a.text());const n=e(".eckb-kb-template");if(t.classes){n.removeClass("eckb-article-resets eckb-article-defaults");n.addClass(t.classes)}if(t.style){n.attr("style",t.style)}}e('[id^="eckb-article-page-container"]').parent().html(n.data.preview_html)}if(n.data.inline_styles){let t=e("#epkb-ap-frontend-layout-inline-css");if(t.length){t.html(n.data.inline_styles)}else{e('<style id="epkb-ap-frontend-layout-inline-css">'+n.data.inline_styles+"</style>").appendTo("head")}}setTimeout((function(){e(window).trigger("resize");if(typeof epkb_init_article_toc==="function"){epkb_init_article_toc()}if(o==="article-page-search-box"&&typeof epkb_init_advanced_search==="function"){epkb_init_advanced_search()}}),100)}if(s==="archive-page"){if(n.data.preview_html){e("#eckb-archive-page-container").replaceWith(n.data.preview_html)}if(n.data.inline_styles){let t=e("#epkb-cp-frontend-layout-inline-css");if(t.length){t.html(n.data.inline_styles)}else{e('<style id="epkb-cp-frontend-layout-inline-css">'+n.data.inline_styles+"</style>").appendTo("head")}}setTimeout((function(){e(window).trigger("resize")}),100)}r=false},complete:function(){if(s==="main-page"){I("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(s==="article-page"){I("remove","",e("#eckb-article-page-container-v2"))}else if(s==="archive-page"){I("remove","",e("#eckb-archive-page-container"))}},error:function(t,n,a){let i=D(t,n,a,epkb_vars.fe_update_preview_error);J(i);if(s==="main-page"){I("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(s==="article-page"){I("remove","",e("#eckb-article-page-container-v2"))}else if(s==="archive-page"){I("remove","",e("#eckb-archive-page-container"))}}})}function c(e,t,n,a){if(t.length===0){return}if(t.attr("type")==="radio"){e.find('[name="'+n+'"][value="'+a+'"]').prop("checked",true)}else if(t.hasClass("wp-color-picker")){t.closest(".wp-picker-container").find(".wp-color-result").css("background-color",a);t.val(a)}else{t.val(a)}}function _(n,a){if(r){return}const i=e(n.target).closest(".epkb-fe__feature-settings");const o=i.data("kb-page-type");if(o==="main-page"){I("show","",e("#epkb-modular-main-page-container, #eckb-kb-template"))}else if(o==="article-page"){I("show","",e("#eckb-article-page-container-v2"))}else if(o==="archive-page"){I("show","",e("#eckb-archive-page-container"))}if(e(n.target).hasClass("wp-color-picker")&&a&&a.color){e(n.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",a.color.toString());e(n.target).val(a.color.toString())}const s=u();const c=JSON.stringify(s);const _=e("#epkb-fe__editor .epkb-fe__feature-settings--active").attr("data-feature");const l=new URL(window.location.href);l.searchParams.set("epkb_fe_reopen_feature",_);let p=e('<form method="post" action="'+l+'" style="display: none !important;">'+'<input type="hidden" name="epkb_fe_reload_mode" value="on">'+'<input type="hidden" name="kb_id" value="'+t.data("kbid")+'">'+'<input type="text" name="new_kb_config" value="">'+"</form>");p.find('[name="new_kb_config"]').val(c);e("body").append(p);p.trigger("submit")}function l(t){if(t.data.link_css&&t.data.link_css.length>0){let n=e(t.data.link_css).attr("id");let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');if(n!==a.attr("id")){a.replaceWith(t.data.link_css)}}if(t.data.link_css_rtl&&t.data.link_css_rtl.length>0){let n=e(t.data.link_css_rtl).attr("id");let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');if(n!==a.attr("id")){a.replaceWith(t.data.link_css_rtl)}}if(t.data.elay_link_css&&t.data.elay_link_css.length>0){let n=e(t.data.elay_link_css).attr("id");let a=e('[id^="elay-mp-frontend-modular-"][id$="-layout-css"]');if(a.length>0){if(n!==a.attr("id")){a.replaceWith(t.data.elay_link_css)}}else{a.insertAfter("#elay-public-modular-styles-css")}if(a.length){a.replaceWith(t.data.elay_link_css)}else{let n=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');e(t.data.elay_link_css).insertAfter(n)}}if(t.data.elay_link_css_rtl&&t.data.elay_link_css_rtl.length>0){let n=e(t.data.elay_link_css).attr("id");let a=e('[id^="elay-mp-frontend-modular-"][id$="-layout-rtl-css"]');if(a.length>0){if(n!==a.attr("id")){a.replaceWith(t.data.elay_link_css_rtl)}}else{a.insertAfter("#elay-public-modular-styles-rtl-css")}if(a.length){a.replaceWith(t.data.elay_link_css_rtl)}else{let n=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');e(t.data.elay_link_css_rtl).insertAfter(n)}}}e(document).on("change","#epkb-fe__editor input, #epkb-fe__editor select",(function(t,n){if(n){return}if(r){return}let a=e(this);const i=["search_result_mode","search_box_results_style","article_search_box_results_style","article_search_result_mode","advanced_search_mp_show_top_category","advanced_search_ap_show_top_category","advanced_search_mp_results_list_size","advanced_search_ap_results_list_size","advanced_search_text_highlight_enabled","advanced_search_mp_results_page_size","advanced_search_ap_results_page_size","advanced_search_mp_box_results_style","advanced_search_ap_box_results_style","article_views_counter_method","back_navigation_mode"];if(i.includes(a[0].name)){return}const c={article_content_enable_author:[".eckb-article-content-author-container",".eckb-ach__article-meta__author"],article_content_enable_created_date:[".eckb-article-content-created-date-container",".eckb-ach__article-meta__date-created"],article_content_enable_last_updated_date:[".eckb-article-content-last-updated-date-container",".eckb-ach__article-meta__date-updated"],article_content_enable_article_title:["#eckb-article-content-title-container"],article_content_enable_back_navigation:["#eckb-article-back-navigation-container"],breadcrumb_enable:["#eckb-article-content-breadcrumb-container"],prev_next_navigation_enable:[".epkb-article-navigation-container"],"meta-data-footer-toggle":[".eckb-article-content-footer__article-meta"]};if(c[a[0].name]){const t=a.attr("type")==="checkbox"?a.prop("checked"):a.val()==="on";const n=c[a[0].name];let i=false;if(!t){n.forEach((t=>{e(t).hide()}));return}for(const t in n){const a=e(n[t]);if(a.length>0){i=true}else{i=false;break}}if(t&&i){n.forEach((t=>{e(t).show()}));return}else if(!t&&!i){return}}if(a.attr("name")==="toc_toggler"||a.attr("name")==="toc_left"||a.attr("name")==="toc_right"){r=true;if(a.attr("name")==="toc_toggler"){const t=a.prop("checked");if(t){if(b("left")){e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false)}else if(b("right")){e('#epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",false)}else{e("#epkb-fe__editor #toc_content").val("1").trigger("change");o(e("#epkb-fe__editor #toc_content"));e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false)}}else{e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));e('#epkb-fe__editor input[name="toc_locations"]').prop("checked",false);k()}}else if(a.attr("name")==="toc_locations"&&a.prop("checked")){const t=a.val();let n=false;switch(t){case"toc_left":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));n=b("left");break;case"toc_content":k();e("#epkb-fe__editor #toc_content").val("1").trigger("change");o(e("#epkb-fe__editor #toc_content"));n=true;break;case"toc_right":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));n=b("right");break}if(!n){a.prop("checked",false)}e("#epkb-fe__editor #toc_locations input").each((function(){if(e(this).val()===t&&n){return true}e(this).prop("checked",false)}));h()}else if(a.attr("name")==="toc_left"||a.attr("name")==="toc_right"){const t=a.attr("name")==="toc_left"?"left":"right";const n=parseInt(a.val());if(n>0){const n=t==="left"?"toc_left":"toc_right";e('#epkb-fe__editor input[name="toc_locations"][value="'+n+'"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"]').not('[value="'+n+'"]').prop("checked",false);e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));const a=t==="left"?"right":"left";const i=e("#epkb-fe__editor #toc_"+a);if(parseInt(i.val())>0){i.val("0").trigger("change");o(i)}}h()}r=false}let l=a.closest("[data-custom-unselection-group]").data("custom-unselection-group");let p=a.closest("[data-custom-nonzero-unselection-group]").data("custom-nonzero-unselection-group");if(l||p){r=true;const t=a.attr("name");e('[data-custom-unselection-group="'+l+'"] select').each((function(){if(t!==e(this).attr("name")&&e(this).val()===a.val()){e(this).val("none").trigger("change",true);e(this).closest(".eckb-conditional-setting-input").trigger("click")}}));e('[data-custom-nonzero-unselection-group="'+p+'"] select').each((function(){if(parseInt(a.val())>0&&t!==e(this).attr("name")&&parseInt(e(this).val())>0){e(this).val("0").trigger("change",true);e(this).closest(".eckb-conditional-setting-input").trigger("click")}}));r=false}if(a.attr("name")==="nav_sidebar_right"){const t=e(this).val();if(t==="0"||t===0){e('[name="article_nav_sidebar_type_right"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();return}const n=e('[name="article_nav_sidebar_type_left"]:checked').val();if(n!=="eckb-nav-sidebar-none"){e('[name="article_nav_sidebar_type_left"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();e('[name="article_nav_sidebar_type_right"][value="'+n+'"]').parent().find(".epkb-label").click()}}if(a.attr("name")==="nav_sidebar_left"){const t=e(this).val();if(t==="0"||t===0){e('[name="article_nav_sidebar_type_left"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();return}const n=e('[name="article_nav_sidebar_type_right"]:checked').val();if(n!=="eckb-nav-sidebar-none"){e('[name="article_nav_sidebar_type_right"][value="eckb-nav-sidebar-none"]').parent().find(".epkb-label").click();e('[name="article_nav_sidebar_type_left"][value="'+n+'"]').parent().find(".epkb-label").click()}}if(a.attr("type")==="radio"&&!a.is(":checked")){return}if(a.hasClass("wp-color-picker")){return}if(a.closest(".epkb-row-module-position").length){return}if(a.closest(".epkb-fe__settings-section--module-selection").length>0){return}if(a.closest(".epkb-fe__feature-settings").attr("data-row-number")==="none"){return}if(a.attr("name")==="templates_for_kb"){_(t);return}s(t)}));function p(t){let n=false;e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list .epkb-admin__color-field input').wpColorPicker({change:function(t,a){if(n){return}n=true;let i=e(t.target).wpColorPicker("color");let o=e(t.target).attr("name");e('.epkb-admin__color-field input[name="'+o+'"]').not(t.target).each((function(){e(this).wpColorPicker("color",i)}));n=false}});setTimeout((function(){e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list input.wp-color-picker').iris("option","change",f)}),100)}setTimeout((function(){e("#epkb-fe__editor input.wp-color-picker").iris("option","change",f)}),100);let d=false;function f(e,t){if(d){clearTimeout(d)}d=setTimeout((function(){s(e,t);d}),200)}e(document).on("click","#epkb-fe__action-save",(function(n){let a=u();const i=e("#epkb-fe__editor .epkb-fe__feature-settings--active");const o=i.data("kb-page-type");let r="eckb_save_fe_settings";if(o==="article-page"){r="eckb_save_fe_article_settings"}else if(o==="archive-page"){r="eckb_save_fe_archive_settings"}let s;if(o==="article-page"){s=e("#eckb-article-page-container-v2")}else if(o==="archive-page"){s=e("#eckb-archive-page-container")}else{s=e("#epkb-modular-main-page-container, #eckb-kb-template")}I("show","",s);e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:r,_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:a},success:function(t){if(t.data&&t.data.message){P(t.data.message)}if(t.success){}else{try{let n=JSON.parse(t);if(n.message){e("body").append(e(n.message))}}catch(e){}}I("remove","",s)},error:function(e,t,n){let a=D(e,t,n,epkb_vars.fe_save_settings_error);J(a);I("remove","",s)}})}));function u(){let n={};t.find("input, select").each((function(){if(!e(this).attr("name")||!e(this).attr("name").length||e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag").length||e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag-container").length){return true}if(e(this).attr("type")==="checkbox"){if(e(this).closest(".epkb-admin__checkboxes-multiselect").length){if(e(this).prop("checked")){if(!n[e(this).attr("name")]){n[e(this).attr("name")]=[]}n[e(this).attr("name")].push(e(this).val())}}else{n[e(this).attr("name")]=e(this).prop("checked")?"on":"off"}return true}if(e(this).attr("type")==="radio"){if(e(this).prop("checked")){n[e(this).attr("name")]=e(this).val()}return true}if(typeof e(this).attr("name")=="undefined"){return true}n[e(this).attr("name")]=e(this).val()}));if(e('[name="faq_group_ids"]').length&&typeof n.faq_group_ids=="undefined"){n.faq_group_ids=0}e(".epkb-ml__row").each((function(){const t=e(this);const a=t.attr("data-feature");const i=t.attr("data-position");if(a&&i){n[a+"_module_position"]=i}}));e(".epkb-fe__feature-settings").each((function(){const t=e(this);const a=t.attr("data-feature");const i=t.attr("data-row-number");if(a&&i==="none"){n[a+"_module_position"]="none"}}));return n}function k(){e("#epkb-fe__editor #toc_left, #epkb-fe__editor #toc_right").each((function(){if(parseInt(e(this).val())>0){e(this).val("0").trigger("change");o(e(this))}}))}function b(t){let n=false;const a=e("#epkb-fe__editor #toc_"+t);if(a.length&&parseInt(a.val())===0){r=true;a.val("3").trigger("change");o(a);r=false;n=true}return n}function h(){let t=false;e('#epkb-fe__editor input[name="toc_locations"]').each((function(){if(e(this).prop("checked")){t=true}}));if(parseInt(e("#epkb-fe__editor #toc_left").val())>0||parseInt(e("#epkb-fe__editor #toc_right").val())>0||parseInt(e("#epkb-fe__editor #toc_content").val())>0){t=true}r=true;e("#epkb-fe__editor #toc_toggler input").prop("checked",t);r=false}e(document).on("click",'#epkb-fe__editor input[name="toc_locations"]',(function(){let t=e(this).prop("value");let n=e(this).prop("checked");let a=false;r=true;switch(t){case"toc_left":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));if(n){a=b("left")}break;case"toc_content":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));if(n){e('#epkb-fe__editor input[name="toc_locations"][value="toc_content"]').prop("checked",true);e('#epkb-fe__editor input[name="toc_locations"][value="toc_left"], #epkb-fe__editor input[name="toc_locations"][value="toc_right"]').prop("checked",false);e("#epkb-fe__editor #toc_content").val("1").trigger("change");o(e("#epkb-fe__editor #toc_content"));a=true}break;case"toc_right":k();e("#epkb-fe__editor #toc_content").val("0").trigger("change");o(e("#epkb-fe__editor #toc_content"));if(n){a=b("right")}break;default:break}e('#epkb-fe__editor input[name="toc_locations"]').each((function(){if(e(this).prop("value")===t&&a){return true}e(this).prop("checked",false)}));h();r=false;s({target:this})}));const m=5;const g=e("#epkb-modular-main-page-container");const v=()=>e(".epkb-ml__row");const w=t=>e(`.epkb-ml__row[data-feature="${t}"]`);const y=()=>v().length;function x(){v().sort(((t,n)=>+e(t).attr("data-position")-+e(n).attr("data-position"))).appendTo(g)}function C(){v().each(((t,n)=>{const a=t+1;const i=e(n);const o=i.attr("data-feature");i.attr("data-position",a);if(o){e('.epkb-fe__feature-settings[data-feature="'+o+'"]').attr("data-row-number",a)}}));S()}function S(){v().each(((t,n)=>{const a=e(n);const i=parseInt(a.attr("data-position"));const o=parseInt(a.attr("id").replaceAll("epkb-ml__row-",""));const r=e("#epkb-ml__row-"+i);if(i===o){return}let s=e('[name="ml_row_'+o+'_module"]');let c=e('[name="ml_row_'+o+'_desktop_width"]');let _=e('[name="ml_row_'+o+'_desktop_width_units"]');const l=e('[name="ml_row_'+o+'_desktop_width_units"]:checked').val();let p=e('[name="ml_row_'+i+'_module"]');let d=e('[name="ml_row_'+i+'_desktop_width"]');let f=e('[name="ml_row_'+i+'_desktop_width_units"]');const u=e('[name="ml_row_'+i+'_desktop_width_units"]:checked').val();const k=c.closest(".epkb-fe__feature-settings").find(".epkb-row-module-position.epkb-settings-control-type-toggle .epkb-settings-control__input__toggle").prop("checked")?c.closest(".epkb-fe__feature-settings").attr("data-feature"):"none";const b=d.closest(".epkb-fe__feature-settings").find(".epkb-row-module-position.epkb-settings-control-type-toggle .epkb-settings-control__input__toggle").prop("checked")?d.closest(".epkb-fe__feature-settings").attr("data-feature"):"none";a.attr("id","epkb-ml__row-"+i);r.attr("id","epkb-ml__row-"+o);s.attr("id","ml_row_"+i+"_module").attr("name","ml_row_"+i+"_module");c.attr("id","ml_row_"+i+"_desktop_width").attr("name","ml_row_"+i+"_desktop_width").parent().find("label").attr("for","ml_row_"+i+"_desktop_width").closest("#ml_row_"+o+"_desktop_width").attr("id","ml_row_"+i+"_desktop_width");_.closest("#ml_row_"+o+"_desktop_width_units").attr("id","ml_row_"+i+"_desktop_width_units");_.each((function(){let t=e(this).attr("id");t=t.replaceAll("ml_row_"+o,"ml_row_"+i);e(this).attr("id",t).attr("name","ml_row_"+i+"_desktop_width_units").parent().find("label").attr("for",t)}));p.attr("id","ml_row_"+o+"_module").attr("name","ml_row_"+o+"_module");d.attr("id","ml_row_"+o+"_desktop_width").attr("name","ml_row_"+o+"_desktop_width").parent().find("label").attr("for","ml_row_"+o+"_desktop_width").closest("#ml_row_"+i+"_desktop_width").attr("id","ml_row_"+o+"_desktop_width");f.closest("#ml_row_"+i+"_desktop_width_units").attr("id","ml_row_"+o+"_desktop_width_units");f.each((function(){let t=e(this).attr("id");t=t.replaceAll("ml_row_"+i,"ml_row_"+o);e(this).attr("id",t).attr("name","ml_row_"+o+"_desktop_width_units").parent().find("label").attr("for",t)}));_.each((function(){if(e(this).val()===l){e(this).prop("checked",true)}}));f.each((function(){if(e(this).val()===u){e(this).prop("checked",true)}}));let h=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-inline-css"]');let m=h.html();m=m.replaceAll("#epkb-ml__row-"+i,"#epkb-ml__row-temp").replaceAll("#epkb-ml__row-"+o,"#epkb-ml__row-"+i).replaceAll("#epkb-ml__row-temp","#epkb-ml__row-"+o);h.html(m)}))}function T(t,n){if(y()>=m||w(n).length)return;const a="epkb-ml__row-"+e(t).closest("#epkb-fe__editor .epkb-fe__feature-settings--active").find('[id^="ml_row_"][id$="_desktop_width"]').attr("id").replaceAll("ml_row_","").replaceAll("_desktop_width","");e("<div>",{id:a,class:"epkb-ml__row","data-position":0,"data-feature":n}).prependTo(g);C();x();const i=w(n).attr("data-position");e('.epkb-fe__feature-settings[data-feature="'+n+'"]').attr("data-row-number",i);const o=e('.epkb-fe__feature-settings[data-feature="'+n+'"]');const r={target:o.find("input, select").first()[0],preventDefault:function(){}};if(r.target){s(r)}$()}function j(e){w(e).remove();C();x();$()}function $(){const t=y();e("#epkb-fe__editor .epkb-row-module-position .epkb-settings-control__input__toggle").each((function(){const n=e(this);const a=n.attr("name");const i=n.closest(".epkb-fe__settings-section-body");const o=i.find(".epkb-radio-buttons-container");const r=o.find('input[value="move-up"]');const s=o.find('input[value="move-down"]');const c=w(a);const _=c.length>0;const l=e('.epkb-fe__feature-settings[data-feature="'+a+'"]');n.prop("checked",_);if(_){const e=c.attr("data-position");l.attr("data-row-number",e)}else{l.attr("data-row-number","none")}if(!_||t<=1){o.hide()}else{o.show();const e=+c.attr("data-position");r.prop("disabled",e===1);s.prop("disabled",e===t)}if(_){l.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").removeClass("epkb-fe__settings-section--hide")}else{l.find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").addClass("epkb-fe__settings-section--hide")}o.find('input[type="radio"]').prop("checked",false)}))}e(document).on("change","#epkb-fe__editor .epkb-row-module-position .epkb-settings-control__input__toggle",(function(){const e=this.name;if(this.checked){T(this,e)}else{j(e)}}));e(document).on("change",'.epkb-input[value="move-up"], .epkb-input[value="move-down"]',(function(){const t=e(this);const n=t.val()==="move-up"?-1:+1;const a=t.closest(".epkb-row-module-position").data("module");const i=w(a);const o=+i.attr("data-position");const r=o+n;const s=v().filter(((t,n)=>+e(n).attr("data-position")===r));if(!i.length||!s.length)return;i.attr("data-position",r);s.attr("data-position",o);S();x();$()}));C();x();$();const A=[{checkSelector:"#epkb-modular-main-page-container",prefix:"mp",containerSelector:"#epkb-ml__module-categories-articles",searchSelector:"#epkb-ml__row-1"},{checkSelector:"#eckb-article-page-container-v2",prefix:"ap",containerSelector:"#eckb-article-body",searchSelector:"#eckb-article-header"},{checkSelector:"#eckb-archive-body",prefix:"cp",containerSelector:"#eckb-archive-body",searchSelector:"#eckb-archive-header"}];function O(){const t=e("body").width();let n="";let a=0;let i=0;for(const t of A){if(e(t.checkSelector).length){n=t.prefix;a=Math.round(e(t.containerSelector).width());i=Math.round(e(t.searchSelector).width());break}}if(n){if(i){e(`.js-epkb-${n}-search-width`).text(`${i}px`)}if(a){e(`.js-epkb-${n}-width-container`).text(`${a}px`)}if(t){e(`.js-epkb-${n}-width`).text(`${t}px`)}}}O();e(window).on("resize",(function(){O()}));function I(e,t,n){if(e==="show"){let e='<div class="epkb-fe-dialog-box-loading">'+'<div class="epkb-admin-dbl__header">'+'<div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(t?'<div class="epkb-admin-text">'+t+"</div>":"")+"</div>"+"</div>";n.append(e)}else if(e==="remove"){n.find(".epkb-fe-dialog-box-loading").remove()}}e(document).on("click",".epkb-close-notice",(function(){let t=e(this).closest(".eckb-bottom-notice-message");t.addClass("fadeOutDown");setTimeout((function(){t.html("")}),1e4)}));function z(e,t,n){return'<div class="eckb-bottom-notice-message">'+'<div class="contents">'+'<span class="'+n+'">'+(e?"<h4>"+e+"</h4>":"")+(t?"<p>"+t+"</p>":"")+"</span>"+"</div>"+'<div class="epkb-close-notice epkbfa epkbfa-window-close"></div>'+"</div>"}function P(t,n=""){e(".eckb-bottom-notice-message").remove();e("body").append(z(n,t,"success"))}(function(){const t=new URL(window.location.href);const n=t.searchParams.get("epkb_fe_reopen_feature");if(n&&n.length>0){e(".epkb-fe__toggle").trigger("click");e('#epkb-fe__editor .epkb-fe__feature-select-button[data-feature="'+n+'"]').trigger("click");t.searchParams.delete("epkb_fe_reopen_feature");history.replaceState(null,"",t.pathname+t.search+t.hash)}})();e(document).on("click","#epkb-fe__editor .epkb-fe__open-feature-setting-link",(function(n){n.preventDefault();const a=e(this).attr("data-feature");const i=e(this).attr("data-setting");const o=e(this).attr("data-section");t.find(".epkb-highlighted_setting").removeClass("epkb-highlighted_setting");t.find('.epkb-fe__feature-select-button[data-feature="'+a+'"]').trigger("click");let r=0;let s=false;if(i){s=t.find('.epkb-fe__feature-settings[data-feature="'+a+'"] [name="'+i+'"]').closest(".epkb-input-group")}if(o){s=t.find('.epkb-fe__feature-settings[data-feature="'+a+'"] .epkb-fe__settings-section--'+o)}if(s.length>0){r=s.offset().top-t.offset().top-100;r=r>0?r:0;s.addClass("epkb-highlighted_setting")}t.animate({scrollTop:r},300);return false}));function q(){const e=[document.querySelector(".et_pb_section, .et_pb_row, .et_pb_column")!==null,typeof window.et_pb_custom!=="undefined",document.body.classList.contains("et_divi_theme")||document.body.classList.contains("et_pb_theme"),Array.from(document.querySelectorAll('link[rel="stylesheet"]')).some((e=>e.href.includes("divi")||e.href.includes("et-core"))),document.querySelector('meta[name="generator"][content*="Divi"]')!==null];return e.some((e=>e===true))}e(n).on("click",".epkb-close-notice, .epkb-admin__error-form__btn-cancel",(function(){e(n).css("display","none").parent().css("display","none")}));e(n).find("#epkb-admin__error-form").on("submit",(function(t){t.preventDefault();let a=e(this);e.ajax({type:"POST",dataType:"json",url:epkb_vars.ajaxurl,data:a.serialize(),beforeSend:function(t){a.find(".epkb-admin__error-form__btn-wrap, input, label, textarea").slideUp("fast");e(n).find(".epkb-admin__error-form__response").addClass("epkb-admin__error-form__response--active");e(n).find(".epkb-admin__error-form__response").html(epkb_vars.fe_sending_error_report)}}).done((function(t){if(typeof t.success!=="undefined"&&t.success===false){e(n).find(".epkb-admin__error-form__response").html(t.data)}else if(typeof t.success!=="undefined"&&t.success===true){e(n).find(".epkb-admin__error-form__response").html(t.data)}else{e(n).find(".epkb-admin__error-form__response").html(epkb_vars.fe_send_report_error)}})).fail((function(t,a,i){let o=D(t,a,i,epkb_vars.fe_send_report_error);e(n).find(".epkb-admin__error-form__response").html(o)})).always((function(){e(n).find("input, textarea").prop("disabled",false)}))}));function D(e,t,n,a){let i=a||"An error occurred";if(t){i+="\n\n"+(epkb_vars.error_details||"Error Details")+": "+t}if(n){i+="\n"+n}if(e.responseJSON&&e.responseJSON.message){i+="\n\n"+(epkb_vars.server_response||"Server Response")+": "+e.responseJSON.message}else if(e.responseText){try{const t=JSON.parse(e.responseText);if(t.message){i+="\n\n"+(epkb_vars.server_response||"Server Response")+": "+t.message}}catch(t){if(e.responseText.length>0){i+="\n\n"+(epkb_vars.server_response||"Server Response")+": "+e.responseText.substring(0,200)}}}return i}function J(t){let a=t?t:"";e(n).find(".epkb-admin__error-form__title").text(epkb_vars.fe_report_error_title);e(n).find(".epkb-admin__error-form__desc").text(epkb_vars.fe_report_error_desc);e(n).find("#epkb-admin__error-form__message").val(a);e(n).css("display","block").parent().css("display","block")}}));