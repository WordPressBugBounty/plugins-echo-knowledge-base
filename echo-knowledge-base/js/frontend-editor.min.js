jQuery(document).ready((function(e){let t=e("#epkb-fe__editor");e("#epkb-modular-main-page-container").length>0||e("#eckb-article-page-container-v2").length>0||e("#eckb-archive-page-container").length>0?e("#epkb-fe__toggle").show():e("#wp-admin-bar-epkb-edit-mode-button").hide();let a=e("#epkb-fe__error-form-wrap .epkb-admin__error-form__container");function i(t){let a=e(t).val();e(t).closest(".epkb-fe__feature-settings").find(".epkb-fe__settings-section--module-box:not(.epkb-fe__settings-section--"+a+"-box)").addClass("epkb-fe__settings-section--hide");let i=e(t).closest(".epkb-fe__features-list").find(".epkb-fe__settings-section--"+a+"-box");i.length&&(e(i.get().reverse()).each((function(){e(this).removeClass("epkb-fe__settings-section--hide");let a=e(this).data("insert-box-after");e(t).closest(".epkb-fe__feature-settings .epkb-fe__settings-list").find(a).after(this)})),"categories_articles"===a&&e('[name="kb_main_page_layout"]:checked').trigger("click"))}e(".epkb-fe__toggle, #wp-admin-bar-epkb-edit-mode-button").on("click",(function(a){a.preventDefault(),t.css("right","0"),t.show(),e(".epkb-fe__toggle").hide(),e("#epkb-fe__editor .epkb-fe__feature-settings").each((function(){"none"===e(this).find(".epkb-row-module-position select").val()&&e(this).find(".epkb-fe__settings-section:not(.epkb-fe__settings-section--module-position)").addClass("epkb-fe__settings-section--hide")}))})),e(document).on("click",".epkb-fe__header-close-button",(function(){t.hide(),e(".epkb-fe__toggle").show(),e("#epkb-fe__action-back").trigger("click")})),e(document).on("click","#epkb-fe__help-tab",(function(){t.addClass("epkb-fe__editor--help").removeClass("epkb-fe__editor--home"),e("#epkb-fe__editor .epkb-fe__actions").show()})),e(document).on("click",".epkb-fe__feature-select-button",(function(){let a=e(this).data("feature"),i=e('.epkb-fe__feature-settings[data-feature="'+a+'"]');e(".epkb-fe__header-title").hide(),e('.epkb-fe__header-title[data-title="'+a+'"]').addClass("epkb-fe__header-title--active"),t.removeClass((function(e,t){return(t.match(/\bepkb-fe__editor--\S+/g)||[]).join(" ")})),t.addClass("epkb-fe__editor--settings"),e(".epkb-fe__feature-select-button").hide(),e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active"),i.addClass("epkb-fe__feature-settings--active"),i.find(".epkb-input-custom-dropdown select").each((function(){!function(e){const t=e.closest(".epkb-input-custom-dropdown");if(!t.length)return;const a=t.find(".epkb-input-custom-dropdown__options-list"),i=e.val(),n=e.find("option:selected").text();t.find(".epkb-input-custom-dropdown__input span").text(n),a.find(".epkb-input-custom-dropdown__option").removeClass("epkb-input-custom-dropdown__option--selected"),a.find('.epkb-input-custom-dropdown__option[data-value="'+i+'"]').addClass("epkb-input-custom-dropdown__option--selected")}(e(this))})),e("#epkb-fe__editor .epkb-fe__actions").show(),e(".epkb-fe__top-actions").hide()})),e(document).on("click","#epkb-fe__action-back",(function(){t.removeClass((function(e,t){return(t.match(/\bepkb-fe__editor--\S+/g)||[]).join(" ")})),e(".epkb-fe__header-title").removeClass("epkb-fe__header-title--active"),t.addClass("epkb-fe__editor--home"),e(".epkb-fe__feature-select-button").show(),e(".epkb-fe__feature-settings").removeClass("epkb-fe__feature-settings--active"),e("#epkb-fe__editor .epkb-fe__actions").hide(),e(".epkb-fe__top-actions").show()})),e(document).on("click",".epkb-fe__settings-section-header",(function(){let t=e(this).parent(),a=t.find(".epkb-fe__settings-section-body");t.hasClass("epkb-fe__is_opened")?(a.stop().slideUp(),t.removeClass("epkb-fe__is_opened")):(a.stop().slideDown(),t.addClass("epkb-fe__is_opened"))})),e('[data-settings-group="ml-row"].epkb-row-module-setting select').each((function(){i(this)}));let n=!1;function s(a,s){if(n)return;const r=e(a.target).closest(".epkb-fe__feature-settings"),p=r.data("feature"),l=r.data("kb-page-type"),d=r.find('.epkb-fe__settings-list [id^="ml_row_"][id$="_desktop_width"]'),f=d.length>0?d.attr("id").replaceAll("ml_row_","").replaceAll("_desktop_width",""):"none";e(a.target).hasClass("wp-color-picker")&&s&&s.color&&(e(a.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",s.color.toString()),e(a.target).val(s.color.toString()));let k=_();k[p+"_module_position"]=f,h("show","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container")),e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_apply_fe_settings",_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:k,kb_page_type:l,feature_name:p,setting_name:e(a.target).attr("name"),prev_link_css_id:e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]').attr("id"),settings_row_number:f||"none"},success:function(a){if(a.success){if(n=!0,"main-page"===l){if(function(t){if(t.data.link_css&&t.data.link_css.length>0){let a=e(t.data.link_css).attr("id"),i=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');a!==i.attr("id")&&i.replaceWith(t.data.link_css)}if(t.data.link_css_rtl&&t.data.link_css_rtl.length>0){let a=e(t.data.link_css_rtl).attr("id"),i=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');a!==i.attr("id")&&i.replaceWith(t.data.link_css_rtl)}if(t.data.elay_link_css&&t.data.elay_link_css.length>0){let a=e(t.data.elay_link_css).attr("id"),i=e('[id^="elay-mp-frontend-modular-"][id$="-layout-css"]');if(i.length>0?a!==i.attr("id")&&i.replaceWith(t.data.elay_link_css):i.insertAfter("#elay-public-modular-styles-css"),i.length)i.replaceWith(t.data.elay_link_css);else{let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-css"]');e(t.data.elay_link_css).insertAfter(a)}}if(t.data.elay_link_css_rtl&&t.data.elay_link_css_rtl.length>0){let a=e(t.data.elay_link_css).attr("id"),i=e('[id^="elay-mp-frontend-modular-"][id$="-layout-rtl-css"]');if(i.length>0?a!==i.attr("id")&&i.replaceWith(t.data.elay_link_css_rtl):i.insertAfter("#elay-public-modular-styles-rtl-css"),i.length)i.replaceWith(t.data.elay_link_css_rtl);else{let a=e('[id^="epkb-mp-frontend-modular-"][id$="-layout-rtl-css"]');e(t.data.elay_link_css_rtl).insertAfter(a)}}}(a),a.data.layout_settings_html&&a.data.layout_settings_html.length>0){let t=e('<div id="epkb-fe__layout-change-settings" style="display: none !important;">'+a.data.layout_settings_html_temp+"</div>");e('.epkb-fe__feature-settings[data-feature="'+p+'"]').prepend(t),e('.epkb-fe__feature-settings[data-feature="'+p+'"] .epkb-fe__settings-list').html(a.data.layout_settings_html),i('.epkb-fe__feature-settings[data-feature="'+p+'"] .epkb-fe__settings-list [data-settings-group="ml-row"].epkb-row-module-setting select'),e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+p+'"] .epkb-fe__settings-list .epkb-input-custom-dropdown select').trigger("change"),e('#epkb-fe__editor .epkb-fe__feature-settings .epkb-fe__settings-list input[type="radio"][checked]').prop("checked",!0),function(t){let a=!1;e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list .epkb-admin__color-field input').wpColorPicker({change:function(t,i){if(a)return;a=!0;let n=e(t.target).wpColorPicker("color"),s=e(t.target).attr("name");e('.epkb-admin__color-field input[name="'+s+'"]').not(t.target).each((function(){e(this).wpColorPicker("color",n)})),a=!1}}),setTimeout((function(){e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+t+'"] .epkb-fe__settings-list input.wp-color-picker').iris("option","change",c)}),100)}(p),e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+p+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click")}if(a.data.faqs_design_settings){r.find('[name="faq_preset_name"]').prop("checked",!1);for(const[e,t]of Object.entries(a.data.faqs_design_settings)){const a=r.find('[name="'+e+'"]');o(r,a,e,t)}e('#epkb-fe__editor .epkb-fe__feature-settings[data-feature="'+p+'"] .epkb-fe__settings-list .eckb-conditional-setting-input').trigger("click")}if(a.data.categories_articles_design_settings){r.find('[name="categories_articles_preset"]').val("current").trigger("change");for(const[e,i]of Object.entries(a.data.categories_articles_design_settings)){const a=t.find('[name="'+e+'"]');o(t,a,e,i)}e("#epkb-fe__editor .epkb-fe__settings-list .eckb-conditional-setting-input").trigger("click")}if(a.data.inline_styles&&e('[id^="epkb-mp-frontend-modular-"][id$="-layout-inline-css"]').html(a.data.inline_styles),a.data.preview_html){const t=r.attr("data-row-number");let i=e("#epkb-ml__row-"+f);if(0===i.length){i=e('<div id="epkb-ml__row-'+f+'" class="epkb-ml__row" data-position="'+t+'" data-feature="'+p+'"></div>');let a=e('.epkb-ml__row[data-position="0"]');for(let n=t-1;n>0;n--)if(a=e('.epkb-ml__row[data-position="'+n+'"]'),a.length>0){i.insertAfter(a);break}0===a.length&&e("#epkb-modular-main-page-container").prepend(i)}i.html(a.data.preview_html)}setTimeout((function(){e(window).trigger("resize")}),100)}n=!1}else try{let t=JSON.parse(a);t.message&&e("body").append(e(t.message))}catch(e){}},complete:function(){h("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container"))},error:function(){v(epkb_vars.fe_update_preview_error),h("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container"))}})}function o(e,t,a,i){0!==t.length&&("radio"===t.attr("type")?e.find('[name="'+a+'"][value="'+i+'"]').prop("checked",!0):t.hasClass("wp-color-picker")?(t.closest(".wp-picker-container").find(".wp-color-result").css("background-color",i),t.val(i)):t.val(i))}e(document).on("change","#epkb-fe__editor input, #epkb-fe__editor select",(function(a){if(n)return;let i=e(this);["search_result_mode","search_box_results_style","article_search_box_results_style","article_search_result_mode","advanced_search_mp_show_top_category","advanced_search_ap_show_top_category","advanced_search_mp_results_list_size","advanced_search_ap_results_list_size","advanced_search_text_highlight_enabled","advanced_search_mp_results_page_size","advanced_search_ap_results_page_size","advanced_search_mp_box_results_style","advanced_search_ap_box_results_style"].includes(i[0].name)||("radio"!==i.attr("type")||i.is(":checked"))&&(i.hasClass("wp-color-picker")||i.closest(".epkb-row-module-position").length||i.closest(".epkb-fe__settings-section--module-selection").length>0||"none"!==i.closest(".epkb-fe__feature-settings").attr("data-row-number")&&("templates_for_kb"!==i.attr("name")?s(a):function(a,i){if(n)return;h("show","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container")),e(a.target).hasClass("wp-color-picker")&&i&&i.color&&(e(a.target).closest(".wp-picker-container").find(".wp-color-result").css("background-color",i.color.toString()),e(a.target).val(i.color.toString()));const s=_(),o=JSON.stringify(s),r=e("#epkb-fe__editor .epkb-fe__feature-settings--active").attr("data-feature"),c=new URL(window.location.href);c.searchParams.set("epkb_fe_reopen_feature",r);let p=e('<form method="post" action="'+c+'" style="display: none !important;"><input type="hidden" name="epkb_fe_reload_mode" value="on"><input type="hidden" name="kb_id" value="'+t.data("kbid")+'"><input type="text" name="new_kb_config" value=""></form>');p.find('[name="new_kb_config"]').val(o),e("body").append(p),p.trigger("submit")}(a)))})),setTimeout((function(){e("#epkb-fe__editor input.wp-color-picker").iris("option","change",c)}),100);let r=!1;function c(e,t){r&&clearTimeout(r),r=setTimeout((function(){s(e,t)}),200)}function _(){let a={};return t.find("input, select").each((function(){return!(e(this).attr("name")&&e(this).attr("name").length&&!e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag").length&&!e(this).closest(".epkb-input-group").find(".epkb__option-pro-tag-container").length)||("checkbox"===e(this).attr("type")?(e(this).closest(".epkb-admin__checkboxes-multiselect").length?e(this).prop("checked")&&(a[e(this).attr("name")]||(a[e(this).attr("name")]=[]),a[e(this).attr("name")].push(e(this).val())):a[e(this).attr("name")]=e(this).prop("checked")?"on":"off",!0):"radio"===e(this).attr("type")?(e(this).prop("checked")&&(a[e(this).attr("name")]=e(this).val()),!0):void 0===e(this).attr("name")||void(a[e(this).attr("name")]=e(this).val()))})),e('[name="faq_group_ids"]').length&&void 0===a.faq_group_ids&&(a.faq_group_ids=0),a}e(document).on("click","#epkb-fe__action-save",(function(a){let i=_();h("show","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container")),e.ajax({url:epkb_vars.ajaxurl,method:"POST",data:{action:"eckb_save_fe_settings",_wpnonce_epkb_ajax_action:epkb_vars.nonce,kb_id:t.data("kbid"),new_kb_config:i},success:function(t){if(t.data&&t.data.message&&function(t,a=""){e(".eckb-bottom-notice-message").remove(),e("body").append(function(e,t,a){return'<div class="eckb-bottom-notice-message"><div class="contents"><span class="'+a+'">'+(e?"<h4>"+e+"</h4>":"")+(t?"<p>"+t+"</p>":"")+'</span></div><div class="epkb-close-notice epkbfa epkbfa-window-close"></div></div>'}(a,t,"success"))}(t.data.message),t.success);else try{let a=JSON.parse(t);a.message&&e("body").append(e(a.message))}catch(e){}h("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container"))},error:function(){v(epkb_vars.fe_save_settings_error),h("remove","",e("#epkb-modular-main-page-container, #eckb-kb-template, #eckb-archive-page-container"))}})}));const p=e("#epkb-modular-main-page-container"),l=()=>e(".epkb-ml__row"),d=t=>e(`.epkb-ml__row[data-feature="${t}"]`),f=()=>l().length;function k(){l().sort(((t,a)=>+e(t).attr("data-position")-+e(a).attr("data-position"))).appendTo(p)}function b(){l().each(((t,a)=>{const i=t+1;e(a).attr("data-position",i).attr("id",`epkb-ml__row-${i}`)}))}function u(){const t=f();e(".epkb-settings-control__input__toggle").each((function(){const a=e(this),i=a.attr("name"),n=a.closest(".epkb-fe__settings-section-body").find(".epkb-radio-buttons-container"),s=n.find('input[value="move-up"]'),o=n.find('input[value="move-down"]'),r=d(i),c=r.length>0;if(a.prop("checked",c),!c||t<=1)n.hide();else{n.show();const e=+r.attr("data-position");s.prop("disabled",1===e),o.prop("disabled",e===t)}n.find('input[type="radio"]').prop("checked",!1)}))}e(document).on("change",".epkb-settings-control__input__toggle",(function(){const t=this.name;this.checked?function(t,a){if(f()>=5||d(a).length)return;let i=1;for(;0===d(a).length&&e(`.epkb-ml__row[data-position="${i}"]`).length;)i++;e("<div>",{id:`epkb-ml__row-${i}`,class:"epkb-ml__row","data-position":i,"data-feature":a}).appendTo(p),$settingsSection=e(t).closest(".epkb-fe__settings-section-body"),$settingsSection.target=e(t).closest(".epkb-fe__settings-section-body"),$settingsSection.attr("name",a),s($settingsSection)}(this,t):function(e){d(e).remove(),b(),k()}(t),u()})),e(document).on("change",'.epkb-input[value="move-up"], .epkb-input[value="move-down"]',(function(){const t=e(this),a="move-up"===t.val()?-1:1,i=t.closest(".epkb-row-module-position").data("module"),n=d(i),s=+n.attr("data-position"),o=s+a,r=l().filter(((t,a)=>+e(a).attr("data-position")===o));n.length&&r.length&&(n.attr("data-position",o),r.attr("data-position",s),k(),u())})),b(),k(),u();const g=[{checkSelector:"#epkb-modular-main-page-container",prefix:"mp",containerSelector:"#epkb-ml__module-categories-articles",searchSelector:"#epkb-ml__row-1"},{checkSelector:"#eckb-article-page-container-v2",prefix:"ap",containerSelector:"#eckb-article-body",searchSelector:"#eckb-article-header"},{checkSelector:"#eckb-archive-body",prefix:"cp",containerSelector:"#eckb-archive-body",searchSelector:"#eckb-archive-header"}];function m(){const t=e("body").width();let a="",i=0,n=0;for(const t of g)if(e(t.checkSelector).length){a=t.prefix,i=Math.round(e(t.containerSelector).width()),n=Math.round(e(t.searchSelector).width());break}a&&(n&&e(`.js-epkb-${a}-search-width`).text(`${n}px`),i&&e(`.js-epkb-${a}-width-container`).text(`${i}px`),t&&e(`.js-epkb-${a}-width`).text(`${t}px`))}function h(e,t,a){if("show"===e){let e='<div class="epkb-admin-dialog-box-loading"><div class="epkb-admin-dbl__header"><div class="epkb-admin-dbl-icon epkbfa epkbfa-hourglass-half"></div>'+(t?'<div class="epkb-admin-text">'+t+"</div>":"")+"</div></div>";a.append(e)}else"remove"===e&&a.find(".epkb-admin-dialog-box-loading").remove()}function v(t){let i=t||"";e(a).find(".epkb-admin__error-form__title").text(epkb_vars.fe_report_error_title),e(a).find(".epkb-admin__error-form__desc").text(epkb_vars.fe_report_error_desc),e(a).find("#epkb-admin__error-form__message").val(i),e(a).css("display","block").parent().css("display","block")}m(),e(window).on("resize",(function(){m()})),e(document).on("click",".epkb-close-notice",(function(){let t=e(this).closest(".eckb-bottom-notice-message");t.addClass("fadeOutDown"),setTimeout((function(){t.html("")}),1e4)})),function(){const t=new URL(window.location.href),a=t.searchParams.get("epkb_fe_reopen_feature");a&&a.length>0&&(e(".epkb-fe__toggle").trigger("click"),e('#epkb-fe__editor .epkb-fe__feature-select-button[data-feature="'+a+'"]').trigger("click"),t.searchParams.delete("epkb_fe_reopen_feature"),history.replaceState(null,"",t.pathname+t.search+t.hash))}(),e(document).on("click","#epkb-fe__editor .epkb-fe__open-feature-setting-link",(function(a){a.preventDefault();const i=e(this).attr("data-feature"),n=e(this).attr("data-setting"),s=e(this).attr("data-section");t.find(".epkb-highlighted_setting").removeClass("epkb-highlighted_setting"),t.find('.epkb-fe__feature-select-button[data-feature="'+i+'"]').trigger("click");let o=0,r=!1;return n&&(r=t.find('.epkb-fe__feature-settings[data-feature="'+i+'"] [name="'+n+'"]').closest(".epkb-input-group")),s&&(r=t.find('.epkb-fe__feature-settings[data-feature="'+i+'"] .epkb-fe__settings-section--'+s)),r.length>0&&(o=r.offset().top-t.offset().top-100,o=o>0?o:0,r.addClass("epkb-highlighted_setting")),t.animate({scrollTop:o},300),!1})),e(a).on("click",".epkb-close-notice, .epkb-admin__error-form__btn-cancel",(function(){e(a).css("display","none").parent().css("display","none")})),e(a).find("#epkb-admin__error-form").on("submit",(function(t){t.preventDefault();let i=e(this);e.ajax({type:"POST",dataType:"json",url:epkb_vars.ajaxurl,data:i.serialize(),beforeSend:function(t){i.find(".epkb-admin__error-form__btn-wrap, input, label, textarea").slideUp("fast"),e(a).find(".epkb-admin__error-form__response").addClass("epkb-admin__error-form__response--active"),e(a).find(".epkb-admin__error-form__response").html(epkb_vars.fe_sending_error_report)}}).done((function(t){void 0!==t.success&&!1===t.success||void 0!==t.success&&!0===t.success?e(a).find(".epkb-admin__error-form__response").html(t.data):e(a).find(".epkb-admin__error-form__response").html(epkb_vars.fe_send_report_error)})).fail((function(t,i,n){e(a).find(".epkb-admin__error-form__response").html(epkb_vars.fe_send_report_error)})).always((function(){e(a).find("input, textarea").prop("disabled",!1)}))}))}));