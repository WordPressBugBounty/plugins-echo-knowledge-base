jQuery(document).ready((function(e){let t={kb_id:1,step:1,selected_array:[],$wrap:[],post_type:"post",convert_terms_mode:"copy_terms",selected_count:0,category_taxonomy:"",tags_taxonomy:""};e(".epkb-convert-button-back").on("click",(function(){if(t.step<2){e(document).epkb("tools/hide_panels")}else if(t.step<5){n("prev")}else{n()}}));e(".epkb-convert-button-next").on("click",(function(){if(t.step==1){t={kb_id:e(this).data("kb_id"),step:1,selected_array:[],$wrap:e(this).closest(".epkb-form-wrap"),post_type:e(this).closest(".epkb-form-wrap").find("[name=epkb_convert_post_type]").val(),convert_terms_mode:"copy_terms",selected_count:0,category_taxonomy:"",tags_taxonomy:""}}if(!r()){return false}n("next")}));e(".epkb-convert-button-start_convert").on("click",(function(){if(!r()){return false}n("next")}));e(".epkb-convert-button-cancel").on("click",(function(){e(this).addClass("epkb-hidden");n()}));e(".epkb-convert-button-exit").on("click",(function(){n();e(document).epkb("tools/hide_panels")}));e(document).on("change keyup",".epkb-convert-form--posts .epkb-convert-categories-select select, .epkb-convert-form--posts .epkb-convert-categories-filters--name-filter input",(function(){e("[name=row_id]").prop("checked",false);e("#check_all_convert").prop("checked",false);t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row").each((function(){let r=true;let n=e(this);t.$wrap.find(".epkb-convert-categories-select select").each((function(){if(e(this).val()==""){return true}let t=e(this).data("taxonomy-name");if(n.find("[data-kb-import-tax="+t+"]").length==0){r=false;return false}if(n.find("[data-kb-import-tax="+t+"]").find("[data-kb-import-cat-id="+e(this).val()+"]").length==0){r=false;return false}}));let o=t.$wrap.find(".epkb-convert-categories-filters--name-filter input").val().toLowerCase();if(o&&n.find(".title").text().toLowerCase().indexOf(o)==-1){r=false}if(r){e(this).removeClass("hidden")}else{e(this).addClass("hidden")}}))}));e(".epkb-convert-form--posts").on("change","#check_all_convert",(function(){if(!e(this).prop("checked")){t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row [name=row_id]").prop("checked",false);return}t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row").each((function(){if(!t.current_category||e(this).find("[data-kb-import-cat-id="+t.current_category+"]").length){e(this).find("[name=row_id]").prop("checked","checked")}else{e(this).find("[name=row_id]").prop("checked",false)}}))}));function r(){if(t.$wrap.length==0){e(document).epkb("notice/show",{message:epkb_vars.reload_try_again,type:"error"});return false}if(t.step==1){if(t.$wrap.find("[name=epkb_convert_post]")&&t.$wrap.find("[name=epkb_convert_post]").first().prop("checked")==false){e(document).epkb("notice/show",{message:epkb_vars.msg_confirm_kb,type:"error"});return false}if(t.$wrap.find("[name=epkb_convert_backup]")&&t.$wrap.find("[name=epkb_convert_backup]").first().prop("checked")==false){e(document).epkb("notice/show",{message:epkb_vars.msg_confirm_backup,type:"error"});return false}if(t.$wrap.find("[name=epkb_convert_post_type]")&&!t.$wrap.find("[name=epkb_convert_post_type]").val()){e(document).epkb("notice/show",{message:epkb_vars.msg_empty_post_type,type:"error"});return false}return true}if(t.step==2){if(t.$wrap.find("[name=row_id]").length==0){e(document).epkb("notice/show",{message:epkb_vars.msg_nothing_to_convert,type:"error"});return false}if(t.$wrap.find("[name=row_id]:checked").length==0){e(document).epkb("notice/show",{message:epkb_vars.msg_select_article,type:"error"});return false}return true}if(t.step==3){return true}e(document).epkb("notice/show",{message:epkb_vars.reload_try_again,type:"error"});return false}function n(e=1){if(e=="next"){t.step++}else if(e=="prev"){t.step--}else{t.step=e}let r=1;while(r<5){if(t.step>=r){t.$wrap.find(".epkb-import-step--"+r).addClass("epkb-import-step--done")}else{t.$wrap.find(".epkb-import-step--"+r).removeClass("epkb-import-step--done")}r++}t.$wrap.find(".epkb-import-step").addClass("epkb-hidden");t.$wrap.find(".epkb-import-step--"+t.step).removeClass("epkb-hidden");if(t.step==1){t.$wrap.find(".epkb-convert-button-back").removeClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden");t.$wrap.find(".convert-kb-name-checkbox").prop("checked",false)}if(t.step==2){t.$wrap.find(".epkb-convert-button-back").removeClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden");o()}if(t.step>1){t.$wrap.find(".epkb-convert-button-start").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden")}if(t.step==3){t.$wrap.find(".epkb-convert-button-next").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-start_convert").removeClass("epkb-hidden")}if(t.step==4){a()}if(t.step<4){t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden")}}function o(){let r=t.$wrap.find(".epkb-import-step--2 .epkb-progress");t.$wrap.find(".epkb-dsl__article-list-container, .epkb-convert-categories-filters").remove();r.epkb("progress/clear_log");r.epkb("progress/set",0);let o={_wpnonce_epkb_ajax_action:epkb_vars.nonce,action:"epkb_load_articles_list",kb_id:t.kb_id,epkb_convert_step:t.step,post_type:t.post_type,categories:[]};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl}).done((function(o){if(typeof o.success=="object"){for(let e in o.success){r.epkb("progress/add_log",{message:o.success[e],type:"success"})}r.epkb("progress/set",100)}if(typeof o.response_html_1!="undefined"){t.$wrap.find(".epkb-import-step.epkb-import-step--2").append(o.response_html_1)}if(typeof o.response_html_2!="undefined"){t.$wrap.find(".epkb-import-step.epkb-import-step--3").html(o.response_html_2)}if(typeof o.error!="undefined"){e(document).epkb("ajax/error_message",o.message);n();return false}})).fail((function(t,r,o){e(document).epkb("ajax/error_message",epkb_vars.msg_admin_error_l012);n()}))}function a(){let r=t.$wrap.find(".epkb-import-step--4 .epkb-progress");t.selected_array=[];t.$wrap.find("input[name=row_id]:checked").each((function(){t.selected_array.push(e(this).val())}));t.selected_count=t.selected_array.length;if(t.$wrap.find('input[name="convert_terms_mode"]:checked').length){t.convert_terms_mode=t.$wrap.find('input[name="convert_terms_mode"]:checked').val()}if(t.$wrap.find("[name=categories_taxonomy]").length){t.category_taxonomy=t.$wrap.find("[name=categories_taxonomy]").val()}if(t.$wrap.find("[name=tags_taxonomy]").length){t.tags_taxonomy=t.$wrap.find("[name=tags_taxonomy]").val()}t.$wrap.find(".epkb-convert-button-next").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-back").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-cancel").removeClass("epkb-hidden");t.$wrap.find(".epkb-form-field-non_attachments-message").html("");r.epkb("progress/clear_log");r.epkb("progress/set",0);r.epkb("progress/add_log",{message:epkb_vars.msg_converting});s()}function s(){let r=t.$wrap.find(".epkb-import-step--4 .epkb-progress");let o=parseInt(100*(t.selected_count-t.selected_array.length)/t.selected_count);r.epkb("progress/set",o);let a=t.selected_array.splice(0,5);let p={action:"epkb_convert_kb_content",_wpnonce_epkb_ajax_action:epkb_vars.nonce,epkb_kb_id:t.kb_id,epkb_convert_post_type:t.post_type,selected_rows:JSON.stringify(a),convert_terms_mode:t.convert_terms_mode,epkb_convert_step:t.step,category_taxonomy:t.category_taxonomy,tags_taxonomy:t.tags_taxonomy};e.ajax({type:"POST",dataType:"json",data:p,url:ajaxurl}).done((function(o){if(t.step<4){return false}if(typeof o.error!="undefined"){e(document).epkb("ajax/error_message",o.message);n();return false}if(typeof o.process_errors=="object"){for(let e in o.process_errors){r.epkb("progress/add_log",{message:o.process_errors[e],type:"error"})}}if(typeof o.success!="undefined"&&t.selected_array.length){s();return}if(typeof o.success!="undefined"){r.epkb("progress/add_log",{message:o.success,type:"success"});r.epkb("progress/add_log",{message:t.selected_count-t.selected_array.length+" "+epkb_vars.msg_articles_converted,type:"success"});r.epkb("progress/set",100);t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden");t.$wrap.find(".epkb-convert-button-exit").removeClass("epkb-hidden")}}))}e(document).on("change",".epkb-author__curr_auth [name=categories_taxonomy]",(function(){if(e(this).val()==e(".epkb-author__curr_auth [name=tags_taxonomy]").val()){e(".epkb-author__curr_auth [name=tags_taxonomy]").val("")}}));e(document).on("change",".epkb-author__curr_auth [name=tags_taxonomy]",(function(){if(e(this).val()==e(".epkb-author__curr_auth [name=categories_taxonomy]").val()){e(".epkb-author__curr_auth [name=categories_taxonomy]").val("")}}))}));