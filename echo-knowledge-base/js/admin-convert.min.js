jQuery(document).ready((function(e){let t={kb_id:1,step:1,selected_array:[],$wrap:[],post_type:"post",convert_terms_mode:"copy_terms",selected_count:0,category_taxonomy:"",tags_taxonomy:""};function n(){return 0==t.$wrap.length?(e(document).epkb("notice/show",{message:epkb_vars.reload_try_again,type:"error"}),!1):1==t.step?t.$wrap.find("[name=epkb_convert_post]")&&0==t.$wrap.find("[name=epkb_convert_post]").first().prop("checked")?(e(document).epkb("notice/show",{message:epkb_vars.msg_confirm_kb,type:"error"}),!1):t.$wrap.find("[name=epkb_convert_backup]")&&0==t.$wrap.find("[name=epkb_convert_backup]").first().prop("checked")?(e(document).epkb("notice/show",{message:epkb_vars.msg_confirm_backup,type:"error"}),!1):!(t.$wrap.find("[name=epkb_convert_post_type]")&&!t.$wrap.find("[name=epkb_convert_post_type]").val())||(e(document).epkb("notice/show",{message:epkb_vars.msg_empty_post_type,type:"error"}),!1):2==t.step?0==t.$wrap.find("[name=row_id]").length?(e(document).epkb("notice/show",{message:epkb_vars.msg_nothing_to_convert,type:"error"}),!1):0!=t.$wrap.find("[name=row_id]:checked").length||(e(document).epkb("notice/show",{message:epkb_vars.msg_select_article,type:"error"}),!1):3==t.step||(e(document).epkb("notice/show",{message:epkb_vars.reload_try_again,type:"error"}),!1)}function r(n=1){"next"==n?t.step++:"prev"==n?t.step--:t.step=n;let a=1;for(;a<5;)t.step>=a?t.$wrap.find(".epkb-import-step--"+a).addClass("epkb-import-step--done"):t.$wrap.find(".epkb-import-step--"+a).removeClass("epkb-import-step--done"),a++;t.$wrap.find(".epkb-import-step").addClass("epkb-hidden"),t.$wrap.find(".epkb-import-step--"+t.step).removeClass("epkb-hidden"),1==t.step&&(t.$wrap.find(".epkb-convert-button-back").removeClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden"),t.$wrap.find(".convert-kb-name-checkbox").prop("checked",!1)),2==t.step&&(t.$wrap.find(".epkb-convert-button-back").removeClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden"),function(){let n=t.$wrap.find(".epkb-import-step--2 .epkb-progress");t.$wrap.find(".epkb-dsl__article-list-container, .epkb-convert-categories-filters").remove(),n.epkb("progress/clear_log"),n.epkb("progress/set",0);let o={_wpnonce_epkb_ajax_action:epkb_vars.nonce,action:"epkb_load_articles_list",kb_id:t.kb_id,epkb_convert_step:t.step,post_type:t.post_type,categories:[]};e.ajax({type:"POST",dataType:"json",data:o,url:ajaxurl}).done((function(o){if("object"==typeof o.success){for(let e in o.success)n.epkb("progress/add_log",{message:o.success[e],type:"success"});n.epkb("progress/set",100)}if(void 0!==o.response_html_1&&t.$wrap.find(".epkb-import-step.epkb-import-step--2").append(o.response_html_1),void 0!==o.response_html_2&&t.$wrap.find(".epkb-import-step.epkb-import-step--3").html(o.response_html_2),void 0!==o.error)return e(document).epkb("ajax/error_message",o.message),r(),!1})).fail((function(t,n,o){e(document).epkb("ajax/error_message",epkb_vars.msg_admin_error_l012),r()}))}()),t.step>1&&(t.$wrap.find(".epkb-convert-button-start").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-next").removeClass("epkb-hidden")),3==t.step&&(t.$wrap.find(".epkb-convert-button-next").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-start_convert").removeClass("epkb-hidden")),4==t.step&&function(){let n=t.$wrap.find(".epkb-import-step--4 .epkb-progress");t.selected_array=[],t.$wrap.find("input[name=row_id]:checked").each((function(){t.selected_array.push(e(this).val())})),t.selected_count=t.selected_array.length,t.$wrap.find('input[name="convert_terms_mode"]:checked').length&&(t.convert_terms_mode=t.$wrap.find('input[name="convert_terms_mode"]:checked').val());t.$wrap.find("[name=categories_taxonomy]").length&&(t.category_taxonomy=t.$wrap.find("[name=categories_taxonomy]").val());t.$wrap.find("[name=tags_taxonomy]").length&&(t.tags_taxonomy=t.$wrap.find("[name=tags_taxonomy]").val());t.$wrap.find(".epkb-convert-button-next").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-back").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-start_convert").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-cancel").removeClass("epkb-hidden"),t.$wrap.find(".epkb-form-field-non_attachments-message").html(""),n.epkb("progress/clear_log"),n.epkb("progress/set",0),n.epkb("progress/add_log",{message:epkb_vars.msg_converting}),o()}(),t.step<4&&(t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-exit").addClass("epkb-hidden"))}function o(){let n=t.$wrap.find(".epkb-import-step--4 .epkb-progress"),a=parseInt(100*(t.selected_count-t.selected_array.length)/t.selected_count);n.epkb("progress/set",a);let s=t.selected_array.splice(0,5),p={action:"epkb_convert_kb_content",_wpnonce_epkb_ajax_action:epkb_vars.nonce,epkb_kb_id:t.kb_id,epkb_convert_post_type:t.post_type,selected_rows:JSON.stringify(s),convert_terms_mode:t.convert_terms_mode,epkb_convert_step:t.step,category_taxonomy:t.category_taxonomy,tags_taxonomy:t.tags_taxonomy};e.ajax({type:"POST",dataType:"json",data:p,url:ajaxurl}).done((function(a){if(t.step<4)return!1;if(void 0!==a.error)return e(document).epkb("ajax/error_message",a.message),r(),!1;if("object"==typeof a.process_errors)for(let e in a.process_errors)n.epkb("progress/add_log",{message:a.process_errors[e],type:"error"});void 0!==a.success&&t.selected_array.length?o():void 0!==a.success&&(n.epkb("progress/add_log",{message:a.success,type:"success"}),n.epkb("progress/add_log",{message:t.selected_count-t.selected_array.length+" "+epkb_vars.msg_articles_converted,type:"success"}),n.epkb("progress/set",100),t.$wrap.find(".epkb-convert-button-cancel").addClass("epkb-hidden"),t.$wrap.find(".epkb-convert-button-exit").removeClass("epkb-hidden"))}))}e(".epkb-convert-button-back").on("click",(function(){t.step<2?e(document).epkb("tools/hide_panels"):t.step<5?r("prev"):r()})),e(".epkb-convert-button-next").on("click",(function(){if(1==t.step&&(t={kb_id:e(this).data("kb_id"),step:1,selected_array:[],$wrap:e(this).closest(".epkb-form-wrap"),post_type:e(this).closest(".epkb-form-wrap").find("[name=epkb_convert_post_type]").val(),convert_terms_mode:"copy_terms",selected_count:0,category_taxonomy:"",tags_taxonomy:""}),!n())return!1;r("next")})),e(".epkb-convert-button-start_convert").on("click",(function(){if(!n())return!1;r("next")})),e(".epkb-convert-button-cancel").on("click",(function(){e(this).addClass("epkb-hidden"),r()})),e(".epkb-convert-button-exit").on("click",(function(){r(),e(document).epkb("tools/hide_panels")})),e(document).on("change keyup",".epkb-convert-form--posts .epkb-convert-categories-select select, .epkb-convert-form--posts .epkb-convert-categories-filters--name-filter input",(function(){e("[name=row_id]").prop("checked",!1),e("#check_all_convert").prop("checked",!1),t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row").each((function(){let n=!0,r=e(this);t.$wrap.find(".epkb-convert-categories-select select").each((function(){if(""==e(this).val())return!0;let t=e(this).data("taxonomy-name");return 0==r.find("[data-kb-import-tax="+t+"]").length||0==r.find("[data-kb-import-tax="+t+"]").find("[data-kb-import-cat-id="+e(this).val()+"]").length?(n=!1,!1):void 0}));let o=t.$wrap.find(".epkb-convert-categories-filters--name-filter input").val().toLowerCase();o&&-1==r.find(".title").text().toLowerCase().indexOf(o)&&(n=!1),n?e(this).removeClass("hidden"):e(this).addClass("hidden")}))})),e(".epkb-convert-form--posts").on("change","#check_all_convert",(function(){e(this).prop("checked")?t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row").each((function(){!t.current_category||e(this).find("[data-kb-import-cat-id="+t.current_category+"]").length?e(this).find("[name=row_id]").prop("checked","checked"):e(this).find("[name=row_id]").prop("checked",!1)})):t.$wrap.find(".epkb-dsl__article-list__body .epkb-admin-row [name=row_id]").prop("checked",!1)})),e(document).on("change",".epkb-author__curr_auth [name=categories_taxonomy]",(function(){e(this).val()==e(".epkb-author__curr_auth [name=tags_taxonomy]").val()&&e(".epkb-author__curr_auth [name=tags_taxonomy]").val("")})),e(document).on("change",".epkb-author__curr_auth [name=tags_taxonomy]",(function(){e(this).val()==e(".epkb-author__curr_auth [name=categories_taxonomy]").val()&&e(".epkb-author__curr_auth [name=categories_taxonomy]").val("")}))}));