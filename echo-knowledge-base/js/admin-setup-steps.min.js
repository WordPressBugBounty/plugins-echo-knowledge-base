jQuery(document).ready((function(e){"use strict";const t={init:function(){this.bindEvents()},bindEvents:function(){e(document).on("click",".epkb-setup-steps__btn--done",this.handleDoneClick.bind(this));e(document).on("click",".epkb-setup-steps__btn--later",this.handleLaterClick.bind(this));e(document).on("click",".epkb-setup-steps__btn--complete-later",this.handleCompleteLaterClick.bind(this));e(document).on("click",".epkb-setup-steps__btn--restore",this.handleRestoreClick.bind(this));e(document).on("click",".epkb-setup-steps__toggle-btn",this.toggleCompletedSteps.bind(this));e(document).on("click",".epkb-setup-steps__btn--reset",this.handleResetClick.bind(this));e(document).on("click",".epkb-setup-steps__btn--inline-pointer",this.handleInlinePointerClick.bind(this));e(document).on("click","button.epkb-setup-steps__btn--learn-more",this.handleLearnMoreClick.bind(this));e(document).on("click",".epkb-setup-steps-dialog__close, .epkb-setup-steps-dialog-overlay",this.closeLearnMoreDialog.bind(this));e(document).on("keydown",this.handleDialogKeydown.bind(this));this.checkForCelebration()},handleDoneClick:function(t){t.preventDefault();this.submitStepAction(e(t.currentTarget),"done")},handleLaterClick:function(t){t.preventDefault();this.submitStepAction(e(t.currentTarget),"later")},handleCompleteLaterClick:function(t){t.preventDefault();this.submitStepAction(e(t.currentTarget),"done")},submitStepAction:function(t,n){const s=t.closest(".epkb-setup-steps__item");const o=t.closest(".epkb-setup-steps");const i=t.data("step-key");const a=parseInt(o.data("kb-id"),10);const r=n==="later"?"later":"done";if(!i){return}const p=s.find(".epkb-setup-steps__btn--done, .epkb-setup-steps__btn--later, .epkb-setup-steps__btn--complete-later");const l=s.find(".epkb-setup-steps__btn--restore");p.prop("disabled",true);l.prop("disabled",true);t.addClass("epkb-loading");const c={action:"epkb_mark_setup_step_done",step_key:i,mode:r,_wpnonce_epkb_ajax_action:epkb_vars.nonce};if(!isNaN(a)&&a>0){c.kb_id=a}e.ajax({url:ajaxurl,type:"POST",data:c,success:function(e){if(e.success){location.reload();return}p.prop("disabled",false);l.prop("disabled",false);t.removeClass("epkb-loading");console.error("Error marking step:",e.data)},error:function(e,n,s){p.prop("disabled",false);l.prop("disabled",false);t.removeClass("epkb-loading");console.error("AJAX error:",s)}})},checkForCelebration:function(){const t=e(".epkb-setup-steps__celebration");if(t.length){this.showCelebrationFireworks()}},showCelebrationFireworks:function(){const t=e(".epkb-setup-steps__celebration");if(!t.length)return;const n=t.offset();const s=t.outerWidth();const o=t.outerHeight();const i=["#fbbf24","#f59e0b","#d97706","#22c55e","#3b82f6","#8b5cf6","#ec4899"];let a=e(".epkb-fireworks-container");if(!a.length){a=e('<div class="epkb-fireworks-container"></div>').appendTo("body")}const r=function(t){setTimeout((function(){for(let t=0;t<25;t++){const t=i[Math.floor(Math.random()*i.length)];const r=Math.random()*10+6;const p=n.left+Math.random()*s;const l=n.top+o/2;const c=(Math.random()-.5)*400;const d=Math.random()*.2;const u=Math.random()*.5+1.2;const b=e('<div class="epkb-firework"></div>').css({left:p+"px",top:l+"px",width:r+"px",height:r+"px",backgroundColor:t,animationDelay:d+"s",animationDuration:u+"s","--spread":c+"px"});a.append(b);setTimeout((function(){b.remove()}),(d+u)*1e3+100)}}),t)};r(0);r(400);r(800);setTimeout((function(){if(a.children().length===0){a.remove()}}),3e3)},handleRestoreClick:function(t){t.preventDefault();const n=e(t.currentTarget);const s=n.closest(".epkb-setup-steps");const o=n.data("step-key");const i=parseInt(s.data("kb-id"),10);if(!o){return}n.prop("disabled",true).addClass("epkb-loading");e.ajax({url:ajaxurl,type:"POST",data:Object.assign({action:"epkb_restore_setup_step",step_key:o,_wpnonce_epkb_ajax_action:epkb_vars.nonce},!isNaN(i)&&i>0?{kb_id:i}:{}),success:function(e){if(e.success){location.reload()}else{n.prop("disabled",false).removeClass("epkb-loading");console.error("Error restoring step:",e.data)}},error:function(e,t,s){n.prop("disabled",false).removeClass("epkb-loading");console.error("AJAX error:",s)}})},toggleCompletedSteps:function(t){t.preventDefault();const n=e(t.currentTarget);const s=e(".epkb-setup-steps__completed-list");const o=s.find(".epkb-setup-steps__item").length;if(s.is(":visible")){s.hide();n.html('<span class="epkbfa epkbfa-chevron-down"></span> '+(epkb_vars.show_completed_text||"Show Completed Steps")+" ("+o+")")}else{s.show();n.html('<span class="epkbfa epkbfa-chevron-up"></span> '+(epkb_vars.hide_completed_text||"Hide Completed Steps")+" ("+o+")")}},handleResetClick:function(t){t.preventDefault();const n=e(t.currentTarget);n.prop("disabled",true).addClass("epkb-loading");e.ajax({url:ajaxurl,type:"POST",data:{action:"epkb_reset_setup_steps",_wpnonce_epkb_ajax_action:epkb_vars.nonce},success:function(e){if(e.success){location.reload()}else{n.prop("disabled",false).removeClass("epkb-loading");console.error("Error resetting steps:",e.data)}},error:function(e,t,s){n.prop("disabled",false).removeClass("epkb-loading");console.error("AJAX error:",s)}})},handleInlinePointerClick:function(t){t.preventDefault();const n=e(t.currentTarget);const s=n.data("target-element");const o=n.data("pointer-title");const i=n.data("pointer-content");if(!s){return}const a=this.findTarget(s);if(!a||!a.length){console.warn("Target element not found:",s);return}const r=a.closest("#adminmenu").length>0;if(r){const e=a.closest("li.menu-top");if(e.length&&!e.hasClass("wp-has-current-submenu")){e.addClass("opensub").find(".wp-submenu").show()}}e(".wp-pointer").remove();const p="<h3>"+o+"</h3><p>"+i+"</p>";a.pointer({content:p,position:{edge:r?"left":"top",align:"center"},pointerClass:"epkb-setup-pointer",buttons:function(t,n){const s=e('<button type="button" class="button button-primary epkb-pointer-next">'+(epkb_vars.got_it_text||"Got it!")+"</button>");s.on("click",(function(){n.element.pointer("close")}));return s}}).pointer("open")},findTarget:function(t){const n=t.split(",");for(let t=0;t<n.length;t++){const s=n[t].trim();const o=e(s);if(o.length){const e=o.filter(":visible");if(e.length){return e.first()}return o.first()}}return null},handleLearnMoreClick:function(t){t.preventDefault();const n=e(t.currentTarget);const s=n.data("title");const o=n.data("description");const i=n.data("doc-url");const a=n.data("video-url");const r=n.data("ask-ai");const p=n.data("action-url");const l=n.data("action-text");const c=e(".epkb-setup-steps-dialog");const d=e(".epkb-setup-steps-dialog-overlay");c.find(".epkb-setup-steps-dialog__title").text(s);c.find(".epkb-setup-steps-dialog__description").html(this.formatDescription(o));const u=c.find(".epkb-setup-steps-dialog__footer");const b=c.find(".epkb-setup-steps-dialog__btn--action");const f=c.find(".epkb-setup-steps-dialog__btn--doc");const k=c.find(".epkb-setup-steps-dialog__btn--video");const h=c.find(".epkb-setup-steps-dialog__btn--ask-ai");b[0].style.display="none";f[0].style.display="none";k[0].style.display="none";h[0].style.display="none";if(p&&l){b.attr("href",p).find(".epkb-setup-steps-dialog__btn-text").text(l);b[0].style.display="inline-flex"}if(i){f.attr("href",i);f[0].style.display="inline-flex"}if(a){k.attr("href",a);k[0].style.display="inline-flex"}if(r){h[0].style.display="inline-flex"}const _=p||i||a||r;u[0].style.display=_?"flex":"none";d.addClass("epkb-setup-steps-dialog-overlay--active");c.addClass("epkb-setup-steps-dialog--active");c.find(".epkb-setup-steps-dialog__close").focus()},closeLearnMoreDialog:function(t){if(t){t.preventDefault()}e(".epkb-setup-steps-dialog-overlay").removeClass("epkb-setup-steps-dialog-overlay--active");e(".epkb-setup-steps-dialog").removeClass("epkb-setup-steps-dialog--active")},handleDialogKeydown:function(t){if(t.key==="Escape"&&e(".epkb-setup-steps-dialog--active").length){this.closeLearnMoreDialog()}},formatDescription:function(e){if(!e){return""}const t=function(e){const t=document.createElement("div");t.textContent=e;return t.innerHTML};e=t(e);const n=/(\d+)\)\s+/g;if(n.test(e)){const t=e.split(/\d+\)\s+/);const n=t[0].trim();const s=t.slice(1).map((e=>e.trim())).filter((e=>e));if(s.length>0){let e=n?"<p>"+n+"</p>":"";e+="<ol>";s.forEach((function(t){e+="<li>"+t+"</li>"}));e+="</ol>";return e}}if(e.includes("•")){const t=e.split("•");const n=t[0].trim();const s=t.slice(1).map((e=>e.trim())).filter((e=>e));if(s.length>0){let e=n?"<p>"+n+"</p>":"";e+="<ul>";s.forEach((function(t){e+="<li>"+t+"</li>"}));e+="</ul>";return e}}return"<p>"+e+"</p>"}};t.init()}));