(function(){"use strict";const{useState:e,useEffect:t,useCallback:n,createElement:o,Fragment:a,createContext:s,useContext:l,useMemo:i,useRef:c}=wp.element;const{__:d}=wp.i18n;const{showError:r,showSuccess:g,makeApiRequest:u,showConfirmDialog:p,showLoadingDialog:b,clearAllEPKBSessionStorage:h}=window.EPKB_AI_Util_React||{};const{logError:f}=window.EPKBChatUtils||{};const{SyncControls:m,SyncProgressBar:k}=window.EPKB_AI_Sync?{SyncControls:window.EPKB_AI_SyncControls,SyncProgressBar:window.EPKB_AI_SyncProgressBar}:{};const w=s();window.EPKB_AI_TrainingDataCacheContext=w;const y=({children:n})=>{const a=()=>{try{const e=sessionStorage.getItem("epkb_ai_training_data_cache");return e?JSON.parse(e):{}}catch(e){return{}}};const[s,l]=e(a);t((()=>{h();l({})}),[]);t((()=>{const e=()=>{if(document.visibilityState==="visible"){h();l({})}};document.addEventListener("visibilitychange",e);return()=>{document.removeEventListener("visibilitychange",e)}}),[]);t((()=>{const e=()=>{h()};window.addEventListener("beforeunload",e);return()=>{window.removeEventListener("beforeunload",e)}}),[]);t((()=>{try{sessionStorage.setItem("epkb_ai_training_data_cache",JSON.stringify(s))}catch(e){if(e.name==="QuotaExceededError"){l({});try{sessionStorage.removeItem("epkb_ai_training_data_cache")}catch(e){}}else{}}}),[s]);const c=i((()=>({get:e=>s[e],set:(e,t)=>{l((n=>({...n,[e]:{...t,timestamp:Date.now()}})))},remove:e=>{l((t=>{const n={...t};delete n[e];return n}))},clear:()=>{l({});h()},clearCollection:e=>{l((t=>{const n={...t};Object.keys(n).forEach((t=>{if(t.startsWith(`collection_${e}_`)){delete n[t]}}));return n}))},clearNonExistentCollections:e=>{l((t=>{const n={...t};Object.keys(n).forEach((t=>{const o=t.match(/^collection_(\d+)_/);if(o){const a=parseInt(o[1]);if(!e.includes(a)){delete n[t]}}}));return n}))}})),[s]);return o(w.Provider,{value:c},n)};const _=()=>{const e=l(w);if(!e){throw new Error("useTrainingDataCache must be used within TrainingDataCacheProvider")}return e};const v=window.EPKB_AI_DataSourceTable||(()=>o("div",null,"DataSourceTable component not loaded"));const C=({isOpen:n,onClose:s,onSave:l,noteData:i=null,collectionId:c,onDelete:r=null})=>{const[g,u]=e("");const[p,b]=e("");const[h,m]=e(false);const[k,w]=e(false);const[y,_]=e(false);t((()=>{if(!n||!i)return;u(i.title||"");if(i.training_id&&!i.content){w(true);b("");const{makeApiRequest:e,showError:t}=window.EPKB_AI_Util_React||{};if(e){e(`training-data/${i.training_id}/content`,{method:"GET"}).then((e=>{if(e&&e.data){b(e.data.processed_content||e.data.doc_content||"")}})).catch((e=>{f("AI Training Data","Failed to fetch note content",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:i?.id});if(t){t(d("Failed to load note content","echo-knowledge-base"))}})).finally((()=>{w(false)}))}else{f("AI Training Data","makeApiRequest not available",{context:"Note content loading"});w(false)}}else{b(i.content||"")}}),[n,i]);if(!n)return null;const v=async()=>{const{showError:e}=window.EPKB_AI_Util_React||{};if(!g.trim()||!p.trim()){if(e){e(d("Please enter both title and content for the note","echo-knowledge-base"))}return}m(true);try{await l({title:g,content:p,id:i?.id,training_id:i?.training_id});u("");b("");s()}catch(e){f("AI Training Data","Error saving note",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:i?.id})}finally{m(false)}};const C=async()=>{const{showConfirmDialog:e,makeApiRequest:t,showSuccess:n,showError:o}=window.EPKB_AI_Util_React||{};if(!e||!t){f("AI Training Data","Required utilities not available",{context:"Note deletion",missing:{confirmDialog:!e,apiRequest:!t}});if(o){o(d("Unable to delete note. Please refresh the page and try again.","echo-knowledge-base"))}return}const a=await e({title:d("Delete Note","echo-knowledge-base"),message:d("Are you sure you want to delete this note? This action cannot be undone.","echo-knowledge-base"),confirmText:d("Delete","echo-knowledge-base"),cancelText:d("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!a)return;_(true);try{const e=await t(`training-notes/${i.id}`,{method:"DELETE"});if(e&&e.success){if(n){n(d("Note deleted successfully","echo-knowledge-base"))}u("");b("");s();if(r){r(i.id)}}}catch(e){f("AI Training Data","Error deleting note",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:item?.id});if(!e._errorDisplayed&&o){o(e.message||d("Failed to delete note","echo-knowledge-base"))}}finally{_(false)}};return o("div",{className:"epkb-ai-dialog-overlay",onClick:s},o("div",{className:"epkb-ai-dialog epkb-ai-notes-dialog",onClick:e=>e.stopPropagation()},o("div",{className:"epkb-ai-dialog-header"},o("h3",null,i?d("Edit Note","echo-knowledge-base"):d("Add Note","echo-knowledge-base")),o("button",{className:"epkb-ai-dialog-close",onClick:s},o("span",{className:"epkbfa epkbfa-times"}))),o("div",{className:"epkb-ai-dialog-body"},k?o("div",{style:{padding:"40px",textAlign:"center"}},o("div",{className:"epkb-ai-loading-spinner"}),o("p",{style:{marginTop:"20px",color:"#666"}},d("Loading note content...","echo-knowledge-base"))):o(a,null,o("div",{className:"epkb-ai-form-group"},o("label",null,d("Note Title","echo-knowledge-base")),o("input",{type:"text",className:"epkb-ai-form-control",value:g,onChange:e=>u(e.target.value),placeholder:d("Enter note title...","echo-knowledge-base"),disabled:k})),o("div",{className:"epkb-ai-form-group"},o("label",null,d("Note Content","echo-knowledge-base")),o("textarea",{className:"epkb-ai-form-control",rows:10,value:p,onChange:e=>b(e.target.value),placeholder:d("Enter note content...","echo-knowledge-base"),disabled:k})))),o("div",{className:"epkb-ai-dialog-footer",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},o("div",null,i?.id&&o("button",{className:"epkb-ai-button epkb-ai-button-danger",onClick:C,disabled:y||k||h,style:{backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff"}},y?d("Deleting...","echo-knowledge-base"):d("Delete Note","echo-knowledge-base"))),o("div",{style:{display:"flex",gap:"10px"}},o("button",{className:"epkb-ai-button epkb-ai-button-secondary",onClick:s,disabled:k||y},d("Cancel","echo-knowledge-base")),o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:v,disabled:h||k||y},h?d("Saving...","echo-knowledge-base"):d("Save Note","echo-knowledge-base"))))))};const N=({collectionId:n,collection:s,config:l,onSyncStart:i=null,onActionChange:c=null,hasApiKey:b=true,isDeletingDialogOpen:h=false,selectedRecordsCount:k=0,selectedIds:w=[],selectedItemsInfo:y={},trainingData:_=[],bulkDeleteHandler:v=null,onDeleteCollection:C=null,collectionName:N="",onSelectAll:x=null,isAllSelected:A=false,onTableRefresh:S=null,isFiltered:D=false,isSelectAllActive:I=false,totalItems:T=0,statusCounts:E={},isAIProEnabled:P=false,isNotesDialogOpen:B=false,editingNote:$=null,onNoteAdd:K=null,onNoteDialogClose:R=null,handleSaveNote:L=null,isSyncing:O=false,activeStatusTab:U="all"})=>{const[j,F]=e(null);const[q,z]=e([]);const[W,H]=e(false);const[M,G]=e(N);const[J]=e(N);const[Q,V]=e(false);const[X,Y]=e(null);const[Z,ee]=e(false);const te=async()=>{if(Z||X)return;ee(true);try{const e=await u(`training-collections/${n}/post-stats`,{method:"GET"});if(e.success&&e.post_types_status){Y(e.post_types_status)}}catch(e){f("AI Training Data","Failed to load post stats",{message:e.message||"Unknown error",collectionId:n});Y({})}finally{ee(false)}};t((()=>{if(j==="add"&&!X&&!Z){const e=s&&s.config&&s.config.ai_training_data_store_post_types_options;if(e==="load_on_demand"){te()}}}),[j,s,X,Z]);const ne=()=>{if(I){if(U!=="all"){return E[U]||0}return T}if(U!=="all"){return Object.keys(y).filter((e=>y[e]&&y[e].status===U)).length}return w.length};t((()=>{if(c){c(j)}}),[j,c]);t((()=>{if(O&&j!=="sync"){F("sync")}}),[O]);const[oe,ae]=e(false);const se=async()=>{if(!M.trim()){r(d("Collection name cannot be empty","echo-knowledge-base"));return}V(true);try{const e=await u(`training-collections/${n}`,{method:"PUT",data:{name:M}});if(e.success){g(d("Collection name updated successfully","echo-knowledge-base"));setTimeout((()=>{window.location.reload()}),1e3)}}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){r(e.message||d("Failed to update collection name","echo-knowledge-base"))}}finally{V(false)}};const le=async()=>{const e=await p({title:d("Delete Collection","echo-knowledge-base"),message:`${d("Are you sure you want to delete this collection?","echo-knowledge-base")}\n\n${d("Type the collection name to confirm:","echo-knowledge-base")} "${N}"`,confirmText:d("Delete","echo-knowledge-base"),cancelText:d("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger",requireInput:true,inputPlaceholder:d("Enter collection name","echo-knowledge-base"),inputMatch:N});if(!e){return}ae(true);try{const e=await u(`training-collections/${n}`,{method:"DELETE"});if(e.success){g(d("Collection deleted successfully","echo-knowledge-base"));if(C){C(n)}}}catch(e){f("AI Training Data","Delete collection error",{message:e.message||"Unknown error",code:e.code,status:e.status,collectionId:item?.id,collectionName:item?.name});if(e.message!=="API key required"&&!e._errorDisplayed){r(e.message||d("Failed to delete collection","echo-knowledge-base"))}}finally{}};const ie=async()=>{if(q.length===0){r(d("Please select at least one data type","echo-knowledge-base"));return}H(true);try{const e=await u(`training-collections/${n}/add-data`,{method:"POST",data:{data_types:q}});if(e.success){g(e.message||d("Data added successfully","echo-knowledge-base"));z([]);Y(null);if(S){S()}te()}}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){r(e.message||d("Failed to add data","echo-knowledge-base"))}}finally{H(false)}};if(!j){return o("div",{className:"epkb-ai-data-source-settings"},o("h3",{className:"epkb-ai-data-source-heading"},d("Choose an Action","echo-knowledge-base")),o("div",{className:"epkb-ai-action-buttons"},o("button",{className:`epkb-ai-button epkb-ai-button-secondary ${O?"disabled":""}`,onClick:()=>!O&&F("add"),disabled:O,title:O?d("Cannot change actions while sync is in progress","echo-knowledge-base"):""},o("span",null,d("Choose Training Data","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"})),o("button",{className:"epkb-ai-button epkb-ai-button-secondary",onClick:()=>F("sync")},o("span",null,d("Send Data to AI","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"})),o("button",{className:`epkb-ai-button epkb-ai-button-secondary ${O?"disabled":""}`,onClick:()=>!O&&F("remove"),disabled:O,title:O?d("Cannot change actions while sync is in progress","echo-knowledge-base"):""},o("span",null,d("Other Actions","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"}))),o("div",{className:"epkb-ai-action-info notice notice-info"},o("h4",null,d("How to get started","echo-knowledge-base")),o("ol",null,o("li",null,o("strong",null,d("Choose Training Data","echo-knowledge-base"))," — ",d("Pick the content types to include.","echo-knowledge-base")),o("li",null,o("strong",null,d("Send Data to AI","echo-knowledge-base"))," — ",d("Select items in the table, then sync them.","echo-knowledge-base")),o("li",null,o("strong",null,d("Other Actions","echo-knowledge-base"))," — ",d("Rename the collection or delete items.","echo-knowledge-base"))),o("p",null,d("Tip: Start with a small set to test the flow.","echo-knowledge-base"))))}const ce=()=>{switch(j){case"add":return d("Add Training Data","echo-knowledge-base");case"sync":return d("Send Data to AI","echo-knowledge-base");case"remove":return d("Other Actions","echo-knowledge-base");default:return""}};return o("div",{className:"epkb-ai-data-source-settings"},o("button",{className:`epkb-ai-back-button ${O?"disabled":""}`,onClick:()=>{if(!O){F(null)}},disabled:O,title:O?d("Cannot navigate while sync is in progress","echo-knowledge-base"):""},o("span",{className:"epkbfa epkbfa-chevron-left"}),d("Back","echo-knowledge-base")),o("h3",{style:{marginBottom:"20px",fontSize:"24px",fontWeight:"600",borderBottom:"2px solid #d0d0d0",paddingBottom:"10px"}},ce()),j==="add"&&o("div",{className:"epkb-ai-action-content"},o("p",{style:{color:"#666",marginBottom:"15px"}},d("Choose which content types you want to include in your AI training data.","echo-knowledge-base")),l.is_access_manager_active&&o("div",{className:"epkb-ai-access-manager-warning",style:{backgroundColor:"#fee",border:"1px solid #dc3545",borderRadius:"4px",padding:"15px",marginBottom:"20px",color:"#721c24"}},o("strong",{style:{display:"block",marginBottom:"5px"}},d("Access Manager Notice","echo-knowledge-base")),o("span",null,d("Currently only publicly accessible articles can be uploaded to AI. Articles with access restrictions will not be included in the training data.","echo-knowledge-base"))),(()=>{const e=s&&s.config&&s.config.ai_training_data_store_post_types_options;if(e==="load_on_demand"&&!X){if(Z){return o("div",{style:{padding:"20px",textAlign:"center"}},o("div",{className:"epkb-ai-loading-spinner"}),o("p",{style:{marginTop:"10px",color:"#666"}},d("Loading content types...","echo-knowledge-base")))}return o("div",{style:{padding:"20px",textAlign:"center"}},o("p",{style:{color:"#666"}},d("Loading content types...","echo-knowledge-base")))}const t=X?X:s&&s.config&&s.config.ai_training_data_store_post_types_options&&s.config.ai_training_data_store_post_types_options!=="load_on_demand"?s.config.ai_training_data_store_post_types_options:l&&l.available_post_types||{};const n=Object.entries(t);return o("div",{className:"epkb-ai-checkbox-list"},n.length>0?n.map((([e,t])=>{const n=typeof t==="object"&&t!==null;const a=n?t.label:t;const s=n?t:{available:true,new_items:1};const l=!s.available||s.new_items!=="500+"&&s.new_items===0;return o("div",{key:e,style:{marginBottom:"15px"}},o("label",{style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:l?"not-allowed":"pointer",opacity:l?"0.6":"1"}},o("input",{type:"checkbox",checked:q.includes(e),disabled:l,onChange:t=>{if(!l){if(t.target.checked){z([...q,e])}else{z(q.filter((t=>t!==e)))}}},style:{marginRight:"10px"}}),o("span",{style:{fontWeight:"500"}},a),n&&o("span",{style:{marginLeft:"10px",fontSize:"0.9em",color:"#666"}},(()=>{const e=[];if(s.new_items==="500+"||s.new_items>0){const t=s.new_items==="500+"?"500+":s.new_items;e.push(`${t} ${d("available","echo-knowledge-base")}`)}if(s.already_added>0){e.push(`${s.already_added} ${d("added","echo-knowledge-base")}`)}const t=(s.linked_articles||0)+(s.password_protected||0)+(s.excluded||0);if(t>0){e.push(`${t} ${d("excluded","echo-knowledge-base")}`)}return e.length>0?`(${e.join(", ")})`:""})())),l&&o("div",{style:{marginLeft:"25px",color:!s.available?"#dc3545":"#008a20",fontSize:"0.9em",fontStyle:"italic"}},(()=>{if(!s.available){const e=(s.linked_articles||0)+(s.password_protected||0)+(s.excluded||0);if(e>0){const e=[];if(s.password_protected>0){e.push(`${s.password_protected} password-protected`)}if(s.linked_articles>0){e.push(`${s.linked_articles} linked`)}if(s.excluded>0){e.push(`${s.excluded} restricted`)}return`${d("No eligible content","echo-knowledge-base")} (${e.join(", ")})`}return d("No published content available","echo-knowledge-base")}else{return d("All eligible items already added to collection","echo-knowledge-base")}})()))})):o("p",{style:{color:"#888"}},d("No content types available.","echo-knowledge-base")))})(),o("div",{style:{marginTop:"20px"}},o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:ie,disabled:W||q.length===0},W?d("Adding Data...","echo-knowledge-base"):d("Add Data","echo-knowledge-base"))),P&&o(a,null,o("hr",{className:"epkb-ai-section-divider"}),o("div",{className:"epkb-ai-notes-section"},o("h3",{className:"epkb-ai-section-heading"},d("Notes","echo-knowledge-base")),o("p",{className:"epkb-ai-section-description"},d("Add custom notes to help train the AI with specific information, guidelines, or context that may not be in your regular content.","echo-knowledge-base")),o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:K},o("span",{className:"epkbfa epkbfa-plus"})," ",d("Add Note","echo-knowledge-base"))))),j==="sync"&&o("div",{className:"epkb-ai-action-content"},(()=>{let e;let t=k;if(I){if(U!=="all"){e=`ALL_${U.toUpperCase()}`}else{e="ALL"}}else{if(U!=="all"){e=w.filter((e=>{const t=y[e];return t&&t.status===U})).map((e=>y[e].item_id));t=e.length}else{e=w.map((e=>{const t=y[e];if(t){return t.item_id}const n=_.find((t=>t.id===e));return n?n.item_id:null})).filter((e=>e!==null))}}return o(a,null,m&&o(m,{collectionId:n,selectedPostIds:e,disabled:!b||h||e!=="ALL"&&typeof e!=="string"&&e.length===0,hasApiKey:b,onSelectAll:x,isAllSelected:A,selectedRecordsCount:t,isFiltered:D,onSyncStart:i,isSelectAllActive:I,activeStatusTab:U}))})(),o("p",{style:{color:"#666",marginTop:"15px",fontSize:"14px"}},d("Select items from the table and choose a sync method to update your AI training data.","echo-knowledge-base"))),j==="remove"&&o("div",{className:"epkb-ai-action-content"},o("p",{style:{color:"#666",marginBottom:"20px"}},d("Manage your collection settings and data.","echo-knowledge-base")),o("div",{className:"epkb-ai-collection-name-section",style:{marginBottom:"30px"}},o("h4",{style:{marginBottom:"10px",fontSize:"16px",fontWeight:"600"}},d("Collection Name","echo-knowledge-base"),o("span",{style:{color:"#999",fontWeight:"normal",fontSize:"14px",marginLeft:"10px"}},`(ID: ${n})`)),o("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},o("input",{type:"text",value:M,onChange:e=>G(e.target.value),style:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",flex:"1",maxWidth:"400px"},placeholder:d("Enter collection name","echo-knowledge-base")}),o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:se,disabled:Q||M===J,style:{padding:"8px 20px",cursor:Q||M===J?"not-allowed":"pointer",opacity:Q||M===J?.5:1}},Q?d("Saving...","echo-knowledge-base"):d("Save","echo-knowledge-base"))),o("p",{style:{marginTop:"8px",color:"#666",fontSize:"13px"}},d("Change the display name for this collection.","echo-knowledge-base"))),o("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #e5e5e5"}}),(()=>null)(),o("div",{className:"epkb-ai-delete-selected-section",style:{marginBottom:"25px"}},o("div",{style:{display:"flex",alignItems:"center",gap:"15px"}},o("button",{id:"epkb-ai-delete-selected-btn",className:"epkb-ai-button epkb-ai-button-danger",onClick:e=>{e.preventDefault();e.stopPropagation();if(v&&typeof v==="function"){try{v()}catch(e){f("AI Training Data","Error calling bulkDeleteHandler",{message:e.message||"Unknown error",selectedCount:w.length})}}else{f("AI Training Data","bulkDeleteHandler is not a function",{type:typeof v,handler:v});r(d("Unable to delete items. Please refresh the page and try again.","echo-knowledge-base"))}},disabled:!v||ne()===0,style:{padding:"10px 20px",backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff",cursor:!v||ne()===0?"not-allowed":"pointer",opacity:!v||ne()===0?.5:1}},d("Delete Selected","echo-knowledge-base")),o("span",{style:{color:"#666",fontSize:"14px"}},`${ne()} ${d("Selected Records","echo-knowledge-base")}`)),o("p",{style:{marginTop:"10px",color:"#666",fontSize:"13px"}},d("Delete the selected training data items from this collection.","echo-knowledge-base"))),o("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #e5e5e5"}}),o("div",{className:"epkb-ai-delete-collection-section"},o("button",{className:"epkb-ai-button epkb-ai-button-danger epkb-ai-delete-collection-btn",onClick:le,disabled:oe,style:{padding:"10px 20px",backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff",cursor:oe?"not-allowed":"pointer"}},oe?d("Deleting...","echo-knowledge-base"):d("Delete Collection","echo-knowledge-base")),o("p",{style:{marginTop:"10px",color:"#666",fontSize:"13px"}},d("This will permanently delete all training data in this collection.","echo-knowledge-base")))))};const x=({collection:s,config:i,hasApiKey:c,onDeleteCollection:p})=>{const[b,h]=e(false);const[f,m]=e(false);const[k,w]=e(false);const[y,_]=e([]);const[x,A]=e({});const[S,D]=e([]);const[I,T]=e(null);const[E,P]=e(null);const[B,$]=e(0);const[K,R]=e((()=>{if(s&&s.stats){return{added:0,updated:0,outdated:0,error:0,pending:0,...s.stats}}return{}}));const[L,O]=e(0);const[U,j]=e(false);const[F,q]=e(false);const[z,W]=e(false);const[H,M]=e(null);const[G,J]=e("all");const[Q,V]=e("all");const X=E&&y.length>0&&B>0&&y.length===B;const Y=n((e=>{M(e);W(true)}),[]);const Z=n((async e=>{try{const t=await u("training-notes",{method:e.id?"PUT":"POST",data:{collection_id:s.id,title:e.title,content:e.content,note_id:e.id,training_id:e.training_id}});if(t.success){g(e.id?d("Note updated successfully","echo-knowledge-base"):d("Note added successfully","echo-knowledge-base"));O((e=>e+1));W(false);M(null)}}catch(e){if(e.code==="ai_pro_class_missing"){r(d("AI Features Pro is not properly configured. Please ensure the plugin is activated.","echo-knowledge-base"))}else if(!e._errorDisplayed){r(e.message||d("Failed to save note","echo-knowledge-base"))}throw e}}),[s.id]);const ee=window.EPKB_AI_SyncContext?l(window.EPKB_AI_SyncContext):null;t((()=>{if(ee&&ee.job){const e=ee.job.status;if(e==="completed"||e==="canceled"||e==="idle"){h(false)}}}),[ee?.job?.status]);const te=n((e=>{T((()=>e))}),[]);const ne=n((e=>{const t=t=>{q(t);if(t&&S.length>0){const e={};S.forEach((t=>{e[t.id]={status:t.status,item_id:t.item_id}}));A((t=>({...t,...e})))}if(e){e(t)}};P((()=>t))}),[S]);const oe=n((e=>{if(e===null){h(false)}}),[]);const ae=n((e=>{_(e);if(e.length===0){A({});return}A((t=>{const n={};e.forEach((e=>{const o=S.find((t=>t.id===e));if(o){n[e]={status:o.status,item_id:o.item_id}}else if(t[e]){n[e]=t[e]}}));return n}))}),[S]);const se=n((()=>{if(F){return B}if(G==="all"||G==="sync"){return y.length}let e=0;y.forEach((t=>{const n=S.find((e=>e.id===t));if(n&&n.status===G){e++}}));return e}),[F,B,G,y,S]);const le=n((()=>{O((e=>e+1))}),[]);const ie=n((()=>{h(true);setTimeout((()=>{A({})}),100)}),[]);const ce=n((e=>{J(e);if(e!=="sync"){V(e)}}),[]);const de=n((e=>{R(e)}),[]);t((()=>{if(S.length>0&&y.length>0){A((e=>{const t={...e};S.forEach((e=>{if(y.includes(e.id)){t[e.id]={status:e.status,item_id:e.item_id}}}));return t}))}}),[S,y]);const re=o(a,null,i.is_ai_features_pro_enabled&&o(C,{isOpen:z,onClose:()=>{W(false);M(null)},onSave:Z,onDelete:()=>{O((e=>e+1))},noteData:H,collectionId:s.id}),o("div",{className:"epkb-ai-data-collection-wrapper"},o("div",{className:"epkb-ai-data-source-layout"},o(v,{collectionId:s.id,collectionName:s.name,hasApiKey:c,onSelectedIdsChange:ae,onBulkDeleteCallback:te,onSelectAllCallback:ne,onTotalItemsChange:$,onTrainingDataChange:D,refreshTrigger:L,isSyncing:b,onFilterStateChange:j,initialStats:s.stats||null,initialData:s.preloaded_data||null,selectedIds:y,onNoteEdit:Y,isAIProEnabled:i.is_ai_features_pro_enabled||false,onActiveStatusTabChange:ce,onStatusCountsChange:de}),o(N,{collectionId:s.id,collection:s,config:i,onSyncStart:ie,onActionChange:oe,hasApiKey:c,isDeletingDialogOpen:k,selectedRecordsCount:(()=>{if(F){if(Q!=="all"){return K[Q]||0}return B}if(Q!=="all"){return Object.keys(x).filter((e=>x[e]&&x[e].status===Q)).length}return y.length})(),selectedIds:y,selectedItemsInfo:x,trainingData:S,bulkDeleteHandler:I,onDeleteCollection:p,collectionName:s.name,onSelectAll:E,isAllSelected:F,onTableRefresh:le,isFiltered:U,isSelectAllActive:F,totalItems:B,statusCounts:K,isAIProEnabled:i.is_ai_features_pro_enabled||false,isNotesDialogOpen:z,editingNote:H,onNoteAdd:()=>{M(null);W(true)},onNoteDialogClose:()=>{W(false);M(null)},handleSaveNote:Z,isSyncing:b,activeStatusTab:Q}))));return re};const A=({settings:n,tabData:a,hasApiKey:s,onTabSwitch:i})=>{const c=a||{};const p=c.ai_config||{};p.available_post_types=c.available_post_types||{};p.is_wp_cron_disabled=c.is_wp_cron_disabled||false;const b=c.data_collections||[];const[h,f]=e(b);const m=_();t((()=>{const e=h.map((e=>e.id));m.clearNonExistentCollections(e)}),[]);const[k,w]=e(h.length>0?`collection-${h[0].id}`:"add-new");const y=k.startsWith("collection-")?h.find((e=>`collection-${e.id}`===k)):null;const v=e=>{const t=h.filter((t=>t.id!==e));f(t);setTimeout((()=>{window.location.reload()}),1e3)};const C=p?.ai_disclaimer_accepted==="on";if(!C){const{DisclaimerRequiredMessage:e}=window.EPKB_AI_Util_React||{};if(e){return o(e,{i18n:n?.i18n||{},onAccept:()=>{if(i){i("general-settings")}else{const e=new URL(window.location.href);if(e.searchParams.has("page")){e.searchParams.set("active_tab","general-settings");window.location.href=e.toString()}}}})}}const N=async()=>{const e=c.next_collection_id;if(!e){r(d("Unable to determine next collection ID","echo-knowledge-base"));return}m.clearCollection(e);try{const t=await u("training-collections",{method:"POST",data:{collection_id:e,name:d("Data Collection","echo-knowledge-base")+" "+e}});if(t.success){g(d("Collection created successfully","echo-knowledge-base"));setTimeout((()=>{window.location.reload()}),1e3)}}catch(e){if(!e._errorDisplayed){r(e.message||d("Failed to create collection","echo-knowledge-base"))}}};const A=c.sub_tabs?Object.values(c.sub_tabs):[];const S=window.EPKB_AI_SyncContext?l(window.EPKB_AI_SyncContext):null;const D=S&&S.job&&(S.job.status==="running"||S.job.status==="scheduled");if(A.length>0){return o("div",{className:"epkb-ai-training-data-container"},o("div",{className:"epkb-ai-sub-tabs"},o("div",{className:"epkb-ai-sub-tabs-nav"},A.map((e=>o("button",{key:e.id,className:`epkb-ai-sub-tab-button epkb-ai-sub-tab-${e.id} ${k===e.id?"active":""} ${D&&!e.is_add_new&&e.id!==k?"disabled":""}`,disabled:D&&!e.is_add_new&&e.id!==k,onClick:()=>{if(!D||e.id===k){if(e.is_add_new){N()}else{w(e.id)}}},title:D&&!e.is_add_new&&e.id!==k?d("Sync in progress. Please wait...","echo-knowledge-base"):""},e.icon&&o("span",{className:e.icon})," ",e.title))))),y&&o(x,{collection:y,config:{...p,is_ai_features_pro_enabled:c.is_ai_features_pro_enabled,is_access_manager_active:c.is_access_manager_active},hasApiKey:s,onDeleteCollection:v}),!y&&o("div",{className:"epkb-ai-empty-state"},o("p",null,d('No collections available. Click "Add New" to create one.',"echo-knowledge-base"))))}return o("div",{className:"epkb-ai-training-data-container"},o("div",{className:"epkb-ai-empty-state"},o("p",null,d("No training data configuration available.","echo-knowledge-base"))))};const S=e=>o(y,null,o(A,e));window.EPKB_AI_TrainingData={AIAdminTrainingData:S}})();