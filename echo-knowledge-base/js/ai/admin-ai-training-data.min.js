(function(){"use strict";const{useState:e,useEffect:t,useCallback:n,createElement:o,Fragment:a,createContext:s,useContext:i,useMemo:l,useRef:c}=wp.element;const{__:r,sprintf:d}=wp.i18n;const{showError:p,showSuccess:g,makeApiRequest:u,showConfirmDialog:b,showLoadingDialog:f,clearAllEPKBSessionStorage:h,TutorialButton:m,SetupStepsGuide:k}=window.EPKB_AI_Util_React||{};const{logError:_}=window.EPKBChatUtils||{};const{SyncControls:w,SyncProgressBar:y}=window.EPKB_AI_Sync?{SyncControls:window.EPKB_AI_SyncControls,SyncProgressBar:window.EPKB_AI_SyncProgressBar}:{};const x=s();window.EPKB_AI_TrainingDataCacheContext=x;const v=({children:n})=>{const a=()=>{try{const e=sessionStorage.getItem("epkb_ai_training_data_cache");return e?JSON.parse(e):{}}catch(e){return{}}};const[s,i]=e(a);t((()=>{h();i({})}),[]);t((()=>{const e=()=>{if(document.visibilityState==="visible"){h();i({})}};document.addEventListener("visibilitychange",e);return()=>{document.removeEventListener("visibilitychange",e)}}),[]);t((()=>{const e=()=>{h()};window.addEventListener("beforeunload",e);return()=>{window.removeEventListener("beforeunload",e)}}),[]);t((()=>{try{sessionStorage.setItem("epkb_ai_training_data_cache",JSON.stringify(s))}catch(e){if(e.name==="QuotaExceededError"){i({});try{sessionStorage.removeItem("epkb_ai_training_data_cache")}catch(e){}}else{}}}),[s]);const c=l((()=>({get:e=>s[e],set:(e,t)=>{i((n=>({...n,[e]:{...t,timestamp:Date.now()}})))},remove:e=>{i((t=>{const n={...t};delete n[e];return n}))},clear:()=>{i({});h()},clearCollection:e=>{i((t=>{const n={...t};Object.keys(n).forEach((t=>{if(t.startsWith(`collection_${e}_`)){delete n[t]}}));return n}))},clearNonExistentCollections:e=>{i((t=>{const n={...t};Object.keys(n).forEach((t=>{const o=t.match(/^collection_(\d+)_/);if(o){const a=parseInt(o[1]);if(!e.includes(a)){delete n[t]}}}));return n}))}})),[s]);return o(x.Provider,{value:c},n)};const A=()=>{const e=i(x);if(!e){throw new Error("useTrainingDataCache must be used within TrainingDataCacheProvider")}return e};const C=window.EPKB_AI_DataSourceTable||(()=>o("div",null,"DataSourceTable component not loaded"));const N=({isOpen:n,onClose:s,onSave:i,noteData:l=null,collectionId:c,onDelete:d=null})=>{const[p,g]=e("");const[u,b]=e("");const[f,h]=e(false);const[m,k]=e(false);const[w,y]=e(false);t((()=>{if(!n||!l)return;g(l.title||"");if(l.training_id&&!l.content){k(true);b("");const{makeApiRequest:e,showError:t}=window.EPKB_AI_Util_React||{};if(e){e(`training-data/${l.training_id}/content`,{method:"GET"}).then((e=>{if(e&&e.data){b(e.data.processed_content||e.data.doc_content||"")}})).catch((e=>{_("AI Training Data","Failed to fetch note content",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:l?.id});if(t){t(r("Failed to load note content","echo-knowledge-base"))}})).finally((()=>{k(false)}))}else{_("AI Training Data","makeApiRequest not available",{context:"Note content loading"});k(false)}}else{b(l.content||"")}}),[n,l]);if(!n)return null;const x=async()=>{const{showError:e}=window.EPKB_AI_Util_React||{};if(!p.trim()||!u.trim()){if(e){e(r("Please enter both title and content for the note","echo-knowledge-base"))}return}h(true);try{await i({title:p,content:u,id:l?.id,training_id:l?.training_id});g("");b("");s()}catch(e){_("AI Training Data","Error saving note",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:l?.id})}finally{h(false)}};const v=async()=>{const{showConfirmDialog:e,makeApiRequest:t,showSuccess:n,showError:o}=window.EPKB_AI_Util_React||{};if(!e||!t){_("AI Training Data","Required utilities not available",{context:"Note deletion",missing:{confirmDialog:!e,apiRequest:!t}});if(o){o(r("Unable to delete note. Please refresh the page and try again.","echo-knowledge-base"))}return}const a=await e({title:r("Delete Note","echo-knowledge-base"),message:r("Are you sure you want to delete this note? This action cannot be undone.","echo-knowledge-base"),confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!a)return;y(true);try{const e=await t(`training-notes/${l.id}`,{method:"DELETE"});if(e&&e.success){if(n){n(r("Note deleted successfully","echo-knowledge-base"))}g("");b("");s();if(d){d(l.id)}}}catch(e){_("AI Training Data","Error deleting note",{message:e.message||"Unknown error",code:e.code,status:e.status,noteId:item?.id});if(!e._errorDisplayed&&o){o(e.message||r("Failed to delete note","echo-knowledge-base"))}}finally{y(false)}};const A=c?`admin.php?page=aipro-all-notes&collection_id=${c}`:"admin.php?page=aipro-all-notes";return o("div",{className:"epkb-ai-dialog-overlay",onClick:s},o("div",{className:"epkb-ai-dialog epkb-ai-notes-dialog",onClick:e=>e.stopPropagation()},o("div",{className:"epkb-ai-dialog-header"},o("div",{className:"epkb-ai-dialog-header-left"},o("h3",null,l?r("Edit Note","echo-knowledge-base"):r("Add Note","echo-knowledge-base")),o("a",{href:A,className:"epkb-ai-all-notes-btn",target:"_blank",rel:"noopener",title:r("View and manage all notes (opens in new tab)","echo-knowledge-base")},o("span",{className:"epkbfa epkbfa-sticky-note"}),r("All Notes","echo-knowledge-base"))),o("button",{className:"epkb-ai-dialog-close",onClick:s},o("span",{className:"epkbfa epkbfa-times"}))),o("div",{className:"epkb-ai-dialog-body"},m?o("div",{style:{padding:"40px",textAlign:"center"}},o("div",{className:"epkb-ai-loading-spinner"}),o("p",{style:{marginTop:"20px",color:"#666"}},r("Loading note content...","echo-knowledge-base"))):o(a,null,o("div",{className:"epkb-ai-form-group"},o("label",null,r("Note Title","echo-knowledge-base")),o("input",{type:"text",className:"epkb-ai-form-control",value:p,onChange:e=>g(e.target.value),placeholder:r("Enter note title...","echo-knowledge-base"),disabled:m})),o("div",{className:"epkb-ai-form-group"},o("label",null,r("Note Content","echo-knowledge-base")),o("textarea",{className:"epkb-ai-form-control",rows:10,value:u,onChange:e=>b(e.target.value),placeholder:r("Enter note content...","echo-knowledge-base"),disabled:m})))),o("div",{className:"epkb-ai-dialog-footer",style:{display:"flex",justifyContent:"space-between",alignItems:"center"}},o("div",null,l?.id&&o("button",{className:"epkb-ai-button epkb-ai-button-danger",onClick:v,disabled:w||m||f,style:{backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff"}},w?r("Deleting...","echo-knowledge-base"):r("Delete Note","echo-knowledge-base"))),o("div",{style:{display:"flex",gap:"10px"}},o("button",{className:"epkb-ai-button epkb-ai-button-secondary",onClick:s,disabled:m||w},r("Cancel","echo-knowledge-base")),o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:x,disabled:f||m||w},f?r("Saving...","echo-knowledge-base"):r("Save Note","echo-knowledge-base"))))))};const S=({collectionId:n,collection:s,config:i,onSyncStart:l=null,onActionChange:c=null,hasApiKey:f=true,isDeletingDialogOpen:h=false,selectedRecordsCount:m=0,selectedIds:k=[],selectedItemsInfo:y={},trainingData:x=[],bulkDeleteHandler:v=null,onDeleteCollection:A=null,collectionName:C="",onSelectAll:N=null,isAllSelected:S=false,onTableRefresh:D=null,isFiltered:I=false,isSelectAllActive:T=false,totalItems:E=0,statusCounts:P={},isAIProEnabled:$=false,isNotesDialogOpen:B=false,editingNote:L=null,onNoteAdd:R=null,onNoteDialogClose:K=null,handleSaveNote:j=null,isSyncing:O=false,activeStatusTab:U="all",controlledActiveAction:q=undefined,onActiveActionChange:z=null})=>{const[F,W]=e((()=>O?"sync":null));const M=q!==undefined?q:F;const H=z||W;const[G,J]=e([]);const[V,Q]=e(false);const[X,Y]=e(C);const[Z,ee]=e(C);const[te,ne]=e(false);const[oe,ae]=e(null);const[se,ie]=e(false);const le=async()=>{if(se||oe)return;ie(true);try{const e=await u(`training-collections/${n}/post-stats`,{method:"GET"});if(e.success&&e.post_types_status){ae(e.post_types_status)}}catch(e){_("AI Training Data","Failed to load post stats",{message:e.message||"Unknown error",collectionId:n});ae({})}finally{ie(false)}};t((()=>{if(M==="add"&&!oe&&!se){const e=s&&s.config&&s.config.ai_training_data_store_post_types_options;if(e==="load_on_demand"){le()}}}),[M,s,oe,se]);t((()=>{Y(C);ee(C)}),[C,n]);const ce=()=>{if(T){if(U!=="all"){return P[U]||0}return E}if(U!=="all"){return Object.keys(y).filter((e=>y[e]&&y[e].status===U)).length}return k.length};t((()=>{if(c){c(M)}}),[M,c]);t((()=>{if(O&&M!=="sync"){H("sync")}}),[O]);const[re,de]=e(false);const pe=async()=>{if(!X.trim()){p(r("Collection name cannot be empty","echo-knowledge-base"));return}ne(true);try{const e=await u(`training-collections/${n}`,{method:"PUT",data:{name:X}});if(e.success){g(r("Collection name updated successfully","echo-knowledge-base"));setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_sub_tab",`collection-${n}`);window.location.href=e.toString()}),1e3)}}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){p(e.message||r("Failed to update collection name","echo-knowledge-base"))}}finally{ne(false)}};const ge=async()=>{const e=await b({title:r("Delete Collection","echo-knowledge-base"),message:`${r("Are you sure you want to delete this collection?","echo-knowledge-base")}\n\n${r("Type the collection name to confirm:","echo-knowledge-base")} "${C}"`,confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger",requireInput:true,inputPlaceholder:r("Enter collection name","echo-knowledge-base"),inputMatch:C});if(!e){return}de(true);try{const e=await u(`training-collections/${n}`,{method:"DELETE"});if(e.success){g(r("Collection deleted successfully","echo-knowledge-base"));if(A){A(n)}}}catch(e){_("AI Training Data","Delete collection error",{message:e.message||"Unknown error",code:e.code,status:e.status,collectionId:item?.id,collectionName:item?.name});if(e.message!=="API key required"&&!e._errorDisplayed){p(e.message||r("Failed to delete collection","echo-knowledge-base"))}}finally{}};const ue=async()=>{if(G.length===0){p(r("Please select at least one data type","echo-knowledge-base"));return}Q(true);try{const e=await u(`training-collections/${n}/add-data`,{method:"POST",data:{data_types:G}});if(e.success){const t=e.message||r("Data added successfully","echo-knowledge-base");const n=t+" "+r("to","echo-knowledge-base")+' "'+C+'"';g(n);J([]);ae(null);if(D){D()}le()}}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){p(e.message||r("Failed to add data","echo-knowledge-base"))}}finally{Q(false)}};if(!M){return o("div",{className:"epkb-ai-data-source-settings"},o("h3",{className:"epkb-ai-data-source-heading"},r("Choose an Action","echo-knowledge-base")),o("div",{className:"epkb-ai-action-buttons"},o("button",{className:`epkb-ai-button epkb-ai-button-secondary epkb-ai-action-choose-data ${O?"disabled":""}`,onClick:()=>!O&&H("add"),disabled:O,title:O?r("Cannot change actions while sync is in progress","echo-knowledge-base"):""},o("span",null,"1. "+r("Choose Training Data","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"})),o("button",{className:"epkb-ai-button epkb-ai-button-secondary epkb-ai-action-sync-data",onClick:()=>H("sync")},o("span",null,"2. "+r("Send Data to AI","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"})),o("button",{className:`epkb-ai-button epkb-ai-button-secondary ${O?"disabled":""}`,onClick:()=>!O&&H("remove"),disabled:O,title:O?r("Cannot change actions while sync is in progress","echo-knowledge-base"):""},o("span",null,r("Other Actions","echo-knowledge-base")),o("span",{className:"epkbfa epkbfa-caret-right"}))),o("div",{className:"epkb-ai-action-info notice notice-info"},o("h4",null,r("How to get started","echo-knowledge-base")),o("div",{style:{marginTop:"15px",marginBottom:"15px"}},o("p",{style:{marginBottom:"10px"}},"1. ",o("strong",null,r("Choose Training Data","echo-knowledge-base"))," — ",r("Pick the content types to include.","echo-knowledge-base")),o("p",{style:{marginBottom:"10px"}},"2. ",o("strong",null,r("Send Data to AI","echo-knowledge-base"))," — ",r("Select items in the table, then sync them.","echo-knowledge-base")),o("p",{style:{marginBottom:"10px"}},"3. ",o("strong",null,r("Other Actions","echo-knowledge-base"))," — ",r("Rename the collection or delete items.","echo-knowledge-base"))),o("p",null,r("Tip: Start with a small set to test the flow.","echo-knowledge-base"))))}const be=()=>{switch(M){case"add":return r("Add Training Data","echo-knowledge-base");case"sync":return r("Send Data to AI","echo-knowledge-base");case"remove":return r("Other Actions","echo-knowledge-base");default:return""}};return o("div",{className:"epkb-ai-data-source-settings"},o("button",{className:`epkb-ai-back-button ${O?"disabled":""}`,onClick:()=>{if(!O){H(null)}},disabled:O,title:O?r("Cannot navigate while sync is in progress","echo-knowledge-base"):""},o("span",{className:"epkbfa epkbfa-chevron-left"}),r("Back","echo-knowledge-base")),o("h3",{style:{marginBottom:"20px",fontSize:"24px",fontWeight:"600",borderBottom:"2px solid #d0d0d0",paddingBottom:"10px"}},be()),M==="add"&&o("div",{className:"epkb-ai-action-content"},o("div",{className:"epkb-ai-collection-indicator",style:{backgroundColor:"#e7f5ff",border:"1px solid #1e88e5",borderRadius:"4px",padding:"12px 15px",marginBottom:"20px",display:"flex",alignItems:"center",gap:"10px"}},o("span",{className:"epkbfa epkbfa-info-circle",style:{color:"#1e88e5"}}),o("span",{style:{color:"#333",fontWeight:"500"}},r("Adding data to:","echo-knowledge-base")+" "),o("strong",{style:{color:"#1e88e5"}},C)),o("p",{style:{color:"#666",marginBottom:"15px"}},r("Choose which content types you want to include in your AI training data.","echo-knowledge-base")),(()=>{const e=s&&s.config&&s.config.ai_training_data_store_post_types_options;const t=oe?oe:s&&s.config&&s.config.ai_training_data_store_post_types_options&&s.config.ai_training_data_store_post_types_options!=="load_on_demand"?s.config.ai_training_data_store_post_types_options:i&&i.available_post_types||{};const n=t["aipro_ai_note"];if(!n)return null;const a=typeof n==="object"&&n!==null;const l=a?n.label:n;const c=a?n:{available:true,new_items:1};const d=i.is_ai_features_pro_enabled;const p=!d||a&&c.requires_ai_pro;const g=()=>{const e=document.createElement("div");e.style.cssText="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:9999999;";const t=document.createElement("div");t.style.cssText="background:white;border-radius:8px;padding:24px;max-width:450px;width:90%;box-shadow:0 4px 20px rgba(0,0,0,0.15);";t.innerHTML=`\n\t\t\t\t\t\t\t<h3 style="margin:0 0 16px 0;font-size:18px;font-weight:600;">${r("Additional Notes","echo-knowledge-base")}</h3>\n\t\t\t\t\t\t\t<p style="margin:0 0 20px 0;color:#555;line-height:1.6;">${r("Add additional support and miscellaneous information not found in articles, posts, and pages that AI should also know about.","echo-knowledge-base")}</p>\n\t\t\t\t\t\t\t<p style="margin:0 0 20px 0;color:#555;line-height:1.6;">${r("Examples: business hours, contact information, company policies, product details, or any other information you want the AI to reference.","echo-knowledge-base")}</p>\n\t\t\t\t\t\t\t<div style="display:flex;justify-content:flex-end;">\n\t\t\t\t\t\t\t\t<button class="epkb-ai-button epkb-ai-button-primary" style="padding:8px 20px;">${r("Got it","echo-knowledge-base")}</button>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t`;e.appendChild(t);document.body.appendChild(e);const n=()=>document.body.removeChild(e);t.querySelector("button").addEventListener("click",n);e.addEventListener("click",(t=>{if(t.target===e)n()}))};return o("div",{key:"aipro_ai_note_top",style:{marginBottom:"20px",padding:"15px",backgroundColor:"#f8f9fa",borderRadius:"6px",border:"1px solid #e0e0e0"}},o("div",{style:{display:"flex",alignItems:"center",marginBottom:"8px",opacity:p?"0.6":"1"}},o("span",{className:"epkbfa epkbfa-file-text-o",style:{marginRight:"10px",color:"#666",fontSize:"16px",width:"16px",textAlign:"center"}}),o("span",{style:{fontWeight:"600",fontSize:"15px"}},l),o("span",{className:"epkbfa epkbfa-question-circle",onClick:g,style:{marginLeft:"8px",color:"#0073aa",cursor:"pointer",fontSize:"16px"}}),d&&c.already_added>0&&o("span",{style:{marginLeft:"10px",fontSize:"0.9em",color:"#666"}},`(${c.already_added} ${r("added","echo-knowledge-base")})`)),p?o("div",{style:{color:"#1e88e5",fontSize:"0.9em",marginTop:"5px"}},r("Requires AI Advanced Features plugin.","echo-knowledge-base")," ",o("a",{href:"https://www.echoknowledgebase.com/wordpress-plugin/ai-features/",target:"_blank",rel:"noopener noreferrer",style:{color:"#1e88e5",textDecoration:"underline"}},r("Learn More","echo-knowledge-base"))):o("div",{style:{marginTop:"8px"}},o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:R,style:{padding:"8px 16px",fontSize:"13px",backgroundColor:"#00a32a",borderColor:"#00a32a",color:"#fff"}},o("span",{className:"epkbfa epkbfa-plus",style:{marginRight:"5px"}}),r("Add Note","echo-knowledge-base"))))})(),i.is_access_manager_active&&o("div",{className:"epkb-ai-access-manager-warning",style:{backgroundColor:"#fee",border:"1px solid #dc3545",borderRadius:"4px",padding:"15px",marginBottom:"20px",color:"#721c24"}},o("strong",{style:{display:"block",marginBottom:"5px"}},r("Access Manager Notice","echo-knowledge-base")),o("span",null,r("Currently only publicly accessible articles can be uploaded to AI. Articles with access restrictions will not be included in the training data.","echo-knowledge-base"))),(()=>{const e=s&&s.config&&s.config.ai_training_data_store_post_types_options;if(e==="load_on_demand"&&!oe){if(se){return o("div",{style:{padding:"20px",textAlign:"center"}},o("div",{className:"epkb-ai-loading-spinner"}),o("p",{style:{marginTop:"10px",color:"#666"}},r("Loading content types...","echo-knowledge-base")))}return o("div",{style:{padding:"20px",textAlign:"center"}},o("p",{style:{color:"#666"}},r("Loading content types...","echo-knowledge-base")))}const t=oe?oe:s&&s.config&&s.config.ai_training_data_store_post_types_options&&s.config.ai_training_data_store_post_types_options!=="load_on_demand"?s.config.ai_training_data_store_post_types_options:i&&i.available_post_types||{};const n=Object.entries(t);return o("div",{className:"epkb-ai-checkbox-list"},n.length>0?n.map((([e,t])=>{if(e==="aipro_ai_note")return null;const n=typeof t==="object"&&t!==null;const a=n?t.label:t;const s=n?t:{available:true,new_items:1};const i=n&&s.requires_ai_pro;const l=i||!s.available||s.new_items!=="500+"&&s.new_items===0;return o("div",{key:e,style:{marginBottom:"15px"}},o("label",{style:{display:"flex",alignItems:"center",marginBottom:"5px",cursor:l?"not-allowed":"pointer",opacity:l?"0.6":"1"}},o("input",{type:"checkbox",checked:G.includes(e),disabled:l,onChange:t=>{if(!l){if(t.target.checked){J([...G,e])}else{J(G.filter((t=>t!==e)))}}},style:{marginRight:"10px"}}),o("span",{style:{fontWeight:"500"}},a),n&&!i&&o("span",{style:{marginLeft:"10px",fontSize:"0.9em",color:"#666"}},(()=>{const e=[];if(s.new_items==="500+"||s.new_items>0){const t=s.new_items==="500+"?"500+":s.new_items;e.push(`${t} ${r("available","echo-knowledge-base")}`)}if(s.already_added>0){e.push(`${s.already_added} ${r("added","echo-knowledge-base")}`)}const t=(s.linked_articles||0)+(s.password_protected||0)+(s.excluded||0);if(t>0&&s.available){e.push(`${t} ${r("excluded","echo-knowledge-base")}`)}return e.length>0?`(${e.join(", ")})`:""})())),i&&o("div",{style:{marginLeft:"25px",color:"#1e88e5",fontSize:"0.9em",marginTop:"5px"}},r("Requires AI Advanced Features plugin.","echo-knowledge-base")," ",o("a",{href:"https://www.echoknowledgebase.com/wordpress-plugin/ai-features/",target:"_blank",rel:"noopener noreferrer",style:{color:"#1e88e5",textDecoration:"underline"}},r("Learn More","echo-knowledge-base"))),l&&!i&&o("div",{style:{marginLeft:"25px",color:s.already_added>0?"#008a20":"#dc3545",fontSize:"0.9em",fontStyle:"italic"}},(()=>{if(s.already_added>0){return r("All eligible items already added to collection","echo-knowledge-base")}const t=(s.linked_articles||0)+(s.password_protected||0)+(s.excluded||0);if(t>0){const e=[];if(s.password_protected>0){e.push(`${s.password_protected} password-protected`)}if(s.linked_articles>0){e.push(`${s.linked_articles} linked`)}if(s.excluded>0){e.push(`${s.excluded} restricted`)}return`${r("No eligible content","echo-knowledge-base")} (${e.join(", ")})`}if(e.startsWith("epkb_post_type_")){return d(r("No articles for %s found. First create and publish articles.","echo-knowledge-base"),a)}return d(r("No %s found. First create and publish %s.","echo-knowledge-base"),a,a.toLowerCase())})()))})):o("p",{style:{color:"#888"}},r("No content types available.","echo-knowledge-base")))})(),o("div",{style:{marginTop:"20px"}},o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:ue,disabled:V||G.length===0},V?r("Adding Data...","echo-knowledge-base"):r("Add Data","echo-knowledge-base")))),M==="sync"&&o("div",{className:"epkb-ai-action-content"},(()=>{let e;let t=m;if(T){if(U!=="all"){e=`ALL_${U.toUpperCase()}`}else{e="ALL"}}else{if(U!=="all"){e=k.filter((e=>{const t=y[e];return t&&t.status===U})).map((e=>y[e].item_id));t=e.length}else{e=k.map((e=>{const t=y[e];if(t){return t.item_id}const n=x.find((t=>t.id===e));return n?n.item_id:null})).filter((e=>e!==null))}}return o(a,null,w&&o(w,{collectionId:n,selectedPostIds:e,disabled:!f||h||e!=="ALL"&&typeof e!=="string"&&e.length===0,hasApiKey:f,onSelectAll:N,isAllSelected:S,selectedRecordsCount:t,isFiltered:I,onSyncStart:l,isSelectAllActive:T,activeStatusTab:U,trainingData:x}))})(),o("p",{style:{color:"#666",marginTop:"15px",fontSize:"14px"}},r("Select items from the table and choose a sync method to update your AI training data.","echo-knowledge-base"))),M==="remove"&&o("div",{className:"epkb-ai-action-content"},o("p",{style:{color:"#666",marginBottom:"20px"}},r("Manage your collection settings and data.","echo-knowledge-base")),o("div",{className:"epkb-ai-collection-name-section",style:{marginBottom:"30px"}},o("h4",{style:{marginBottom:"10px",fontSize:"16px",fontWeight:"600"}},r("Collection Name","echo-knowledge-base"),o("span",{style:{color:"#999",fontWeight:"normal",fontSize:"14px",marginLeft:"10px"}},`(ID: ${n})`)),o("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},o("input",{type:"text",value:X,onChange:e=>Y(e.target.value),style:{padding:"8px 12px",border:"1px solid #ddd",borderRadius:"4px",fontSize:"14px",flex:"1",maxWidth:"400px"},placeholder:r("Enter collection name","echo-knowledge-base")}),o("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:pe,disabled:te||X===Z,style:{padding:"8px 20px",cursor:te||X===Z?"not-allowed":"pointer",opacity:te||X===Z?.5:1}},te?r("Saving...","echo-knowledge-base"):r("Save","echo-knowledge-base"))),o("p",{style:{marginTop:"8px",color:"#666",fontSize:"13px"}},r("Change the display name for this collection.","echo-knowledge-base"))),o("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #e5e5e5"}}),(()=>null)(),o("div",{className:"epkb-ai-delete-selected-section",style:{marginBottom:"25px"}},o("div",{style:{display:"flex",alignItems:"center",gap:"15px"}},o("button",{id:"epkb-ai-delete-selected-btn",className:"epkb-ai-button epkb-ai-button-danger",onClick:e=>{e.preventDefault();e.stopPropagation();if(v&&typeof v==="function"){try{v()}catch(e){_("AI Training Data","Error calling bulkDeleteHandler",{message:e.message||"Unknown error",selectedCount:k.length})}}else{_("AI Training Data","bulkDeleteHandler is not a function",{type:typeof v,handler:v});p(r("Unable to delete items. Please refresh the page and try again.","echo-knowledge-base"))}},disabled:!v||ce()===0,style:{padding:"10px 20px",backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff",cursor:!v||ce()===0?"not-allowed":"pointer",opacity:!v||ce()===0?.5:1}},r("Delete Selected","echo-knowledge-base")),o("span",{style:{color:"#666",fontSize:"14px"}},`${ce()} ${r("Selected Records","echo-knowledge-base")}`)),o("p",{style:{marginTop:"10px",color:"#666",fontSize:"13px"}},r("Delete the selected training data items from this collection.","echo-knowledge-base"))),o("hr",{style:{margin:"30px 0",border:"none",borderTop:"1px solid #e5e5e5"}}),o("div",{className:"epkb-ai-delete-collection-section"},o("button",{className:"epkb-ai-button epkb-ai-button-danger epkb-ai-delete-collection-btn",onClick:ge,disabled:re,style:{padding:"10px 20px",backgroundColor:"#d63638",borderColor:"#d63638",color:"#fff",cursor:re?"not-allowed":"pointer"}},re?r("Deleting...","echo-knowledge-base"):r("Delete Collection","echo-knowledge-base")),o("p",{style:{marginTop:"10px",color:"#666",fontSize:"13px"}},r("This will permanently delete all training data in this collection.","echo-knowledge-base")))))};const D=({collection:s,config:l,hasApiKey:c,onDeleteCollection:d})=>{const[b,f]=e(false);const[h,m]=e(false);const[k,_]=e(false);const[w,y]=e([]);const[x,v]=e({});const[A,D]=e([]);const[I,T]=e(null);const[E,P]=e(null);const[$,B]=e(0);const[L,R]=e((()=>{if(s&&s.stats){return{added:0,updated:0,outdated:0,error:0,pending:0,...s.stats}}return{}}));const[K,j]=e(0);const[O,U]=e(false);const[q,z]=e(false);const[F,W]=e(false);const[M,H]=e(null);const[G,J]=e("all");const[V,Q]=e("all");const[X,Y]=e(null);const Z=E&&w.length>0&&$>0&&w.length===$;const ee=n((e=>{H(e);W(true)}),[]);const te=n((async e=>{try{const t=await u("training-notes",{method:e.id?"PUT":"POST",data:{collection_id:s.id,title:e.title,content:e.content,note_id:e.id,training_id:e.training_id}});if(t.success){g(e.id?r("Note updated successfully","echo-knowledge-base"):r("Note added successfully","echo-knowledge-base"));j((e=>e+1));W(false);H(null)}}catch(e){if(e.code==="ai_pro_class_missing"){p(r("AI Features Pro is not properly configured. Please ensure the plugin is activated.","echo-knowledge-base"))}else if(!e._errorDisplayed){p(e.message||r("Failed to save note","echo-knowledge-base"))}throw e}}),[s.id]);const ne=window.EPKB_AI_SyncContext?i(window.EPKB_AI_SyncContext):null;t((()=>{if(ne&&ne.job){const e=ne.job.status;if(e==="running"||e==="scheduled"){f(true);Y("sync")}}}),[]);t((()=>{if(ne&&ne.job){const e=ne.job.status;if(e==="completed"||e==="canceled"||e==="idle"){f(false)}else if(e==="running"||e==="scheduled"){f(true)}}}),[ne?.job?.status]);const oe=n((e=>{T((()=>e))}),[]);const ae=n((e=>{const t=t=>{z(t);if(t&&A.length>0){const e={};A.forEach((t=>{e[t.id]={status:t.status,item_id:t.item_id}}));v((t=>({...t,...e})))}if(e){e(t)}};P((()=>t))}),[A]);const se=n((e=>{Y(e);if(e===null){f(false)}if(e==="add"){y([]);v({});z(false)}}),[]);const ie=n(((e,t=false)=>{y(e);if(e.length===0){v({});return}if(t&&e.length>0&&X!=="remove"){Y("sync")}v((t=>{const n={};e.forEach((e=>{const o=A.find((t=>t.id===e));if(o){n[e]={status:o.status,item_id:o.item_id}}else if(t[e]){n[e]=t[e]}}));return n}))}),[A,X]);const le=n((()=>{if(q){return $}if(G==="all"||G==="sync"){return w.length}let e=0;w.forEach((t=>{const n=A.find((e=>e.id===t));if(n&&n.status===G){e++}}));return e}),[q,$,G,w,A]);const ce=n((()=>{j((e=>e+1))}),[]);const re=n((()=>{f(true);setTimeout((()=>{v({})}),100)}),[]);const de=n((e=>{J(e);if(e!=="sync"){Q(e)}}),[]);const pe=n((e=>{R(e)}),[]);t((()=>{if(A.length>0&&w.length>0){v((e=>{const t={...e};A.forEach((e=>{if(w.includes(e.id)){t[e.id]={status:e.status,item_id:e.item_id}}}));return t}))}}),[A,w]);t((()=>{if(!l.is_ai_features_pro_enabled)return;const e=()=>{const e=document.querySelector(".epkb-ai-table-actions-right");if(!e||e.querySelector(".epkb-ai-all-notes-btn"))return;const t=document.createElement("a");t.className="epkb-ai-all-notes-btn epkb-ai-button";t.href="admin.php?page=aipro-all-notes";t.target="_blank";t.rel="noopener";t.innerHTML='<span class="epkbfa epkbfa-sticky-note"></span> '+r("All Notes","echo-knowledge-base");t.title=r("View and manage all notes (opens in new tab)","echo-knowledge-base");const n=e.querySelector(".epkb-ai-search-input");if(n){e.insertBefore(t,n)}else{e.prepend(t)}};e();const t=new MutationObserver(e);t.observe(document.body,{childList:true,subtree:true});return()=>t.disconnect()}),[l.is_ai_features_pro_enabled]);const ge=o(a,null,l.is_ai_features_pro_enabled&&o(N,{isOpen:F,onClose:()=>{W(false);H(null)},onSave:te,onDelete:()=>{j((e=>e+1))},noteData:M,collectionId:s.id}),o("div",{className:"epkb-ai-data-collection-wrapper"},o("div",{className:"epkb-ai-data-source-layout"},o(C,{key:`table-${s.id}`,collectionId:s.id,collectionName:s.name,hasApiKey:c,onSelectedIdsChange:ie,onBulkDeleteCallback:oe,onSelectAllCallback:ae,onTotalItemsChange:B,onTrainingDataChange:D,refreshTrigger:K,isSyncing:b,onFilterStateChange:U,initialStats:s.stats||null,initialData:s.preloaded_data||null,selectedIds:w,onNoteEdit:ee,isAIProEnabled:l.is_ai_features_pro_enabled||false,onActiveStatusTabChange:de,onStatusCountsChange:pe}),o(S,{key:`settings-${s.id}`,collectionId:s.id,collection:s,config:l,onSyncStart:re,onActionChange:se,hasApiKey:c,isDeletingDialogOpen:k,controlledActiveAction:X,onActiveActionChange:Y,selectedRecordsCount:(()=>{if(q){if(V!=="all"){return L[V]||0}return $}if(V!=="all"){return Object.keys(x).filter((e=>x[e]&&x[e].status===V)).length}return w.length})(),selectedIds:w,selectedItemsInfo:x,trainingData:A,bulkDeleteHandler:I,onDeleteCollection:d,collectionName:s.name,onSelectAll:E,isAllSelected:q,onTableRefresh:ce,isFiltered:O,isSelectAllActive:q,totalItems:$,statusCounts:L,isAIProEnabled:l.is_ai_features_pro_enabled||false,isNotesDialogOpen:F,editingNote:M,onNoteAdd:()=>{H(null);W(true)},onNoteDialogClose:()=>{W(false);H(null)},handleSaveNote:te,isSyncing:b,activeStatusTab:V}))));return ge};const I=({settings:n,tabData:a,hasApiKey:s,onTabSwitch:l})=>{const c=a||{};const d=c.ai_config||{};d.available_post_types=c.available_post_types||{};d.is_wp_cron_disabled=c.is_wp_cron_disabled||false;const b=c.data_collections||[];const[h,_]=e(b);const w=A();t((()=>{const e=h.map((e=>e.id));w.clearNonExistentCollections(e)}),[]);const[y,x]=e((()=>{const e=new URL(window.location.href);const t=e.searchParams.get("active_sub_tab");if(t&&t.startsWith("collection-")){const e=parseInt(t.replace("collection-",""));if(h.some((t=>t.id===e))){return t}}const n=sessionStorage.getItem("epkb_new_collection_id");if(n&&h.some((e=>e.id===parseInt(n)))){sessionStorage.removeItem("epkb_new_collection_id");return`collection-${n}`}return h.length>0?`collection-${h[0].id}`:"add-new"}));const v=y.startsWith("collection-")?h.find((e=>`collection-${e.id}`===y)):null;const C=e=>{const t=h.filter((t=>t.id!==e));_(t);setTimeout((()=>{window.location.reload()}),1e3)};const N=d?.ai_disclaimer_accepted==="on";if(!N){const{DisclaimerRequiredMessage:e}=window.EPKB_AI_Util_React||{};if(e){return o(e,{i18n:n?.i18n||{},onAccept:()=>{if(l){l("general-settings")}else{const e=new URL(window.location.href);if(e.searchParams.has("page")){e.searchParams.set("active_tab","general-settings");window.location.href=e.toString()}}}})}}const S=async()=>{const e=c.next_collection_id;if(!e){p(r("Unable to determine next collection ID","echo-knowledge-base"));return}const t=f?f(r("Creating new collection...","echo-knowledge-base")):null;w.clearCollection(e);try{const n=await u("training-collections",{method:"POST",data:{collection_id:e,name:r("Data Collection","echo-knowledge-base")+" "+e}});if(n.success){g(r("Collection created successfully","echo-knowledge-base"));sessionStorage.setItem("epkb_new_collection_id",n.collection_id||e);setTimeout((()=>{window.location.reload()}),1e3)}else{if(t&&typeof t.close==="function"){t.close()}}}catch(e){if(t&&typeof t.close==="function"){t.close()}if(!e._errorDisplayed){p(e.message||r("Failed to create collection","echo-knowledge-base"))}}};const I=c.sub_tabs?Object.values(c.sub_tabs):[];const T=window.EPKB_AI_SyncContext?i(window.EPKB_AI_SyncContext):null;const E=T&&T.job&&(T.job.status==="running"||T.job.status==="scheduled");if(I.length>0){return o("div",{className:"epkb-ai-training-data-container"},k&&o(k,{setupSteps:c?.setup_steps,onTabSwitch:l}),o("div",{className:"epkb-ai-sub-tabs"},o("div",{className:"epkb-ai-sub-tabs-header"},o("div",{className:"epkb-ai-sub-tabs-nav"},I.map((e=>o("button",{key:e.id,className:`epkb-ai-sub-tab-button epkb-ai-sub-tab-${e.id} ${y===e.id?"active":""} ${E&&!e.is_add_new&&e.id!==y?"disabled":""}`,disabled:E&&!e.is_add_new&&e.id!==y,onClick:()=>{if(!E||e.id===y){if(e.is_add_new){S()}else{x(e.id)}}},title:E&&!e.is_add_new&&e.id!==y?r("Sync in progress. Please wait...","echo-knowledge-base"):""},e.icon&&o("span",{className:e.icon})," ",e.title)))),m&&o(m,{url:"https://www.echoknowledgebase.com/documentation/step-2-add-ai-training-data/"}))),v&&o(D,{key:`collection-${v.id}`,collection:v,config:{...d,is_ai_features_pro_enabled:c.is_ai_features_pro_enabled,is_access_manager_active:c.is_access_manager_active},hasApiKey:s,onDeleteCollection:C}),!v&&o("div",{className:"epkb-ai-empty-state"},o("p",null,r('No collections available. Click "Add New" to create one.',"echo-knowledge-base"))))}return o("div",{className:"epkb-ai-training-data-container"},o("div",{className:"epkb-ai-empty-state"},o("p",null,r("No training data configuration available.","echo-knowledge-base"))))};const T=e=>o(v,null,o(I,e));window.EPKB_AI_TrainingData={AIAdminTrainingData:T}})();