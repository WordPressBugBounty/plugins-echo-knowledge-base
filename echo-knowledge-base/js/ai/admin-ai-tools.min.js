!function(){"use strict";const{useState:e,useEffect:a,useRef:s,createElement:o}=wp.element,{__:l}=wp.i18n,{showError:n,showSuccess:t,makeApiRequest:i}=window.EPKB_AI_Util_React||{};window.EPKB_AI_Tools={AIAdminTools:({settings:s,tabData:i})=>{const[c,d]=e("on"===i?.debug_enabled),[b,p]=e([]),[u,r]=e([]),[g,k]=e([]),[m,h]=e(""),[w,v]=e(""),[f,N]=e(""),[_,y]=e(!1),[C,E]=e(!1),[A,I]=e(!1),[j,P]=e(null),[T,x]=e(null),[D,O]=e([]),[L,S]=e([]),[R,F]=e([]),W="localhost"===window.location.hostname||"127.0.0.1"===window.location.hostname||window.location.hostname.includes(".local")||window.location.hostname.includes(".test");a(()=>{c&&(B(),M(),U(),H(),q())},[c]),a(()=>{K()},[m,D]),a(()=>{Q()},[w,L]),a(()=>{$()},[f,R]);const K=()=>{if(!D.length)return;if(!m)return void p(D);const e=D.filter(e=>"ai-related"===m?e.message&&(e.message.toLowerCase().includes("epkb")||e.message.toLowerCase().includes("ai")):e.level===m);p(e)},Q=()=>{if(!L.length)return;if(!w)return void r(L);const e=L.filter(e=>"ai-related"===w?e.message&&(e.message.toLowerCase().includes("epkb")||e.message.toLowerCase().includes("ai")):e.level===w);r(e)},$=()=>{if(!R.length)return;if(!f)return void k(R);const e=R.filter(e=>e.level===f);k(e)},B=async()=>{y(!0);try{const e=await jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_ai_get_php_error_logs",filter:"",_wpnonce:i?.nonce||""}});e.success?(O(e.data.logs||[]),m?K():p(e.data.logs||[])):n(e.data.message||l("Failed to load PHP logs","echo-knowledge-base"))}catch(e){n(l("Error loading PHP logs","echo-knowledge-base"))}finally{y(!1)}},M=async()=>{E(!0);try{const e=await jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_ai_get_wp_error_logs",filter:"",_wpnonce:i?.nonce||""}});e.success?(S(e.data.logs||[]),w?Q():r(e.data.logs||[])):n(e.data.message||l("Failed to load WP logs","echo-knowledge-base"))}catch(e){n(l("Error loading WP logs","echo-knowledge-base"))}finally{E(!1)}},U=async()=>{I(!0);try{const e=await jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_ai_get_ai_logs",filter:"",_wpnonce:i?.nonce||""}});e.success?(F(e.data.logs||[]),f?$():k(e.data.logs||[])):n(e.data.message||l("Failed to load AI logs","echo-knowledge-base"))}catch(e){n(l("Error loading AI logs","echo-knowledge-base"))}finally{I(!1)}},H=()=>{const e=i?.system_info||{},a={};Object.entries(e).forEach(([e,s])=>{e.includes("ai_")||e.includes("openai")||e.includes("vector")||(a[e]=s)}),P(a)},q=()=>{x({ai_config:i?.ai_config||{},data_collections:i?.data_collections||[],openai_status:i?.openai_status||{}})},J=e=>o("div",{className:`epkb-ai-log-entry epkb-ai-log-${e.level}`,key:`${e.timestamp}-${Math.random()}`},o("div",{className:"epkb-ai-log-header"},o("span",{className:"epkb-ai-log-timestamp"},e.timestamp),o("span",{className:`epkb-ai-log-level ${e.level}`},e.level)),o("div",{className:"epkb-ai-log-message"},e.message),e.context&&Object.keys(e.context).length>0&&o("div",{className:"epkb-ai-log-context"},o("pre",null,JSON.stringify(e.context,null,2))));return o("div",{className:"epkb-ai-tools-debug-container"},o("div",{className:"epkb-ai-debug-content"},o("h2",null,l("Debug Information","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-toggle-section"},o("h3",null,l("Debug Mode","echo-knowledge-base")),o("div",{className:"epkb-ai-setting-row"},o("label",{className:"epkb-ai-switch"},o("input",{type:"checkbox",checked:c,onChange:e=>(async e=>{try{const a=await jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_ai_toggle_debug_mode",enabled:e?"on":"off",_wpnonce:i?.nonce||""}});a.success?(d(e),t(l("Debug mode updated successfully","echo-knowledge-base")),setTimeout(()=>window.location.reload(),1e3)):n(a.data.message||l("Failed to update debug mode","echo-knowledge-base"))}catch(e){n(l("Error updating debug mode","echo-knowledge-base"))}})(e.target.checked)}),o("span",{className:"epkb-ai-slider"})),o("span",{className:"epkb-ai-setting-label"},l("Enable Debug Mode","echo-knowledge-base"),W&&o("span",{className:"epkb-ai-localhost-notice"},l(" (Localhost detected)","echo-knowledge-base")))),o("p",{className:"epkb-ai-setting-description"},l("Enable debug mode to view system logs and troubleshoot AI features. This will load additional debugging tools.","echo-knowledge-base"))),c?o("div",{className:"epkb-ai-debug-sections"},o("div",{className:"epkb-ai-debug-toggle-section"},o("h3",null,l("AI Information","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-section epkb-ai-ai-info"},o("div",null,o("div",{className:"epkb-ai-info-grid"},o("div",{className:"epkb-ai-info-item"},o("span",{className:"epkb-ai-info-label"},l("AI Chat","echo-knowledge-base")),o("span",{className:"epkb-ai-info-value epkb-ai-status-indicator "+("Enabled"===i?.system_info?.ai_chat?.value?"epkb-status-enabled":"epkb-status-disabled")},"Enabled"===i?.system_info?.ai_chat?.value?o("span",{className:"epkbfa epkbfa-check-circle epkb-ai-status-success"}):o("span",null,l("Disabled","echo-knowledge-base")))),o("div",{className:"epkb-ai-info-item"},o("span",{className:"epkb-ai-info-label"},l("AI Search","echo-knowledge-base")),o("span",{className:"epkb-ai-info-value epkb-ai-status-indicator "+("Enabled"===i?.system_info?.ai_search?.value?"epkb-status-enabled":"epkb-status-disabled")},"Enabled"===i?.system_info?.ai_search?.value?o("span",{className:"epkbfa epkbfa-check-circle epkb-ai-status-success"}):o("span",null,l("Disabled","echo-knowledge-base")))),o("div",{className:"epkb-ai-info-item"},o("span",{className:"epkb-ai-info-label"},l("OpenAI API Key","echo-knowledge-base")),o("span",{className:"epkb-ai-info-value epkb-ai-status-indicator "+("Configured"===i?.system_info?.openai_api?.value?"epkb-status-enabled":"epkb-status-disabled")},"Configured"===i?.system_info?.openai_api?.value?o("span",{className:"epkbfa epkbfa-check-circle epkb-ai-status-success"}):o("span",null,l("Missing API Key","echo-knowledge-base"))))),o("div",{className:"epkb-ai-subsection"},o("h4",null,l("Data Collections","echo-knowledge-base")),T?.data_collections&&T.data_collections.length>0?o("div",{className:"epkb-ai-data-collections"},T.data_collections.map((e,a)=>o("div",{className:"epkb-ai-collection-item",key:e.id||a},o("h5",null,e.name||l("Unnamed Collection","echo-knowledge-base")),o("div",{className:"epkb-ai-collection-details"},o("div",null,o("span",null,l("Vector Store:","echo-knowledge-base")+" ",o("strong",null,"created"===e.vector_store_status?l("Created","echo-knowledge-base"):l("Not created","echo-knowledge-base"))),e.vector_store_id&&o("span",null," (ID: "+e.vector_store_id+")")),o("div",null,o("span",null,l("Total Records:","echo-knowledge-base")+" ",o("strong",null,e.db_record_count||"0"))),e.status_counts&&o("div",{className:"epkb-ai-status-counts"},o("span",{className:"epkb-ai-status-label"},l("Status:","echo-knowledge-base")),e.status_counts.added>0&&o("span",{className:"epkb-ai-status-item epkb-ai-status-added"},l("Added:","echo-knowledge-base")+" "+e.status_counts.added),e.status_counts.updated>0&&o("span",{className:"epkb-ai-status-item epkb-ai-status-updated"},l("Updated:","echo-knowledge-base")+" "+e.status_counts.updated),e.status_counts.outdated>0&&o("span",{className:"epkb-ai-status-item epkb-ai-status-outdated"},l("Outdated:","echo-knowledge-base")+" "+e.status_counts.outdated),e.status_counts.error>0&&o("span",{className:"epkb-ai-status-item epkb-ai-status-error"},l("Error:","echo-knowledge-base")+" "+e.status_counts.error),e.status_counts.pending>0&&o("span",{className:"epkb-ai-status-item epkb-ai-status-pending"},l("Pending:","echo-knowledge-base")+" "+e.status_counts.pending)))))):o("p",{className:"epkb-ai-no-data"},l("No data collections found.","echo-knowledge-base")))))),o("div",{className:"epkb-ai-debug-toggle-section"},o("h3",null,l("System Information","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-section epkb-ai-system-info"},o("div",{className:"epkb-ai-info-grid"},j&&Object.entries(j).map(([e,a])=>o("div",{className:"epkb-ai-info-item",key:e},o("span",{className:"epkb-ai-info-label"},a.label+":"),o("span",{className:`epkb-ai-info-value ${a.class||""}`},a.value)))),o("div",{className:"epkb-ai-debug-actions"},o("button",{className:"epkb-ai-btn epkb-ai-btn-primary",onClick:()=>{const e=document.createElement("iframe");e.style.display="none",e.name="download-frame-"+Date.now(),document.body.appendChild(e);const a=document.createElement("form");a.method="POST",a.action=window.location.href,a.target=e.name;const s=document.createElement("input");s.type="hidden",s.name="action",s.value="epkb_download_ai_debug_info",a.appendChild(s);const o=document.createElement("input");o.type="hidden",o.name="_wpnonce",o.value=i?.nonce||"",a.appendChild(o),document.body.appendChild(a),a.submit(),setTimeout(()=>{document.body.removeChild(a),document.body.removeChild(e)},5e3)}},o("span",{className:"epkbfa epkbfa-download"})," ",l("Download Debug Info","echo-knowledge-base"))))),o("div",{className:"epkb-ai-debug-toggle-section"},o("h3",null,l("Logs","echo-knowledge-base")),o("div",{className:"epkb-ai-logs-subsection"},o("h4",null,l("PHP Error Log","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-section epkb-ai-php-error-log"},o("div",{className:"epkb-ai-debug-controls"},o("button",{className:"epkb-ai-btn epkb-ai-btn-primary",onClick:B},o("span",{className:"epkbfa epkbfa-refresh"})," ",l("Refresh","echo-knowledge-base")),o("select",{className:"epkb-ai-select",value:m,onChange:e=>h(e.target.value)},o("option",{value:""},l("All Errors","echo-knowledge-base")),o("option",{value:"fatal"},l("Fatal Errors","echo-knowledge-base")),o("option",{value:"warning"},l("Warnings","echo-knowledge-base")),o("option",{value:"notice"},l("Notices","echo-knowledge-base")),o("option",{value:"ai-related"},l("AI Related Only","echo-knowledge-base")))),o("div",{className:"epkb-ai-log-container"},_?o("div",{className:"epkb-ai-loading-spinner"}):0===b.length?o("div",{className:"epkb-ai-no-logs"},l("No logs found.","echo-knowledge-base")):b.map(e=>J(e))))),o("h4",null,l("WordPress Error Log","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-section epkb-ai-wp-error-log"},o("div",{className:"epkb-ai-debug-controls"},o("button",{className:"epkb-ai-btn epkb-ai-btn-primary",onClick:M},o("span",{className:"epkbfa epkbfa-refresh"})," ",l("Refresh","echo-knowledge-base")),o("select",{className:"epkb-ai-select",value:w,onChange:e=>v(e.target.value)},o("option",{value:""},l("All Errors","echo-knowledge-base")),o("option",{value:"fatal"},l("Fatal Errors","echo-knowledge-base")),o("option",{value:"warning"},l("Warnings","echo-knowledge-base")),o("option",{value:"notice"},l("Notices","echo-knowledge-base")),o("option",{value:"ai-related"},l("AI Related Only","echo-knowledge-base")))),o("div",{className:"epkb-ai-log-container"},C?o("div",{className:"epkb-ai-loading-spinner"}):0===u.length?o("div",{className:"epkb-ai-no-logs"},l("No logs found.","echo-knowledge-base")):u.map(e=>J(e)))),o("h4",null,l("AI Activity Log","echo-knowledge-base")),o("div",{className:"epkb-ai-debug-section epkb-ai-activity-log"},o("div",{className:"epkb-ai-debug-controls"},o("button",{className:"epkb-ai-btn epkb-ai-btn-primary",onClick:U},o("span",{className:"epkbfa epkbfa-refresh"})," ",l("Refresh","echo-knowledge-base")),o("button",{className:"epkb-ai-btn epkb-ai-btn-danger",onClick:async()=>{const{showConfirmDialog:e}=window.EPKB_AI_Util_React||{};if(!e)return void n(l("Dialog utility not available","echo-knowledge-base"));if(await e({title:l("Clear AI Logs","echo-knowledge-base"),message:l("Are you sure you want to clear all AI logs? This action cannot be undone.","echo-knowledge-base"),confirmText:l("Clear Logs","echo-knowledge-base"),cancelText:l("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"}))try{const e=await jQuery.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"epkb_ai_clear_ai_logs",_wpnonce:i?.nonce||""}});e.success?(k([]),F([]),t(l("AI logs cleared successfully","echo-knowledge-base"))):n(e.data.message||l("Failed to clear AI logs","echo-knowledge-base"))}catch(e){n(l("Error clearing AI logs","echo-knowledge-base"))}}},o("span",{className:"epkbfa epkbfa-trash"})," ",l("Clear Logs","echo-knowledge-base")),o("select",{className:"epkb-ai-select",value:f,onChange:e=>N(e.target.value)},o("option",{value:""},l("All Levels","echo-knowledge-base")),o("option",{value:"error"},l("Errors Only","echo-knowledge-base")),o("option",{value:"warning"},l("Warnings","echo-knowledge-base")),o("option",{value:"info"},l("Info","echo-knowledge-base")))),o("div",{className:"epkb-ai-log-container"},A?o("div",{className:"epkb-ai-loading-spinner"}):0===g.length?o("div",{className:"epkb-ai-no-logs"},l("No logs found.","echo-knowledge-base")):g.map(e=>J(e)))))):o("div",{className:"epkb-ai-debug-disabled"},o("p",null,l("Debug mode is disabled. Enable it above to view debug information.","echo-knowledge-base")))))}}}();