(function(){"use strict";const{useState:e,useEffect:a,createElement:s,Fragment:t}=wp.element;const{__:o}=wp.i18n;const{showError:n,showSuccess:i,makeApiRequest:c,handleSessionError:l}=window.EPKB_AI_Util_React||{};const r=({settings:a,tabData:t})=>{const c=t||{};const[r,d]=e(c.chat_settings);const[g,h]=e(c.search_settings);const[p,b]=e(false);const[k,m]=e(false);const[_,u]=e("chat");const w=c.all_model_specs||{};const[f,v]=e(w[r.ai_chat_model]||c.chat_model_spec||{});const[x,y]=e(w[g.ai_search_model]||c.search_model_spec||{});const N=(e,a)=>{d((s=>({...s,[e]:a})));m(true);if(e==="ai_chat_model"&&w[a]){v(w[a])}};const S=(e,a)=>{h((s=>({...s,[e]:a})));m(true);if(e==="ai_search_model"&&w[a]){y(w[a])}};const C=async e=>{b(true);const s=e==="search"?g:r;try{const t=await jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"epkb_ai_save_tuning_settings",_wpnonce_epkb_ajax_action:a.ajax_nonce,context:e,settings:s}});if(t.success){i(t.data.message||o("Settings saved successfully","echo-knowledge-base"));m(false);setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","tools");window.location.href=e.toString()}),1e3)}else{if(t.error&&t.message){const e={responseJSON:t};const a=await l(e);if(!a){n(t.message||o("Failed to save settings","echo-knowledge-base"))}}else{n(t.data?.message||o("Failed to save settings","echo-knowledge-base"))}}}catch(e){console.error("Error saving tuning settings:",e);const a=await l(e);if(!a){n(o("An error occurred while saving settings","echo-knowledge-base"))}}finally{b(false)}};const A=async e=>{const s=e==="search"?o("search","echo-knowledge-base"):o("chat","echo-knowledge-base");if(!confirm(sprintf(o("Are you sure you want to reset %s tuning settings to their default values?","echo-knowledge-base"),s))){return}b(true);try{const s=await jQuery.ajax({url:ajaxurl,type:"POST",data:{action:"epkb_ai_reset_tuning_defaults",_wpnonce_epkb_ajax_action:a.ajax_nonce,context:e}});if(s.success){if(s.data.defaults){if(e==="search"){h((e=>({...e,...s.data.defaults})))}else{d((e=>({...e,...s.data.defaults})))}}i(s.data.message||o("Settings reset to defaults successfully","echo-knowledge-base"));m(false);setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","tools");window.location.href=e.toString()}),1e3)}else{if(s.error&&s.message){const e={responseJSON:s};const a=await l(e);if(!a){n(s.message||o("Failed to reset settings","echo-knowledge-base"))}}else{n(s.data?.message||o("Failed to reset settings","echo-knowledge-base"))}}}catch(e){console.error("Error resetting tuning settings:",e);const a=await l(e);if(!a){n(o("An error occurred while resetting settings","echo-knowledge-base"))}}finally{b(false)}};const T=(e,a,t,o,n,i,c,l,r)=>s("div",{className:"epkb-ai-setting-group"},s("label",{className:"epkb-ai-setting-label",htmlFor:e},a),t&&s("p",{className:"epkb-ai-setting-description"},t),l&&s("div",{className:"epkb-ai-setting-tip",style:{backgroundColor:"#f6f7f7",padding:"10px",borderRadius:"4px",marginTop:"8px",marginBottom:"12px",fontSize:"13px",color:"#646970",borderLeft:"3px solid #2271b1"}},s("span",{className:"epkbfa epkbfa-lightbulb-o",style:{marginRight:"6px"}}),l),s("div",{className:"epkb-ai-slider-container",style:{display:"flex",alignItems:"center",gap:"15px"}},s("input",{type:"range",id:e,className:"epkb-ai-slider",min:o,max:n,step:i,value:c,onChange:a=>r(e,parseFloat(a.target.value)),style:{flex:1}}),s("span",{className:"epkb-ai-slider-value",style:{minWidth:"50px",textAlign:"right"}},c)));const R=(e,a,t,o,n,i,c,l)=>s("div",{className:"epkb-ai-setting-group"},s("label",{className:"epkb-ai-setting-label",htmlFor:e},a),t&&s("p",{className:"epkb-ai-setting-description"},t),c&&s("div",{className:"epkb-ai-setting-tip",style:{backgroundColor:"#f6f7f7",padding:"10px",borderRadius:"4px",marginTop:"8px",marginBottom:"12px",fontSize:"13px",color:"#646970",borderLeft:"3px solid #2271b1"}},s("span",{className:"epkbfa epkbfa-lightbulb-o",style:{marginRight:"6px"}}),c),s("input",{type:"number",id:e,className:"epkb-ai-input",min:o,max:n,value:i,onChange:a=>l(e,parseInt(a.target.value))}));const j=(e,a,t,o,n,i)=>s("div",{className:"epkb-ai-setting-group"},s("label",{className:"epkb-ai-setting-label",htmlFor:e},a),t&&s("p",{className:"epkb-ai-setting-description"},t),s("select",{id:e,className:"epkb-ai-select",value:n,onChange:a=>i(e,a.target.value)},Object.entries(o).map((([e,a])=>s("option",{key:e,value:e},a)))));const F=()=>{const e={};Object.entries(w).forEach((([a,s])=>{e[a]=s.name||a}));const a=f.type==="gpt5";return s("div",{className:"epkb-ai-section-card"},s("div",{className:"epkb-ai-section-card__header"},s("h3",{className:"epkb-ai-section-card__title"},o("AI Chat Model Parameters","echo-knowledge-base")),s("p",{className:"epkb-ai-section-card__subtitle"},o("Fine-tune parameters specifically for AI chat conversations","echo-knowledge-base"))),s("div",{className:"epkb-ai-section-card__content"},j("ai_chat_model",o("Chat Model","echo-knowledge-base"),o("Select the AI model for chat conversations","echo-knowledge-base"),e,r.ai_chat_model,N),!a&&T("ai_chat_temperature",o("Temperature","echo-knowledge-base"),o("Controls response creativity. Lower = more focused, Higher = more creative","echo-knowledge-base"),0,2,.1,r.ai_chat_temperature,o("Use 0.7-1.0 for conversational responses","echo-knowledge-base"),N),!a&&T("ai_chat_top_p",o("Top P","echo-knowledge-base"),o("Controls response diversity via nucleus sampling","echo-knowledge-base"),0,1,.1,r.ai_chat_top_p,o("Keep at 1.0 for most natural conversations","echo-knowledge-base"),N),a&&j("ai_chat_verbosity",o("Verbosity","echo-knowledge-base"),o("Controls response verbosity for GPT-5 models","echo-knowledge-base"),{low:o("Low","echo-knowledge-base"),medium:o("Medium","echo-knowledge-base"),high:o("High","echo-knowledge-base")},r.ai_chat_verbosity,N),a&&j("ai_chat_reasoning",o("Reasoning","echo-knowledge-base"),o("Controls reasoning depth for GPT-5 models","echo-knowledge-base"),{low:o("Low","echo-knowledge-base"),medium:o("Medium","echo-knowledge-base"),high:o("High","echo-knowledge-base")},r.ai_chat_reasoning,N),R("ai_chat_max_output_tokens",o("Max Tokens","echo-knowledge-base"),o("Maximum response length in tokens","echo-knowledge-base"),50,f.max_tokens_limit||4e3,r.ai_chat_max_output_tokens,o("1000-1500 tokens for standard chat responses","echo-knowledge-base"),N)),s("div",{className:"epkb-ai-section-card__footer",style:{marginTop:"20px",display:"flex",gap:"10px"}},s("button",{className:`epkb-ai-button epkb-ai-button-primary ${p?"disabled":""}`,onClick:()=>C("chat"),disabled:p},p?o("Saving...","echo-knowledge-base"):o("Save Chat Settings","echo-knowledge-base")),s("button",{className:`epkb-ai-button epkb-ai-button-secondary ${p?"disabled":""}`,onClick:()=>A("chat"),disabled:p},o("Reset Chat Settings","echo-knowledge-base"))))};const I=()=>{const e={};Object.entries(w).forEach((([a,s])=>{e[a]=s.name||a}));const a=x.type==="gpt5";return s("div",{className:"epkb-ai-section-card"},s("div",{className:"epkb-ai-section-card__header"},s("h3",{className:"epkb-ai-section-card__title"},o("AI Search Model Parameters","echo-knowledge-base")),s("p",{className:"epkb-ai-section-card__subtitle"},o("Fine-tune parameters specifically for AI-enhanced search","echo-knowledge-base"))),s("div",{className:"epkb-ai-section-card__content"},j("ai_search_model",o("Search Model","echo-knowledge-base"),o("Select the AI model for search functionality","echo-knowledge-base"),e,g.ai_search_model,S),!a&&T("ai_search_temperature",o("Temperature","echo-knowledge-base"),o("Lower values for more accurate search results","echo-knowledge-base"),0,1,.1,g.ai_search_temperature,o("Use 0.2-0.4 for accurate search results","echo-knowledge-base"),S),!a&&T("ai_search_top_p",o("Top P","echo-knowledge-base"),o("Controls result diversity","echo-knowledge-base"),0,1,.1,g.ai_search_top_p,o("Use 0.8-0.9 for focused search results","echo-knowledge-base"),S),a&&j("ai_search_verbosity",o("Verbosity","echo-knowledge-base"),o("Controls search result verbosity","echo-knowledge-base"),{low:o("Low","echo-knowledge-base"),medium:o("Medium","echo-knowledge-base"),high:o("High","echo-knowledge-base")},g.ai_search_verbosity,S),a&&j("ai_search_reasoning",o("Reasoning","echo-knowledge-base"),o("Controls search reasoning depth","echo-knowledge-base"),{low:o("Low","echo-knowledge-base"),medium:o("Medium","echo-knowledge-base"),high:o("High","echo-knowledge-base")},g.ai_search_reasoning,S),R("ai_search_max_output_tokens",o("Max Tokens","echo-knowledge-base"),o("Maximum search result length in tokens","echo-knowledge-base"),50,x.max_tokens_limit||4e3,g.ai_search_max_output_tokens,o("300-500 tokens for concise search results","echo-knowledge-base"),S)),s("div",{className:"epkb-ai-section-card__footer",style:{marginTop:"20px",display:"flex",gap:"10px"}},s("button",{className:`epkb-ai-button epkb-ai-button-primary ${p?"disabled":""}`,onClick:()=>C("search"),disabled:p},p?o("Saving...","echo-knowledge-base"):o("Save Search Settings","echo-knowledge-base")),s("button",{className:`epkb-ai-button epkb-ai-button-secondary ${p?"disabled":""}`,onClick:()=>A("search"),disabled:p},o("Reset Search Settings","echo-knowledge-base"))))};return s("div",{className:"epkb-ai-debug-content epkb-ai-tuning-content"},s("div",{className:"epkb-ai-page-intro"},s("div",{className:"epkb-ai-page-intro__header"},s("div",{className:"epkb-ai-page-intro__icon"},s("span",{className:"epkbfa epkbfa-sliders"})),s("div",{className:"epkb-ai-page-intro__text"},s("h2",{className:"epkb-ai-page-intro__title"},o("Advanced AI Tuning","echo-knowledge-base")),s("p",{className:"epkb-ai-page-intro__subtitle"},o("Optional - For Advanced Users Only","echo-knowledge-base")))),s("p",{className:"epkb-ai-page-intro__description"},o("Fine-tune the AI model parameters to control how responses are generated. Most users should use the preset configurations available in the Chat and Search tabs.","echo-knowledge-base"))),F(),I(),k&&s("div",{style:{textAlign:"center",marginTop:"20px",padding:"10px",backgroundColor:"#fff3cd",borderRadius:"4px"}},s("span",{className:"epkbfa epkbfa-info-circle",style:{marginRight:"8px"}}),o("You have unsaved changes","echo-knowledge-base")))};window.EPKB_AI_Tuning={AIAdminTuning:r}})();