(function(){"use strict";class e{constructor(){this.chatId=null}save(e,s){try{if(s){this.chatId=s;sessionStorage.setItem("epkb_chat_id",s)}return{success:true,error:null}}catch(e){console.error("Failed to save session:",e);return{success:false,error:{type:"storage_error",message:e.message,details:"Failed to save chat data to storage"}}}}saveMessages(e,s){if(!e||!s){return false}try{sessionStorage.setItem(`epkb_chat_messages_${e}`,JSON.stringify(s));return true}catch(e){return false}}loadMessagesFromSessionStorage(e){if(!e){return null}try{const s=sessionStorage.getItem(`epkb_chat_messages_${e}`);return s?JSON.parse(s):null}catch(e){return null}}clearMessageCache(e){if(e){sessionStorage.removeItem(`epkb_chat_messages_${e}`)}}load(){try{const e=sessionStorage.getItem("epkb_chat_id");if(e&&typeof e!=="string"){throw new Error("Invalid chat ID format: "+e)}if(e){this.chatId=e;return{chatId:e,valid:true,error:null}}return{chatId:null,valid:false,error:null}}catch(e){console.error("Failed to load session:",e);return{chatId:null,valid:false,error:{type:"storage_error",message:e.message,details:"Failed to load chat data from storage"}}}}clear(){try{const e=this.chatId;this.chatId=null;sessionStorage.removeItem("epkb_chat_id");if(e){this.clearMessageCache(e)}return{success:true,error:null}}catch(e){console.error("Failed to clear chat:",e);return{success:false,error:{type:"storage_error",message:e.message,details:"Failed to clear chat data from storage"}}}}clearChatOnly(){try{const e=this.chatId;this.chatId=null;sessionStorage.removeItem("epkb_chat_id");if(e){this.clearMessageCache(e)}return{success:true,error:null}}catch(e){console.error("Failed to clear chat:",e);return{success:false,error:{type:"storage_error",message:e.message,details:"Failed to clear chat data"}}}}updateFromResponse(e){let s=false;if(e.chat_id){this.chatId=e.chat_id;s=true}if(s){const e=this.save(null,this.chatId);if(!e.success){console.error("Failed to save chat after update:",e.error)}}return s}getSessionInfo(){return{chatId:this.chatId,hasSession:!!this.chatId}}}window.EPKBChatSession={SessionManager:e}})();