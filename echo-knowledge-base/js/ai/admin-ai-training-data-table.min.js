(function(){"use strict";const{useState:e,useEffect:t,useCallback:a,createElement:n,Fragment:s,useContext:o,useRef:i,useMemo:l,createRoot:c}=wp.element;const{__:r}=wp.i18n;const{showError:d,showSuccess:p,makeApiRequest:u,showConfirmDialog:g,formatServerDateTime:b,useTableSearch:f,clearAllEPKBSessionStorage:h}=window.EPKB_AI_Util_React||{};const{useSyncContext:m}=window.EPKB_AI_Sync||{};const k=()=>{try{const e=o(window.EPKB_AI_TrainingDataCacheContext);return e||null}catch(e){return null}};const y=({collectionId:c,collectionName:m="",hasApiKey:y=true,onSelectedIdsChange:w,onBulkDeleteCallback:_,onSelectAllCallback:N,onTotalItemsChange:v,onTrainingDataChange:S,refreshTrigger:C=0,syncProgress:x=null,isSyncing:D=false,onFilterStateChange:A,initialStats:I=null,initialData:E=null,onStatsUpdate:P=null,selectedIds:T=null,onNoteEdit:$=null,isAIProEnabled:R=false,onActiveStatusTabChange:B=null,onStatusCountsChange:K=null})=>{const[L,O]=e((()=>{if(E){if(E.all&&E.all.data){return E.all.data}else if(E.data){return E.data}}return[]}));const[j,z]=e([]);const F=T!==null?T:j;const[M,U]=e((()=>{if(I&&Object.keys(I).length>0){return{added:0,updated:0,outdated:0,error:0,pending:0,...I}}return{added:0,updated:0,outdated:0,error:0,pending:0}}));const[q,H]=e((()=>!(E&&(E.all||E.data))));const[V,J]=e(1);const[G,W]=e((()=>{if(E){if(E.all&&E.all.pagination){return E.all.pagination.total_pages}else if(E.pagination){return E.pagination.total_pages}}return 1}));const[Y,Q]=e(false);const[X,Z]=e(new Set);const[ee,te]=e(new Set);const ae=20;const[ne,se]=e([]);const[oe,ie]=e(false);const[le,ce]=e("all");const[re,de]=e([]);const[pe,ue]=e([]);const[ge,be]=e(null);const[fe,he]=e("asc");const[me,ke]=e(false);const[ye,we]=e(false);const[_e,Ne]=e("");const[ve,Se]=e([]);const Ce=a((async e=>{Ne(e||"");J(1);return null}),[]);const{searchTerm:xe,displayedData:De,isSearching:Ae,searchMessage:Ie,handleSearchChange:Ee,clearSearch:Pe}=f({data:L,allData:null,onServerSearch:Ce,searchFields:["title","type_name","type","item_type","url","item_id"]});const Te=a((()=>_e||le!=="all"||pe.length>0),[_e,le,pe]);const $e=a((()=>{if(le==="sync"){return[...ne].reverse()}let e=[...De];e.sort(((e,t)=>{const a=e&&e.status==="updating";const n=t&&t.status==="updating";if(a!==n){return a?-1:1}if(!ge)return 0;let s=e[ge];let o=t[ge];if(ge==="item_id"){s=parseInt(s)||0;o=parseInt(o)||0}if(ge==="last_synced"){s=new Date(s||0).getTime();o=new Date(o||0).getTime()}if(s<o)return fe==="asc"?-1:1;if(s>o)return fe==="asc"?1:-1;return 0}));return e}),[De,le,ne,ge,fe]);const Re=a((()=>$e()),[$e]);const Be=a((()=>G),[G]);const Ke=k();const Le=window.EPKB_AI_SyncContext?o(window.EPKB_AI_SyncContext):null;const Oe=a((()=>{const e=le||"all";const t=pe.length>0?`_type_${pe.join("-")}`:"";const a=_e?`_search_${encodeURIComponent(_e)}`:"";return`collection_${c}_status_${e}_page_${V}${t}${a}`}),[c,V,le,pe,_e]);const je=a(((e,t)=>{O((a=>a.map((a=>{if(a.id===e){return{...a,status:t}}return a}))))}),[]);const ze=i(true);const Fe=i(false);t((()=>{ze.current=true;Fe.current=false;J(1);ce("all");ue([]);Ne("")}),[c]);t((()=>{J(1)}),[le,pe,_e]);t((()=>{const e=()=>{if(!E||Fe.current){return false}if(V!==1||pe.length>0||_e){return false}if(le==="sync"){return false}if(E[le]&&E[le].data!==undefined){return true}if(le==="all"&&E.data){return true}return false};if(e()){let e,t;if(E[le]){e=E[le].data;t=E[le].pagination}else if(le==="all"&&E.data){e=E.data;t=E.pagination}O(e);W(t?t.total_pages:1);H(false);ze.current=false;if(S){S(e)}}else{Me()}}),[V,le,pe,_e,E,S]);const Me=a((async(e=false)=>{const t=Oe();const a={collection_id:c,page:V,per_page:ae};if(le!=="all"&&le!=="sync"){a.status=le}if(pe.length>0){a.type=pe[0]}if(_e){a.search=_e}const n=!ze.current&&!e&&Ke;if(n){const e=Ke.get(t);if(e&&e.data&&e.totalPages!==undefined){O(e.data);W(e.totalPages);if(e.availableTypes){Se(e.availableTypes)}if(S){S(e.data)}H(false);u("training-data",{params:a}).then((a=>{if(a.success){if(a.status_counts){const e={added:0,updated:0,outdated:0,error:0,pending:0,...a.status_counts};U(e);if(K){K(e)}}const n=a.pagination?Number(a.pagination.total_pages):1;if(n!==e.totalPages){W(n)}if(a.available_types){Se(a.available_types)}if(a.data){const s=a.data;const o=JSON.stringify(e.data);const i=JSON.stringify(s);if(o!==i){O((e=>{const o=new Map;e.forEach((e=>{if(e&&e.status==="updating"){o.set(String(e.item_id),e)}}));const i=s.map((e=>{const t=o.get(String(e.item_id));if(t){return{...e,status:"updating",last_synced:t.last_synced||e.last_synced}}return e}));if(Ke){Ke.set(t,{data:s,totalPages:n,availableTypes:a.available_types||[],timestamp:Date.now()})}if(S){S(i)}return i}))}else if(n!==e.totalPages){if(Ke){Ke.set(t,{data:e.data,totalPages:n,availableTypes:a.available_types||e.availableTypes||[],timestamp:Date.now()})}}}}})).catch((()=>{}));return}}H(true);try{const e=await u("training-data",{params:a});if(e.success){const a=e.data||[];const n=e.status_counts||{};const s=e.available_types||[];const o=e.pagination?Number(e.pagination.total_pages):1;if(Ke){Ke.set(t,{data:a,totalPages:o,availableTypes:s,timestamp:Date.now()})}Se(s);O((e=>{const t=new Map;const n=new Set;const s=new Map;e.forEach((e=>{if(e.summarized_content){t.set(e.id,e.summarized_content)}if(e.status==="updating"){n.add(String(e.item_id));if(e.last_synced){s.set(String(e.item_id),e.last_synced)}}}));return a.map((e=>{const a=t.get(e.id);const o=n.has(String(e.item_id));const i=a&&!e.summarized_content?{...e,summarized_content:a}:e;if(o){return{...i,status:"updating",last_synced:s.get(String(e.item_id))||i.last_synced}}return i}))}));W(o);const i={added:0,updated:0,outdated:0,error:0,pending:0,...n};U(i);if(K){K(i)}if(S){S(a)}}}catch(e){if(e.message!=="API key required"&&e.code!=="fetch_error"){console.error("Failed to fetch training data:",e);d(r("Failed to load training data","echo-knowledge-base"))}}finally{H(false);if(ze.current){ze.current=false}}}),[c,V,Oe,S,K,Ke,Te,le,pe,_e]);const Ue=a((e=>{if(e){const e=Re();z(e.map((e=>e.id)))}else{z([])}}),[Re]);const qe=async()=>{Q(true);Fe.current=true;if(Ke){Ke.clearCollection(c)}h();const e=Le&&Le.job&&(Le.job.status==="running"||Le.job.status==="scheduled");if(!e){ie(false);se([]);if(le==="sync"){ce("all")}}await Me(true);Q(false);p(r("Data refreshed successfully","echo-knowledge-base"))};const He=a((async()=>{if(!j.length)return;const e=await g({title:r("Delete Selected Items","echo-knowledge-base"),message:r("Are you sure you want to delete the selected items?","echo-knowledge-base"),confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!e){return}te(new Set(j));try{const e=await u("training-data/delete-selected",{method:"DELETE",data:{ids:j}});p(r("Items deleted successfully","echo-knowledge-base"));z([]);Fe.current=true;setTimeout((()=>{te(new Set);if(Ke){Ke.clearCollection(c)}Me(true)}),500)}catch(e){console.error("Delete error:",e);if(e.message!=="API key required"&&!e._errorDisplayed){d(e.message||r("Failed to delete items","echo-knowledge-base"))}te(new Set)}}),[j,Oe,Ke,Me]);t((()=>{if(C>0){Fe.current=true;if(Ke){Ke.clearCollection(c)}Me(true);z([])}}),[C]);t((()=>{const e=e=>{if(!e.target.closest(".epkb-ai-table-header-content")){ke(false);we(false)}};document.addEventListener("click",e);return()=>document.removeEventListener("click",e)}),[]);t((()=>{if(w){w(j)}}),[j,w]);t((()=>{if(_&&He){_((()=>{He()}))}}),[_,He]);t((()=>{if(N){N(Ue)}}),[N,Ue]);const Ve=l((()=>{if(M){return Object.keys(M).filter((e=>["added","updated","outdated","error","pending"].includes(e))).reduce(((e,t)=>e+(M[t]||0)),0)}return 0}),[M]);t((()=>{if(v){v(Ve)}}),[Ve,v]);t((()=>{if(A){const e=xe!==""||re.length>0||pe.length>0;A(e)}}),[xe,re,pe,A]);t((()=>{if(B){B(le)}}),[le,B]);const Je=i(null);t((()=>{if(Le&&Le.job){const e=Le.job.status;if(e==="running"||e==="scheduled"){const e=Je.current!=="running"&&Je.current!=="scheduled";if(!oe){ie(true);ce("sync")}else if(le!=="sync"){ce("sync")}if(e||!oe){se([]);const e=[...F];const t=Le.job.total>0&&e.length===0;if(e.length>0){const t=e.map((e=>{const t=L.find((t=>t.id===e));if(t){return{id:t.id,item_id:t.item_id,title:t.title,type:t.item_type||t.type||"Article",type_name:t.type_name||t.type||"Article",status:"syncing",last_synced:(new Date).toISOString()}}return null})).filter((e=>e!==null));se(t);setTimeout((()=>{z([]);if(w){w([])}}),100)}else if(t){se([])}else{se([])}}}Je.current=e;if(e==="completed"||e==="canceled"){se((t=>t.map((t=>({...t,status:e==="completed"?"completed":t.status==="completed"?"completed":"canceled"})))))}}}),[Le?.job?.status,oe,F,L,w]);t((()=>{if(Le&&Le.registerPostUpdateHandler){const e=e=>{if(!oe){return}se((t=>{let a=[...t];e.forEach((e=>{const t=a.findIndex((t=>String(t.item_id)===String(e.id)||String(t.id)===String(e.id)));if(t!==-1){a[t]={...a[t],status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status,error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()}}else{const t=L.find((t=>String(t.item_id)===String(e.id)||String(t.id)===String(e.id)));if(t){a.push({id:t.id,item_id:t.item_id,title:t.title,type:t.item_type||t.type||"Article",type_name:t.type_name||t.type||"Article",status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status||"syncing",error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()})}else if(e.title||e.id){a.push({id:e.id,item_id:e.id,title:e.title||`Item ${e.id}`,type:e.type||"Article",type_name:e.type_name||e.type||"Article",status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status||"syncing",error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()})}}}));a.sort(((e,t)=>{if(e.status==="syncing"&&t.status!=="syncing")return-1;if(e.status!=="syncing"&&t.status==="syncing")return 1;return 0}));return a}))};Le.registerPostUpdateHandler(e);return()=>{if(Le.unregisterPostUpdateHandler){Le.unregisterPostUpdateHandler(e)}}}}),[Le,L,oe]);const Ge=e=>{if(j.includes(e)){z(j.filter((t=>t!==e)))}else{z([...j,e])}if(w){w([...j,e],true)}};const We=async e=>{const t=Array.isArray(e)?e:[e];const a=await g({title:r("Delete Items","echo-knowledge-base"),message:r("Are you sure you want to delete the selected items?","echo-knowledge-base"),confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!a){return}te(new Set(t));try{await u("training-data/delete-selected",{method:"DELETE",data:{ids:t}});p(r("Items deleted successfully","echo-knowledge-base"));z([]);Fe.current=true;setTimeout((()=>{te(new Set);if(Ke){Ke.clearCollection(c)}Me(true)}),500)}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){d(e.message||r("Failed to delete items","echo-knowledge-base"))}te(new Set)}};const Ye=e=>{const t={added:{label:r("Added","echo-knowledge-base"),className:"status-added"},updated:{label:r("Updated","echo-knowledge-base"),className:"status-updated"},outdated:{label:r("Outdated","echo-knowledge-base"),className:"status-outdated"},error:{label:r("Error","echo-knowledge-base"),className:"status-error"},pending:{label:r("Pending","echo-knowledge-base"),className:"status-pending"},syncing:{label:r("Syncing","echo-knowledge-base"),className:"status-syncing"},completed:{label:r("Completed","echo-knowledge-base"),className:"status-completed"},canceled:{label:r("Canceled","echo-knowledge-base"),className:"status-canceled"}};const a=t[e]||{label:e,className:"status-pending"};return n("span",{className:`epkb-ai-status-badge ${a.className}`},a.label)};const Qe=()=>["added","updated","outdated","error","pending"];const Xe=()=>{if(ve&&ve.length>0){return ve}const e=new Map;const t=L;t.forEach((t=>{const a=t.item_type||t.type||"Article";const n=t.type_name||t.type||"Article";if(!e.has(a)){e.set(a,n)}}));return Array.from(e,(([e,t])=>({value:e,label:t}))).sort(((e,t)=>e.label.localeCompare(t.label)))};const Ze=async e=>{ce(e);J(1);if(B){B(e)}const t=e!=="all"||pe.length>0};const et=async e=>{let t;if(pe.includes(e)){t=pe.filter((t=>t!==e))}else{t=[...pe,e]}ue(t);const a=le!=="all"||t.length>0};const tt=e=>{if(ge===e){he(fe==="asc"?"desc":"asc")}else{be(e);he("asc")}};const at=a((()=>{const e={};if(M){Object.keys(M).forEach((t=>{if(["added","updated","outdated","error","pending"].includes(t)){const a=M[t]||0;if(a>0){e[t]=a}}}))}return e}),[M]);if(!q&&L.length===0&&!Te()){return n("div",{className:"epkb-ai-data-source-table"},n("div",{className:"epkb-ai-empty-state"},n("div",{className:"epkb-ai-empty-icon"},n("span",{className:"epkbfa epkbfa-file-text-o"})),n("h4",null,r("No published articles found","echo-knowledge-base")),n("p",null,r("No published knowledge base articles were found. Create and publish some articles first, then they will automatically appear here ready for AI synchronization.","echo-knowledge-base")),n("button",{className:"epkb-ai-button epkb-ai-button-success",onClick:qe,disabled:Y,style:{backgroundColor:"#46b450",borderColor:"#46b450",color:"#fff",padding:"8px 16px",fontSize:"14px",marginTop:"15px"}},Y?r("Refreshing...","echo-knowledge-base"):n(s,null,n("span",{className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),r("Refresh","echo-knowledge-base")))))}return n("div",{className:"epkb-ai-data-source-table"},n("div",{className:"epkb-ai-table-content"},n("div",{className:"epkb-ai-table-actions"},n("div",{className:"epkb-ai-table-actions-left"},n("div",{className:"epkb-ai-status-tabs-bar"},(()=>{const e=at();const t=["all"];const a={all:r("All","echo-knowledge-base"),sync:r("Sync","echo-knowledge-base"),error:r("Error","echo-knowledge-base"),pending:r("Pending","echo-knowledge-base"),outdated:r("Outdated","echo-knowledge-base"),added:r("Added","echo-knowledge-base"),updated:r("Updated","echo-knowledge-base")};if(oe){t.push("sync")}if(e.error>0)t.push("error");if(e.pending>0)t.push("pending");if(e.outdated>0)t.push("outdated");if(e.added>0)t.push("added");if(e.updated>0)t.push("updated");return t.map((t=>{let s;if(t==="all"){s=Object.values(e).reduce(((e,t)=>e+t),0)}else if(t==="sync"){s=ne.length}else{s=e[t]||0}return n("button",{key:t,className:`epkb-ai-status-tab ${t===le?"active":""} ${t==="sync"?"epkb-ai-sync-tab":""}`,onClick:()=>Ze(t)},n("span",{className:"epkb-ai-tab-label"},a[t]),n("span",{className:"epkb-ai-tab-count"},`(${s})`))}))})(),D&&x&&n("div",{className:"epkb-ai-sync-progress-indicator"},n("span",{className:x.isRunning!==false?"epkb-ai-sync-icon epkbfa epkbfa-refresh fa-spin":"epkb-ai-sync-icon epkbfa epkbfa-check-circle",style:x.isRunning===false?{color:"#46b450"}:{}}),n("span",{className:"epkb-ai-sync-text"},x.isRunning!==false?r("Syncing","echo-knowledge-base"):r("Sync Complete","echo-knowledge-base")),n("span",{className:"epkb-ai-sync-percentage"},`${x.percentage||0}%`),n("span",{className:"epkb-ai-sync-separator"},"•"),n("span",{className:"epkb-ai-sync-total"},`${x.synced||0}/${x.total||0}`)))),n("div",{className:"epkb-ai-table-actions-right"},n("div",{className:"epkb-ai-search-input"},n("input",{type:"text",placeholder:r("Search by title, type, URL, or ID...","echo-knowledge-base"),value:xe,onChange:e=>Ee(e.target.value)}),n("span",{className:"epkb-ai-search-icon epkbfa epkbfa-search"})),n("button",{className:"epkb-ai-button epkb-ai-button-success",onClick:qe,disabled:q||Y||D,style:{backgroundColor:"#46b450",borderColor:"#46b450",color:"#fff",padding:"6px 12px",fontSize:"14px",marginLeft:"10px",marginRight:j.length>0?"15px":"0"}},Y?r("Refreshing...","echo-knowledge-base"):n(s,null,n("span",{className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),r("Refresh","echo-knowledge-base"))),j.length>0&&n("span",{className:"epkb-ai-selected-count"},`${j.length} ${r("selected","echo-knowledge-base")}`))),q?n("div",{className:"epkb-ai-loading"},le==="sync"?r("Preparing sync...","echo-knowledge-base"):r("Loading training data...","echo-knowledge-base")):n(s,null,n("table",{className:"epkb-ai-data-table"},n("thead",null,n("tr",null,n("th",{className:"epkb-ai-table-checkbox"},n("input",{type:"checkbox",checked:(()=>{const e=Re();return F.length===e.length&&e.length>0})(),onChange:e=>Ue(e.target.checked)})),n("th",null,r("Status","echo-knowledge-base")),n("th",null,n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Title","echo-knowledge-base")),n("span",{className:`epkb-ai-sort-label ${ge==="title"?"active":""}`,onClick:()=>tt("title")},ge==="title"?(fe==="asc"?"↑":"↓")+" "+r("Sort","echo-knowledge-base"):r("Sort","echo-knowledge-base")))),n("th",{style:{position:"relative"}},n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Type","echo-knowledge-base")),n("span",{className:`epkb-ai-filter-label ${pe.length>0?"active":""}`,onClick:async()=>{we(!ye)}},r("Filter","echo-knowledge-base")),ye&&n("div",{className:"epkb-ai-filter-dropdown",onClick:e=>e.stopPropagation()},Xe().map((e=>n("label",{key:e.value,className:"epkb-ai-filter-option"},n("input",{type:"checkbox",checked:pe.includes(e.value),onChange:()=>et(e.value)}),n("span",null,e.label))))))),n("th",null,n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Updated","echo-knowledge-base")),n("span",{className:`epkb-ai-sort-label ${ge==="last_synced"?"active":""}`,onClick:()=>tt("last_synced")},ge==="last_synced"?(fe==="asc"?"↑":"↓")+" "+r("Sort","echo-knowledge-base"):r("Sort","echo-knowledge-base")))))),n("tbody",null,Re().length===0?n("tr",null,n("td",{colSpan:7,style:{textAlign:"center",padding:"20px"}},r("No training data found","echo-knowledge-base"))):Re().map((e=>{let t="";if(ee.has(e.id)){t="epkb-ai-deleting-row"}else if(e.status==="updating"||e.status==="syncing"){t="epkb-ai-syncing-row"}else if(e.status==="completed"){t="epkb-ai-sync-completed"}else if(X.has(e.item_id)){t="epkb-ai-recently-synced"}const a=le==="sync"?e.status==="syncing"?"syncing":e.status==="completed"?"updated":e.status==="canceled"?"canceled":e.status:e.status;return n("tr",{key:e.id,className:t,"data-item-id":e.id},n("td",{className:"epkb-ai-table-checkbox"},le==="sync"?null:n("input",{type:"checkbox",checked:F.includes(e.id),onChange:()=>Ge(e.id)})),n("td",null,Ye(a)),n("td",{className:"epkb-ai-table-title"},n("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},e.type==="epkb_kb_files"?n("span",{style:{flex:1}},e.title):n("a",{href:`${window.epkb_ai_api.admin_url}post.php?post=${e.item_id}&action=edit`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",flex:1}},e.title),n("button",{className:"epkb-ai-view-content-btn",onClick:t=>{t.preventDefault();t.stopPropagation();if((e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&R&&$){$({id:e.item_id,training_id:e.id,title:e.title})}else{if(window.EPKB_AI_ViewContentDialog&&typeof window.EPKB_AI_ViewContentDialog.show==="function"){window.EPKB_AI_ViewContentDialog.show(e.id,e.title,e)}}},title:(e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&R?r("Edit note","echo-knowledge-base"):e.status==="error"?r("View Error","echo-knowledge-base"):r("View content","echo-knowledge-base"),style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px",color:e.status==="error"?"#d54e21":"#0073aa",fontSize:"16px"}},n("span",{className:(e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&R?"epkbfa epkbfa-edit":e.status==="error"?"epkbfa epkbfa-exclamation-triangle":"epkbfa epkbfa-eye"})))),n("td",null,e.type==="epkb_kb_files"?r("KB Files","echo-knowledge-base"):e.type_name||e.type||r("Article","echo-knowledge-base")),n("td",{className:"epkb-ai-table-date"},b&&(e.last_synced||e.created)?b(e.last_synced||e.created,r("Never","echo-knowledge-base")):r("Never","echo-knowledge-base")))})))),(Ie||Ae)&&n("div",{className:"epkb-ai-search-message",style:{textAlign:"center",padding:"10px",color:"#666",fontStyle:"italic"}},Ae?r("Searching server for more results...","echo-knowledge-base"):Ie),(()=>{const e=Be();if(e<=1){return null}return n("div",{className:"epkb-ai-pagination"},n("button",{disabled:V===1,onClick:()=>J(V-1),className:"epkb-ai-button epkb-ai-button-secondary"},r("Previous","echo-knowledge-base")),n("span",{className:"epkb-ai-page-info"},`${r("Page","echo-knowledge-base")} ${V} ${r("of","echo-knowledge-base")} ${e}`),n("button",{disabled:V===e,onClick:()=>J(V+1),className:"epkb-ai-button epkb-ai-button-secondary"},r("Next","echo-knowledge-base")))})())))};window.EPKB_AI_DataSourceTable=y;class w{constructor(){this.container=null;this.root=null;this.currentId=null}async show(e,t,a=null){this.currentId=e;if(!this.container){this.container=document.createElement("div");this.container.id="epkb-ai-view-content-dialog-root";document.body.appendChild(this.container);const{render:e,unmountComponentAtNode:t}=wp.element;if(typeof c==="function"){this.root=c(this.container)}else if(typeof e==="function"){this.root={render:t=>e(t,this.container),unmount:()=>{if(typeof t==="function"){t(this.container)}else{this.container.innerHTML=""}}}}}if(a&&a.status==="error"&&a.error_message){this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:a.error_message,errorPostId:a.item_id,loading:false});return}this.renderDialog({title:t||r("Loading...","echo-knowledge-base"),loading:true});try{const n=await u(`training-data/${e}/content`,{method:"GET"});if(n&&n.data){const e=n.data;const s=a?.item_id||n.data?.item_id;if(s){const t=`epkb_summarized_content_${s}`;const a=sessionStorage.getItem(t);if(a){e.summarized_content=a}}this.renderDialog({title:e.title||t,content:e,loading:false})}else if(n&&n.success===false&&n.message){this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:n.message,errorPostId:a?.item_id,loading:false})}else{throw new Error(r("Failed to load content","echo-knowledge-base"))}}catch(e){console.error("Failed to load content:",e);this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:e.message||r("Failed to load content","echo-knowledge-base"),errorPostId:a?.item_id,loading:false})}}renderDialog(e){const{title:t,content:a,loading:s,error:o,errorMessage:i,errorPostId:l}=e;const c=n("div",{className:"epkb-ai-view-content-dialog-overlay",onClick:e=>{if(e.target.className==="epkb-ai-view-content-dialog-overlay"){this.close()}}},n("div",{className:"epkb-ai-view-content-dialog"},n("div",{className:"epkb-ai-dialog-header",style:{position:"relative"}},n("h3",null,t),(a?.item_id||l)&&n("span",{style:{position:"absolute",right:"50px",top:"50%",transform:"translateY(-50%)",fontSize:"14px",color:"#666",fontWeight:"normal"}},n("strong",null,r("Post ID:","echo-knowledge-base"))," ",a?.item_id||l),n("button",{className:"epkb-ai-dialog-close",onClick:()=>this.close(),"aria-label":r("Close","echo-knowledge-base")},n("span",{className:"epkbfa epkbfa-times"}))),n("div",{className:"epkb-ai-dialog-body"},s?n("div",{className:"epkb-ai-loading-spinner"},n("span",{className:"epkbfa epkbfa-spinner fa-spin"}),n("span",null," "+r("Loading content...","echo-knowledge-base"))):o?n("div",{className:"epkb-ai-error-content"},n("div",{className:"epkb-ai-error-icon"},n("span",{className:"epkbfa epkbfa-exclamation-triangle",style:{fontSize:"48px",color:"#d54e21"}})),n("h4",{style:{color:"#d54e21",marginTop:"20px"}},r("Error Processing Content","echo-knowledge-base")),n("div",{className:"epkb-ai-error-message",style:{marginTop:"15px",padding:"15px",backgroundColor:"#fef2f2",border:"1px solid #fee",borderRadius:"4px"}},n("p",{style:{margin:0,color:"#666"}},i))):a&&n("div",{className:"epkb-ai-content-tabs"},n("div",{className:"epkb-ai-content-tabs-header"},n("button",{className:"epkb-ai-content-tab-button active","data-tab":"original",onClick:e=>this.switchTab(e,"original")},r("Original Content","echo-knowledge-base")),n("button",{className:"epkb-ai-content-tab-button","data-tab":"processed",onClick:e=>this.switchTab(e,"processed")},r("Processed Content","echo-knowledge-base"))),n("div",{className:"epkb-ai-content-tabs-content"},n("div",{className:"epkb-ai-content-tab-panel active","data-panel":"original"},n("pre",{className:"epkb-ai-content-display"},a.doc_content||r("No content available","echo-knowledge-base"))),n("div",{className:"epkb-ai-content-tab-panel","data-panel":"processed"},n("pre",{className:"epkb-ai-content-display"},a.processed_content||r("No processed content available","echo-knowledge-base"))))))));if(this.root&&typeof this.root.render==="function"){this.root.render(c)}}switchTab(e,t){const a=e.target.closest(".epkb-ai-view-content-dialog");a.querySelectorAll(".epkb-ai-content-tab-button").forEach((e=>{e.classList.toggle("active",e.dataset.tab===t)}));a.querySelectorAll(".epkb-ai-content-tab-panel").forEach((e=>{e.classList.toggle("active",e.dataset.panel===t)}))}close(){if(this.root&&typeof this.root.unmount==="function"){this.root.unmount();this.root=null}else if(this.container){const{unmountComponentAtNode:e}=wp.element;if(typeof e==="function"){e(this.container)}else{this.container.innerHTML=""}}if(this.container&&this.container.parentNode){this.container.parentNode.removeChild(this.container);this.container=null}this.currentId=null}}window.EPKB_AI_ViewContentDialog=new w})();