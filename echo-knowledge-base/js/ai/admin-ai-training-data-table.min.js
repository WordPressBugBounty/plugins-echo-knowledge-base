(function(){"use strict";const{useState:e,useEffect:t,useCallback:a,createElement:n,Fragment:s,useContext:o,useRef:i,useMemo:l,createRoot:c}=wp.element;const{__:r}=wp.i18n;const{showError:d,showSuccess:p,makeApiRequest:u,showConfirmDialog:g,formatServerDateTime:b,useTableSearch:f}=window.EPKB_AI_Util_React||{};const{useSyncContext:m}=window.EPKB_AI_Sync||{};const h=()=>{try{const e=o(window.EPKB_AI_TrainingDataCacheContext);return e||null}catch(e){return null}};const k=({collectionId:c,collectionName:m="",hasApiKey:k=true,onSelectedIdsChange:y,onBulkDeleteCallback:w,onSelectAllCallback:_,onTotalItemsChange:N,onTrainingDataChange:v,refreshTrigger:S=0,syncProgress:C=null,isSyncing:x=false,onFilterStateChange:D,initialStats:I=null,initialData:A=null,onStatsUpdate:E=null,selectedIds:P=null,onNoteEdit:T=null,isAIProEnabled:$=false,onActiveStatusTabChange:z=null,onStatusCountsChange:R=null})=>{const[B,L]=e((()=>{if(A){if(A.all&&A.all.data){return A.all.data}else if(A.data){return A.data}}return[]}));const[O,j]=e([]);const F=P!==null?P:O;const[K,M]=e((()=>{if(I&&Object.keys(I).length>0){return{added:0,updated:0,outdated:0,error:0,pending:0,...I}}return{added:0,updated:0,outdated:0,error:0,pending:0}}));const[U,q]=e((()=>!(A&&(A.all||A.data))));const[H,V]=e(1);const[J,G]=e((()=>{if(A){if(A.all&&A.all.pagination){return A.all.pagination.total_pages}else if(A.pagination){return A.pagination.total_pages}}return 1}));const[W,Y]=e(false);const[Q,X]=e(new Set);const[Z,ee]=e(new Set);const te=20;const[ae,ne]=e([]);const[se,oe]=e(false);const[ie,le]=e("all");const[ce,re]=e([]);const[de,pe]=e([]);const[ue,ge]=e(null);const[be,fe]=e("asc");const[me,he]=e(false);const[ke,ye]=e(false);const[we,_e]=e("");const[Ne,ve]=e([]);const Se=a((async e=>{_e(e||"");V(1);return null}),[]);const{searchTerm:Ce,displayedData:xe,isSearching:De,searchMessage:Ie,handleSearchChange:Ae,clearSearch:Ee}=f({data:B,allData:null,onServerSearch:Se,searchFields:["title","type_name","type","item_type","url","item_id"]});const Pe=a((()=>we||ie!=="all"||de.length>0),[we,ie,de]);const Te=a((()=>{if(ie==="sync"){return[...ae].reverse()}let e=[...xe];e.sort(((e,t)=>{const a=e&&e.status==="updating";const n=t&&t.status==="updating";if(a!==n){return a?-1:1}if(!ue)return 0;let s=e[ue];let o=t[ue];if(ue==="item_id"){s=parseInt(s)||0;o=parseInt(o)||0}if(ue==="last_synced"){s=new Date(s||0).getTime();o=new Date(o||0).getTime()}if(s<o)return be==="asc"?-1:1;if(s>o)return be==="asc"?1:-1;return 0}));return e}),[xe,ie,ae,ue,be]);const $e=a((()=>Te()),[Te]);const ze=a((()=>J),[J]);const Re=h();const Be=window.EPKB_AI_SyncContext?o(window.EPKB_AI_SyncContext):null;const Le=a((()=>{const e=ie||"all";const t=de.length>0?`_type_${de.join("-")}`:"";const a=we?`_search_${encodeURIComponent(we)}`:"";return`collection_${c}_status_${e}_page_${H}${t}${a}`}),[c,H,ie,de,we]);const Oe=a(((e,t)=>{L((a=>a.map((a=>{if(a.id===e){return{...a,status:t}}return a}))))}),[]);const je=i(true);const Fe=i(false);t((()=>{je.current=true;Fe.current=false;V(1);le("all");pe([]);_e("")}),[c]);t((()=>{V(1)}),[ie,de,we]);t((()=>{const e=()=>{if(!A||Fe.current){return false}if(H!==1||de.length>0||we){return false}if(ie==="sync"){return false}if(A[ie]&&A[ie].data!==undefined){return true}if(ie==="all"&&A.data){return true}return false};if(e()){let e,t;if(A[ie]){e=A[ie].data;t=A[ie].pagination}else if(ie==="all"&&A.data){e=A.data;t=A.pagination}L(e);G(t?t.total_pages:1);q(false);je.current=false;if(v){v(e)}}else{Ke()}}),[H,ie,de,we,A,v]);const Ke=a((async(e=false)=>{const t=Le();const a={collection_id:c,page:H,per_page:te};if(ie!=="all"&&ie!=="sync"){a.status=ie}if(de.length>0){a.type=de[0]}if(we){a.search=we}const n=!je.current&&!e&&Re;if(n){const e=Re.get(t);if(e&&e.data&&e.totalPages!==undefined){L(e.data);G(e.totalPages);if(e.availableTypes){ve(e.availableTypes)}if(v){v(e.data)}q(false);u("training-data",{params:a}).then((a=>{if(a.success){if(a.status_counts){const e={added:0,updated:0,outdated:0,error:0,pending:0,...a.status_counts};M(e);if(R){R(e)}}const n=a.pagination?Number(a.pagination.total_pages):1;if(n!==e.totalPages){G(n)}if(a.available_types){ve(a.available_types)}if(a.data){const s=a.data;const o=JSON.stringify(e.data);const i=JSON.stringify(s);if(o!==i){L((e=>{const o=new Map;e.forEach((e=>{if(e&&e.status==="updating"){o.set(String(e.item_id),e)}}));const i=s.map((e=>{const t=o.get(String(e.item_id));if(t){return{...e,status:"updating",last_synced:t.last_synced||e.last_synced}}return e}));if(Re){Re.set(t,{data:s,totalPages:n,availableTypes:a.available_types||[],timestamp:Date.now()})}if(v){v(i)}return i}))}else if(n!==e.totalPages){if(Re){Re.set(t,{data:e.data,totalPages:n,availableTypes:a.available_types||e.availableTypes||[],timestamp:Date.now()})}}}}})).catch((()=>{}));return}}q(true);try{const e=await u("training-data",{params:a});if(e.success){const a=e.data||[];const n=e.status_counts||{};const s=e.available_types||[];const o=e.pagination?Number(e.pagination.total_pages):1;if(Re){Re.set(t,{data:a,totalPages:o,availableTypes:s,timestamp:Date.now()})}ve(s);L((e=>{const t=new Map;const n=new Set;const s=new Map;e.forEach((e=>{if(e.summarized_content){t.set(e.id,e.summarized_content)}if(e.status==="updating"){n.add(String(e.item_id));if(e.last_synced){s.set(String(e.item_id),e.last_synced)}}}));return a.map((e=>{const a=t.get(e.id);const o=n.has(String(e.item_id));const i=a&&!e.summarized_content?{...e,summarized_content:a}:e;if(o){return{...i,status:"updating",last_synced:s.get(String(e.item_id))||i.last_synced}}return i}))}));G(o);const i={added:0,updated:0,outdated:0,error:0,pending:0,...n};M(i);if(R){R(i)}if(v){v(a)}}}catch(e){if(e.message!=="API key required"&&e.code!=="fetch_error"){console.error("Failed to fetch training data:",e);d(r("Failed to load training data","echo-knowledge-base"))}}finally{q(false);if(je.current){je.current=false}}}),[c,H,Le,v,R,Re,Pe,ie,de,we]);const Me=a((e=>{if(e){const e=$e();j(e.map((e=>e.id)))}else{j([])}}),[$e]);const Ue=async()=>{Y(true);Fe.current=true;if(Re){Re.clearCollection(c)}const e=Be&&Be.job&&(Be.job.status==="running"||Be.job.status==="scheduled");if(!e){oe(false);ne([]);if(ie==="sync"){le("all")}}await Ke(true);Y(false);p(r("Data refreshed successfully","echo-knowledge-base"))};const qe=a((async()=>{if(!O.length)return;const e=await g({title:r("Delete Selected Items","echo-knowledge-base"),message:r("Are you sure you want to delete the selected items?","echo-knowledge-base"),confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!e){return}ee(new Set(O));try{const e=await u("training-data/delete-selected",{method:"DELETE",data:{ids:O}});p(r("Items deleted successfully","echo-knowledge-base"));j([]);Fe.current=true;setTimeout((()=>{ee(new Set);if(Re){Re.clearCollection(c)}Ke(true)}),500)}catch(e){console.error("Delete error:",e);if(e.message!=="API key required"&&!e._errorDisplayed){d(e.message||r("Failed to delete items","echo-knowledge-base"))}ee(new Set)}}),[O,Le,Re,Ke]);t((()=>{if(S>0){Fe.current=true;if(Re){Re.clearCollection(c)}Ke(true);j([])}}),[S]);t((()=>{const e=e=>{if(!e.target.closest(".epkb-ai-table-header-content")){he(false);ye(false)}};document.addEventListener("click",e);return()=>document.removeEventListener("click",e)}),[]);t((()=>{if(y){y(O)}}),[O,y]);t((()=>{if(w&&qe){w((()=>{qe()}))}}),[w,qe]);t((()=>{if(_){_(Me)}}),[_,Me]);const He=l((()=>{if(K){return Object.keys(K).filter((e=>["added","updated","outdated","error","pending"].includes(e))).reduce(((e,t)=>e+(K[t]||0)),0)}return 0}),[K]);t((()=>{if(N){N(He)}}),[He,N]);t((()=>{if(D){const e=Ce!==""||ce.length>0||de.length>0;D(e)}}),[Ce,ce,de,D]);t((()=>{if(z){z(ie)}}),[ie,z]);const Ve=i(null);t((()=>{if(Be&&Be.job){const e=Be.job.status;if(e==="running"||e==="scheduled"){const e=Ve.current!=="running"&&Ve.current!=="scheduled";if(!se){oe(true);le("sync")}else if(ie!=="sync"){le("sync")}if(e||!se){ne([]);const e=[...F];const t=Be.job.total>0&&e.length===0;if(e.length>0){const t=e.map((e=>{const t=B.find((t=>t.id===e));if(t){return{id:t.id,item_id:t.item_id,title:t.title,type:t.item_type||t.type||"Article",type_name:t.type_name||t.type||"Article",status:"syncing",last_synced:(new Date).toISOString()}}return null})).filter((e=>e!==null));ne(t);setTimeout((()=>{j([]);if(y){y([])}}),100)}else if(t){ne([])}else{ne([])}}}Ve.current=e;if(e==="completed"||e==="canceled"){ne((t=>t.map((t=>({...t,status:e==="completed"?"completed":t.status==="completed"?"completed":"canceled"})))))}}}),[Be?.job?.status,se,F,B,y]);t((()=>{if(Be&&Be.registerPostUpdateHandler){const e=e=>{if(!se){return}ne((t=>{let a=[...t];e.forEach((e=>{const t=a.findIndex((t=>String(t.item_id)===String(e.id)||String(t.id)===String(e.id)));if(t!==-1){a[t]={...a[t],status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status,error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()}}else{const t=B.find((t=>String(t.item_id)===String(e.id)||String(t.id)===String(e.id)));if(t){a.push({id:t.id,item_id:t.item_id,title:t.title,type:t.item_type||t.type||"Article",type_name:t.type_name||t.type||"Article",status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status||"syncing",error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()})}else if(e.title||e.id){a.push({id:e.id,item_id:e.id,title:e.title||`Item ${e.id}`,type:e.type||"Article",type_name:e.type_name||e.type||"Article",status:e.status==="synced"?"completed":e.status==="updating"?"syncing":e.status||"syncing",error_message:e.error_message||e.message,last_synced:e.last_synced||(new Date).toISOString()})}}}));a.sort(((e,t)=>{if(e.status==="syncing"&&t.status!=="syncing")return-1;if(e.status!=="syncing"&&t.status==="syncing")return 1;return 0}));return a}))};Be.registerPostUpdateHandler(e);return()=>{if(Be.unregisterPostUpdateHandler){Be.unregisterPostUpdateHandler(e)}}}}),[Be,B,se]);const Je=e=>{if(O.includes(e)){j(O.filter((t=>t!==e)))}else{j([...O,e])}if(y){y([...O,e],true)}};const Ge=async e=>{const t=Array.isArray(e)?e:[e];const a=await g({title:r("Delete Items","echo-knowledge-base"),message:r("Are you sure you want to delete the selected items?","echo-knowledge-base"),confirmText:r("Delete","echo-knowledge-base"),cancelText:r("Cancel","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-danger"});if(!a){return}ee(new Set(t));try{await u("training-data/delete-selected",{method:"DELETE",data:{ids:t}});p(r("Items deleted successfully","echo-knowledge-base"));j([]);Fe.current=true;setTimeout((()=>{ee(new Set);if(Re){Re.clearCollection(c)}Ke(true)}),500)}catch(e){if(e.message!=="API key required"&&!e._errorDisplayed){d(e.message||r("Failed to delete items","echo-knowledge-base"))}ee(new Set)}};const We=e=>{const t={added:{label:r("Added","echo-knowledge-base"),className:"status-added"},updated:{label:r("Updated","echo-knowledge-base"),className:"status-updated"},outdated:{label:r("Outdated","echo-knowledge-base"),className:"status-outdated"},error:{label:r("Error","echo-knowledge-base"),className:"status-error"},pending:{label:r("Pending","echo-knowledge-base"),className:"status-pending"},syncing:{label:r("Syncing","echo-knowledge-base"),className:"status-syncing"},completed:{label:r("Completed","echo-knowledge-base"),className:"status-completed"},canceled:{label:r("Canceled","echo-knowledge-base"),className:"status-canceled"}};const a=t[e]||{label:e,className:"status-pending"};return n("span",{className:`epkb-ai-status-badge ${a.className}`},a.label)};const Ye=()=>["added","updated","outdated","error","pending"];const Qe=()=>{if(Ne&&Ne.length>0){return Ne}const e=new Map;const t=B;t.forEach((t=>{const a=t.item_type||t.type||"Article";const n=t.type_name||t.type||"Article";if(!e.has(a)){e.set(a,n)}}));return Array.from(e,(([e,t])=>({value:e,label:t}))).sort(((e,t)=>e.label.localeCompare(t.label)))};const Xe=async e=>{le(e);V(1);if(z){z(e)}const t=e!=="all"||de.length>0};const Ze=async e=>{let t;if(de.includes(e)){t=de.filter((t=>t!==e))}else{t=[...de,e]}pe(t);const a=ie!=="all"||t.length>0};const et=e=>{if(ue===e){fe(be==="asc"?"desc":"asc")}else{ge(e);fe("asc")}};const tt=a((()=>{const e={};if(K){Object.keys(K).forEach((t=>{if(["added","updated","outdated","error","pending"].includes(t)){const a=K[t]||0;if(a>0){e[t]=a}}}))}return e}),[K]);if(!U&&B.length===0&&!Pe()){return n("div",{className:"epkb-ai-data-source-table"},n("div",{className:"epkb-ai-empty-state"},n("div",{className:"epkb-ai-empty-icon"},n("span",{className:"epkbfa epkbfa-file-text-o"})),n("h4",null,r("No published articles found","echo-knowledge-base")),n("p",null,r("No published knowledge base articles were found. Create and publish some articles first, then they will automatically appear here ready for AI synchronization.","echo-knowledge-base")),n("button",{className:"epkb-ai-button epkb-ai-button-success",onClick:Ue,disabled:W,style:{backgroundColor:"#46b450",borderColor:"#46b450",color:"#fff",padding:"8px 16px",fontSize:"14px",marginTop:"15px"}},W?r("Refreshing...","echo-knowledge-base"):n(s,null,n("span",{className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),r("Refresh","echo-knowledge-base")))))}return n("div",{className:"epkb-ai-data-source-table"},n("div",{className:"epkb-ai-table-content"},n("div",{className:"epkb-ai-table-actions"},n("div",{className:"epkb-ai-table-actions-left"},n("div",{className:"epkb-ai-status-tabs-bar"},(()=>{const e=tt();const t=["all"];const a={all:r("All","echo-knowledge-base"),sync:r("Sync","echo-knowledge-base"),error:r("Error","echo-knowledge-base"),pending:r("Pending","echo-knowledge-base"),outdated:r("Outdated","echo-knowledge-base"),added:r("Added","echo-knowledge-base"),updated:r("Updated","echo-knowledge-base")};if(se){t.push("sync")}if(e.error>0)t.push("error");if(e.pending>0)t.push("pending");if(e.outdated>0)t.push("outdated");if(e.added>0)t.push("added");if(e.updated>0)t.push("updated");return t.map((t=>{let s;if(t==="all"){s=Object.values(e).reduce(((e,t)=>e+t),0)}else if(t==="sync"){s=ae.length}else{s=e[t]||0}return n("button",{key:t,className:`epkb-ai-status-tab ${t===ie?"active":""} ${t==="sync"?"epkb-ai-sync-tab":""}`,onClick:()=>Xe(t)},n("span",{className:"epkb-ai-tab-label"},a[t]),n("span",{className:"epkb-ai-tab-count"},`(${s})`))}))})(),x&&C&&n("div",{className:"epkb-ai-sync-progress-indicator"},n("span",{className:C.isRunning!==false?"epkb-ai-sync-icon epkbfa epkbfa-refresh fa-spin":"epkb-ai-sync-icon epkbfa epkbfa-check-circle",style:C.isRunning===false?{color:"#46b450"}:{}}),n("span",{className:"epkb-ai-sync-text"},C.isRunning!==false?r("Syncing","echo-knowledge-base"):r("Sync Complete","echo-knowledge-base")),n("span",{className:"epkb-ai-sync-percentage"},`${C.percentage||0}%`),n("span",{className:"epkb-ai-sync-separator"},"•"),n("span",{className:"epkb-ai-sync-total"},`${C.synced||0}/${C.total||0}`)))),n("div",{className:"epkb-ai-table-actions-right"},n("div",{className:"epkb-ai-search-input"},n("input",{type:"text",placeholder:r("Search by title, type, URL, or ID...","echo-knowledge-base"),value:Ce,onChange:e=>Ae(e.target.value)}),n("span",{className:"epkb-ai-search-icon epkbfa epkbfa-search"})),n("button",{className:"epkb-ai-button epkb-ai-button-success",onClick:Ue,disabled:U||W||x,style:{backgroundColor:"#46b450",borderColor:"#46b450",color:"#fff",padding:"6px 12px",fontSize:"14px",marginLeft:"10px",marginRight:O.length>0?"15px":"0"}},W?r("Refreshing...","echo-knowledge-base"):n(s,null,n("span",{className:"epkbfa epkbfa-refresh",style:{marginRight:"5px"}}),r("Refresh","echo-knowledge-base"))),O.length>0&&n("span",{className:"epkb-ai-selected-count"},`${O.length} ${r("selected","echo-knowledge-base")}`))),U?n("div",{className:"epkb-ai-loading"},ie==="sync"?r("Preparing sync...","echo-knowledge-base"):r("Loading training data...","echo-knowledge-base")):n(s,null,n("table",{className:"epkb-ai-data-table"},n("thead",null,n("tr",null,n("th",{className:"epkb-ai-table-checkbox"},n("input",{type:"checkbox",checked:(()=>{const e=$e();return F.length===e.length&&e.length>0})(),onChange:e=>Me(e.target.checked)})),n("th",null,r("Status","echo-knowledge-base")),n("th",null,n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Title","echo-knowledge-base")),n("span",{className:`epkb-ai-sort-label ${ue==="title"?"active":""}`,onClick:()=>et("title")},ue==="title"?(be==="asc"?"↑":"↓")+" "+r("Sort","echo-knowledge-base"):r("Sort","echo-knowledge-base")))),n("th",{style:{position:"relative"}},n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Type","echo-knowledge-base")),n("span",{className:`epkb-ai-filter-label ${de.length>0?"active":""}`,onClick:async()=>{ye(!ke)}},r("Filter","echo-knowledge-base")),ke&&n("div",{className:"epkb-ai-filter-dropdown",onClick:e=>e.stopPropagation()},Qe().map((e=>n("label",{key:e.value,className:"epkb-ai-filter-option"},n("input",{type:"checkbox",checked:de.includes(e.value),onChange:()=>Ze(e.value)}),n("span",null,e.label))))))),n("th",null,n("div",{className:"epkb-ai-table-header-content"},n("span",null,r("Updated","echo-knowledge-base")),n("span",{className:`epkb-ai-sort-label ${ue==="last_synced"?"active":""}`,onClick:()=>et("last_synced")},ue==="last_synced"?(be==="asc"?"↑":"↓")+" "+r("Sort","echo-knowledge-base"):r("Sort","echo-knowledge-base")))))),n("tbody",null,$e().length===0?n("tr",null,n("td",{colSpan:7,style:{textAlign:"center",padding:"20px"}},r("No training data found","echo-knowledge-base"))):$e().map((e=>{let t="";if(Z.has(e.id)){t="epkb-ai-deleting-row"}else if(e.status==="updating"||e.status==="syncing"){t="epkb-ai-syncing-row"}else if(e.status==="completed"){t="epkb-ai-sync-completed"}else if(Q.has(e.item_id)){t="epkb-ai-recently-synced"}const a=ie==="sync"?e.status==="syncing"?"syncing":e.status==="completed"?"updated":e.status==="canceled"?"canceled":e.status:e.status;return n("tr",{key:e.id,className:t,"data-item-id":e.id},n("td",{className:"epkb-ai-table-checkbox"},ie==="sync"?null:n("input",{type:"checkbox",checked:F.includes(e.id),onChange:()=>Je(e.id)})),n("td",null,We(a)),n("td",{className:"epkb-ai-table-title"},n("div",{style:{display:"flex",alignItems:"center",gap:"10px"}},e.type==="epkb_kb_files"?n("span",{style:{flex:1}},e.title):n("a",{href:`${window.epkb_ai_api.admin_url}post.php?post=${e.item_id}&action=edit`,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit",flex:1}},e.title),n("button",{className:"epkb-ai-view-content-btn",onClick:t=>{t.preventDefault();t.stopPropagation();if((e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&$&&T){T({id:e.item_id,training_id:e.id,title:e.title})}else{if(window.EPKB_AI_ViewContentDialog&&typeof window.EPKB_AI_ViewContentDialog.show==="function"){window.EPKB_AI_ViewContentDialog.show(e.id,e.title,e)}}},title:(e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&$?r("Edit note","echo-knowledge-base"):e.status==="error"?r("View Error","echo-knowledge-base"):r("View content","echo-knowledge-base"),style:{background:"transparent",border:"none",cursor:"pointer",padding:"4px",color:e.status==="error"?"#d54e21":"#0073aa",fontSize:"16px"}},n("span",{className:(e.type==="aipro_ai_note"||e.type==="epkb_ai_note")&&$?"epkbfa epkbfa-edit":e.status==="error"?"epkbfa epkbfa-exclamation-triangle":"epkbfa epkbfa-eye"})))),n("td",null,e.type==="epkb_kb_files"?r("KB Files","echo-knowledge-base"):e.type_name||e.type||r("Article","echo-knowledge-base")),n("td",{className:"epkb-ai-table-date"},b&&(e.last_synced||e.created)?b(e.last_synced||e.created,r("Never","echo-knowledge-base")):r("Never","echo-knowledge-base")))})))),(Ie||De)&&n("div",{className:"epkb-ai-search-message",style:{textAlign:"center",padding:"10px",color:"#666",fontStyle:"italic"}},De?r("Searching server for more results...","echo-knowledge-base"):Ie),(()=>{const e=ze();if(e<=1){return null}return n("div",{className:"epkb-ai-pagination"},n("button",{disabled:H===1,onClick:()=>V(H-1),className:"epkb-ai-button epkb-ai-button-secondary"},r("Previous","echo-knowledge-base")),n("span",{className:"epkb-ai-page-info"},`${r("Page","echo-knowledge-base")} ${H} ${r("of","echo-knowledge-base")} ${e}`),n("button",{disabled:H===e,onClick:()=>V(H+1),className:"epkb-ai-button epkb-ai-button-secondary"},r("Next","echo-knowledge-base")))})())))};window.EPKB_AI_DataSourceTable=k;class y{constructor(){this.container=null;this.root=null;this.currentId=null}async show(e,t,a=null){this.currentId=e;if(!this.container){this.container=document.createElement("div");this.container.id="epkb-ai-view-content-dialog-root";document.body.appendChild(this.container);const{render:e,unmountComponentAtNode:t}=wp.element;if(typeof c==="function"){this.root=c(this.container)}else if(typeof e==="function"){this.root={render:t=>e(t,this.container),unmount:()=>{if(typeof t==="function"){t(this.container)}else{this.container.innerHTML=""}}}}}if(a&&a.status==="error"&&a.error_message){this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:a.error_message,errorPostId:a.item_id,loading:false});return}this.renderDialog({title:t||r("Loading...","echo-knowledge-base"),loading:true});try{const n=await u(`training-data/${e}/content`,{method:"GET"});if(n&&n.data){const e=n.data;const s=a?.item_id||n.data?.item_id;if(s){const t=`epkb_summarized_content_${s}`;const a=sessionStorage.getItem(t);if(a){e.summarized_content=a}}this.renderDialog({title:e.title||t,content:e,loading:false})}else if(n&&n.success===false&&n.message){this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:n.message,errorPostId:a?.item_id,loading:false})}else{throw new Error(r("Failed to load content","echo-knowledge-base"))}}catch(e){console.error("Failed to load content:",e);this.renderDialog({title:t||r("Error Details","echo-knowledge-base"),error:true,errorMessage:e.message||r("Failed to load content","echo-knowledge-base"),errorPostId:a?.item_id,loading:false})}}renderDialog(e){const{title:t,content:a,loading:s,error:o,errorMessage:i,errorPostId:l}=e;const c=n("div",{className:"epkb-ai-view-content-dialog-overlay",onClick:e=>{if(e.target.className==="epkb-ai-view-content-dialog-overlay"){this.close()}}},n("div",{className:"epkb-ai-view-content-dialog"},n("div",{className:"epkb-ai-dialog-header",style:{position:"relative"}},n("h3",null,t),(a?.item_id||l)&&n("span",{style:{position:"absolute",right:"50px",top:"50%",transform:"translateY(-50%)",fontSize:"14px",color:"#666",fontWeight:"normal"}},n("strong",null,r("Post ID:","echo-knowledge-base"))," ",a?.item_id||l),n("button",{className:"epkb-ai-dialog-close",onClick:()=>this.close(),"aria-label":r("Close","echo-knowledge-base")},n("span",{className:"epkbfa epkbfa-times"}))),n("div",{className:"epkb-ai-dialog-body"},s?n("div",{className:"epkb-ai-loading-spinner"},n("span",{className:"epkbfa epkbfa-spinner fa-spin"}),n("span",null," "+r("Loading content...","echo-knowledge-base"))):o?n("div",{className:"epkb-ai-error-content"},n("div",{className:"epkb-ai-error-icon"},n("span",{className:"epkbfa epkbfa-exclamation-triangle",style:{fontSize:"48px",color:"#d54e21"}})),n("h4",{style:{color:"#d54e21",marginTop:"20px"}},r("Error Processing Content","echo-knowledge-base")),n("div",{className:"epkb-ai-error-message",style:{marginTop:"15px",padding:"15px",backgroundColor:"#fef2f2",border:"1px solid #fee",borderRadius:"4px"}},n("p",{style:{margin:0,color:"#666"}},i))):a&&n("div",{className:"epkb-ai-content-tabs"},n("div",{className:"epkb-ai-content-tabs-header"},n("button",{className:"epkb-ai-content-tab-button active","data-tab":"original",onClick:e=>this.switchTab(e,"original")},r("Original Content","echo-knowledge-base")),n("button",{className:"epkb-ai-content-tab-button","data-tab":"processed",onClick:e=>this.switchTab(e,"processed")},r("Processed Content","echo-knowledge-base")),n("button",{className:"epkb-ai-content-tab-button","data-tab":"summarized",onClick:e=>this.switchTab(e,"summarized")},r("Summarized Content","echo-knowledge-base"))),n("div",{className:"epkb-ai-content-tabs-content"},n("div",{className:"epkb-ai-content-tab-panel active","data-panel":"original"},n("pre",{className:"epkb-ai-content-display"},a.doc_content||r("No content available","echo-knowledge-base"))),n("div",{className:"epkb-ai-content-tab-panel","data-panel":"processed"},n("pre",{className:"epkb-ai-content-display"},a.processed_content||r("No processed content available","echo-knowledge-base"))),n("div",{className:"epkb-ai-content-tab-panel","data-panel":"summarized"},n("pre",{className:"epkb-ai-content-display"},a.summarized_content||r("No summarized content available","echo-knowledge-base"))))))));if(this.root&&typeof this.root.render==="function"){this.root.render(c)}}switchTab(e,t){const a=e.target.closest(".epkb-ai-view-content-dialog");a.querySelectorAll(".epkb-ai-content-tab-button").forEach((e=>{e.classList.toggle("active",e.dataset.tab===t)}));a.querySelectorAll(".epkb-ai-content-tab-panel").forEach((e=>{e.classList.toggle("active",e.dataset.panel===t)}))}close(){if(this.root&&typeof this.root.unmount==="function"){this.root.unmount();this.root=null}else if(this.container){const{unmountComponentAtNode:e}=wp.element;if(typeof e==="function"){e(this.container)}else{this.container.innerHTML=""}}if(this.container&&this.container.parentNode){this.container.parentNode.removeChild(this.container);this.container=null}this.currentId=null}}window.EPKB_AI_ViewContentDialog=new y})();