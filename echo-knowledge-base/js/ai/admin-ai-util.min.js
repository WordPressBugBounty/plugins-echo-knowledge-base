(function(){"use strict";const{apiFetch:t}=wp;const{__:e}=wp.i18n;window.EPKB_AI_Util_React=window.EPKB_AI_Util_React||{};const n=(t,e="info",n=1e4)=>{o(t,e,n)};const o=(t,n,o)=>{const i=s();const a=i.querySelectorAll(`.epkb-ai-notification-${n}`);for(const e of a){const n=e.querySelector(".epkb-ai-notification-message");if(n&&n.textContent===t){e.style.animation="none";setTimeout((()=>{e.style.animation="slideDown 0.3s ease-out"}),10);return}}const r=document.createElement("div");let c="";let l="";switch(n){case"error":c="dashicons-warning";l="#dc3545";break;case"success":c="dashicons-yes-alt";l="#28a745";break;case"warning":c="dashicons-info";l="#ffc107";break;default:c="dashicons-info-outline";l="#007cba"}r.className=`epkb-ai-notification epkb-ai-notification-${n}`;r.style.borderLeft=`4px solid ${l}`;r.innerHTML=`\n\t\t\t<div class="epkb-ai-notification-content" style="\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tpadding: 20px 24px;\n\t\t\t\tmin-height: 80px;\n\t\t\t">\n\t\t\t\t<span class="dashicons ${c}" style="\n\t\t\t\t\tfont-size: 48px;\n\t\t\t\t\tcolor: ${l};\n\t\t\t\t\tmargin-right: 34px;\n\t\t\t\t\tflex-shrink: 0;\n\t\t\t\t\tdisplay: flex;\n\t\t\t\t\talign-items: center;\n\t\t\t\t"></span>\n\t\t\t\t<span class="epkb-ai-notification-message" style="\n\t\t\t\t\tflex: 1;\n\t\t\t\t\tfont-size: 16px;\n\t\t\t\t\tline-height: 1.5;\n\t\t\t\t\tcolor: #333;\n\t\t\t\t\tfont-weight: 500;\n\t\t\t\t">${p(t)}</span>\n\t\t\t\t<button class="epkb-ai-notification-close" aria-label="${e("Close","echo-knowledge-base")}" style="\n\t\t\t\t\tbackground: none;\n\t\t\t\t\tborder: none;\n\t\t\t\t\tcursor: pointer;\n\t\t\t\t\tpadding: 8px;\n\t\t\t\t\tmargin-left: 16px;\n\t\t\t\t\topacity: 0.6;\n\t\t\t\t\ttransition: opacity 0.2s;\n\t\t\t\t" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">\n\t\t\t\t\t<span class="dashicons dashicons-dismiss" style="\n\t\t\t\t\t\tfont-size: 24px;\n\t\t\t\t\t\tcolor: #666;\n\t\t\t\t\t"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;if(!document.querySelector("#epkb-notification-styles")){const t=document.createElement("style");t.id="epkb-notification-styles";t.innerHTML=`\n\t\t\t\t@keyframes slideDown {\n\t\t\t\t\tfrom {\n\t\t\t\t\t\ttransform: translateY(-20px);\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t}\n\t\t\t\t\tto {\n\t\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t.epkb-ai-notification-fade-out {\n\t\t\t\t\tanimation: fadeOut 0.3s ease-out forwards;\n\t\t\t\t}\n\t\t\t\t@keyframes fadeOut {\n\t\t\t\t\tfrom {\n\t\t\t\t\t\topacity: 1;\n\t\t\t\t\t\ttransform: translateY(0);\n\t\t\t\t\t}\n\t\t\t\t\tto {\n\t\t\t\t\t\topacity: 0;\n\t\t\t\t\t\ttransform: translateY(-10px);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t`;document.head.appendChild(t)}const d=r.querySelector(".epkb-ai-notification-close");d.addEventListener("click",(()=>{r.classList.add("epkb-ai-notification-fade-out");setTimeout((()=>r.remove()),300)}));i.appendChild(r);if(o>0){setTimeout((()=>{if(r.parentNode){r.classList.add("epkb-ai-notification-fade-out");setTimeout((()=>r.remove()),300)}}),o)}};const s=()=>{let t=document.getElementById("epkb-ai-notifications");if(!t){t=document.createElement("div");t.id="epkb-ai-notifications";t.className="epkb-ai-notifications-container";const e=document.querySelector(".epkb-ai-tabs-nav");if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}else{document.body.appendChild(t)}}return t};const i=(t,e=1e4)=>{n(t,"success",e)};const a=(t,e=1e4)=>{n(t,"error",e)};const r=(t,e=1e4)=>{n(t,"info",e)};const c=(t,e=1e4)=>{n(t,"warning",e)};const l={activeRequests:new Map,cancelRequest(t){const e=this.activeRequests.get(t);if(e){e.abort();this.activeRequests.delete(t)}},registerRequest(t){this.cancelRequest(t);const e=new AbortController;this.activeRequests.set(t,e);return e},completeRequest(t){this.activeRequests.delete(t)}};const d=async(n,o={})=>{const s={path:`/epkb-admin/v1/${n}`,method:"GET",headers:{"Content-Type":"application/json"}};const i={...s,...o};let r=null;let c=null;if(n==="sync-progress"&&!o.allowConcurrent){r="sync-progress";c=l.registerRequest(r);i.signal=c.signal}else if(o.signal){i.signal=o.signal}if(i.params&&i.method==="GET"){const t=new URLSearchParams(i.params).toString();i.path+=`?${t}`;delete i.params}if(i.data&&["POST","PUT","PATCH","DELETE"].includes(i.method)){i.body=JSON.stringify(i.data);delete i.data}try{const e=await t(i);if(e.new_token){u(e.new_token)}return e}catch(t){if(t.name==="AbortError"){throw t}if(t.code==="invalid_session"||t.code==="no_session"){a(e("Your session has expired. Please refresh the page.","echo-knowledge-base"))}else if(t.code==="rate_limit_exceeded"){a(e("Too many requests. Please wait a moment and try again.","echo-knowledge-base"))}else if(t.message){a(t.message)}else{a(e("An unexpected error occurred. Please try again.","echo-knowledge-base"))}throw t}finally{if(r){l.completeRequest(r)}}};const u=e=>{t.use(t.createNonceMiddleware(e));const n=document.getElementById("epkb-ai-admin-react-root");if(n&&n.dataset.epkbAiSettings){try{const t=JSON.parse(n.dataset.epkbAiSettings);t.nonce=e;n.dataset.epkbAiSettings=JSON.stringify(t)}catch(t){console.error("Failed to update nonce in settings",t)}}};const p=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,(t=>e[t]))};const f=(t,e)=>{let n;return function o(...s){const i=()=>{clearTimeout(n);t(...s)};clearTimeout(n);n=setTimeout(i,e)}};const m=(t,e)=>{let n;return function(...o){if(!n){t.apply(this,o);n=true;setTimeout((()=>n=false),e)}}};const g=(t,e="default")=>{const n=t instanceof Date?t:new Date(t);if(isNaN(n.getTime())){return""}const o={default:{year:"numeric",month:"short",day:"numeric"},short:{month:"numeric",day:"numeric",year:"2-digit"},long:{weekday:"long",year:"numeric",month:"long",day:"numeric"},time:{hour:"2-digit",minute:"2-digit"},datetime:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},full:{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:true},compact:{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:true}};if(e==="datetime"||e==="full"||e==="compact"){return n.toLocaleString(undefined,o[e]||o.default)}return n.toLocaleDateString(undefined,o[e]||o.default)};const h=(t,e="-")=>{if(!t||t==="Never"){return e}let n;if(t.includes("T")){n=new Date(t)}else{const e=t.replace(" ","T")+"Z";n=new Date(e)}if(isNaN(n.getTime())){return t}const o=window.epkb_ai_api&&window.epkb_ai_api.gmt_offset?parseFloat(window.epkb_ai_api.gmt_offset):0;const s=new Date(n.getTime()+o*60*60*1e3);const i=new Date;const a=new Date(i.getTime()+o*60*60*1e3);const r=s.toDateString()===a.toDateString();let c=s.getUTCHours();const l=s.getUTCMinutes();const d=c>=12?"pm":"am";c=c%12;c=c?c:12;const u=l<10?"0"+l:l;const p=`${c}:${u}${d}`;if(r){return`today at ${p}`}const f=new Date(a);f.setDate(f.getDate()-1);if(s.toDateString()===f.toDateString()){return`yesterday at ${p}`}const m=["January","February","March","April","May","June","July","August","September","October","November","December"];const g=m[s.getUTCMonth()];const h=s.getUTCDate();return`${g} ${h} at ${p}`};const b=(t,e)=>{const n=Object.assign({},t);if(y(t)&&y(e)){Object.keys(e).forEach((o=>{if(y(e[o])){if(!(o in t)){Object.assign(n,{[o]:e[o]})}else{n[o]=b(t[o],e[o])}}else{Object.assign(n,{[o]:e[o]})}}))}return n};const y=t=>t&&typeof t==="object"&&!Array.isArray(t);const k=(t,e,n=undefined)=>e.split(".").reduce(((t,e)=>t&&t[e]!==undefined?t[e]:n),t);const w=(t,e,n)=>{const o=e.split(".");const s=o.pop();const i=o.reduce(((t,e)=>{if(!t[e]||typeof t[e]!=="object"){t[e]={}}return t[e]}),t);i[s]=n;return t};const x=t=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(t)};const T=(t="epkb")=>`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const v=async(t={})=>{const{title:n=e("Confirm Action","echo-knowledge-base"),message:o=e("Are you sure you want to proceed?","echo-knowledge-base"),confirmText:s=e("Confirm","echo-knowledge-base"),cancelText:i=e("Cancel","echo-knowledge-base"),confirmButtonClass:a="epkb-ai-button-primary",requireInput:r=false,inputPlaceholder:c="",inputMatch:l=""}=t;return new Promise((t=>{const e=document.createElement("div");e.className="epkb-ai-confirm-dialog-overlay";e.style.cssText=`\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tz-index: 9999999;\n\t\t\t`;const d=document.createElement("div");d.className="epkb-ai-confirm-dialog";d.style.cssText=`\n\t\t\t\tbackground: white;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 24px;\n\t\t\t\tmax-width: 500px;\n\t\t\t\twidth: 90%;\n\t\t\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n\t\t\t\tposition: relative;\n\t\t\t\tz-index: 9999999;\n\t\t\t`;let u=`\n\t\t\t\t<h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">${p(n)}</h3>\n\t\t\t\t<p style="margin: 0 0 20px 0; color: #555; line-height: 1.5;">${p(o)}</p>\n\t\t\t`;if(r){u+=`\n\t\t\t\t\t<input type="text" \n\t\t\t\t\t\t   id="epkb-dialog-input" \n\t\t\t\t\t\t   class="epkb-ai-input" \n\t\t\t\t\t\t   placeholder="${p(c)}"\n\t\t\t\t\t\t   style="width: 100%; margin-bottom: 20px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">\n\t\t\t\t`}u+=`\n\t\t\t\t<div style="display: flex; justify-content: flex-end; gap: 10px;">\n\t\t\t\t\t<button class="epkb-ai-button epkb-ai-button-secondary" id="epkb-dialog-cancel">\n\t\t\t\t\t\t${p(i)}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="epkb-ai-button ${a}" id="epkb-dialog-confirm">\n\t\t\t\t\t\t${p(s)}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`;d.innerHTML=u;e.appendChild(d);document.body.appendChild(e);const f=d.querySelector("#epkb-dialog-confirm");const m=d.querySelector("#epkb-dialog-cancel");const g=d.querySelector("#epkb-dialog-input");if(g){g.focus()}const h=()=>{if(r){const e=g.value.trim();if(l&&e!==l){g.style.borderColor="#e74c3c";g.focus();return}y();t(e)}else{y();t(true)}};const b=()=>{y();t(false)};const y=()=>{document.body.removeChild(e)};f.addEventListener("click",h);m.addEventListener("click",b);e.addEventListener("click",(t=>{if(t.target===e){b()}}));if(g){g.addEventListener("keypress",(t=>{if(t.key==="Enter"){h()}}))}document.addEventListener("keydown",(function t(e){if(e.key==="Escape"){document.removeEventListener("keydown",t);b()}}))}))};const S=({onAccept:t,i18n:e})=>{const{createElement:n}=wp.element;return n("div",{className:"epkb-ai-notice epkb-ai-notice-warning",style:{padding:"12px 15px",marginBottom:"20px",borderLeft:"4px solid #ffba00",backgroundColor:"#fff8e5"}},n("p",{style:{margin:"0"}},n("span",{className:"dashicons dashicons-info",style:{marginRight:"8px",color:"#ffba00"}}),"To use AI features, please configure your API key and accept the data privacy agreement in ",n("a",{href:"#",onClick:e=>{e.preventDefault();t()},style:{fontWeight:"bold",textDecoration:"underline"}},"General Settings"),"."))};const E=async t=>{if(t.responseJSON&&t.responseJSON.error&&t.responseJSON.message){const n=document.createElement("div");n.innerHTML=t.responseJSON.message;const o=n.textContent||n.innerText||"";if(o.includes("Login")||o.includes("refresh")||o.includes("E03")){const t=await v({title:e("Session Expired","echo-knowledge-base"),message:o.trim(),confirmText:e("Refresh Page","echo-knowledge-base"),cancelText:e("Close","echo-knowledge-base"),confirmButtonClass:"epkb-ai-button-primary"});if(t){window.location.reload()}return true}}return false};const C=(t=e("Loading...","echo-knowledge-base"))=>{const n=document.createElement("div");n.className="epkb-ai-dialog-overlay";n.style.cssText=`\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tz-index: 999999;\n\t\t`;const o=document.createElement("div");o.className="epkb-ai-dialog epkb-ai-loading-dialog";o.style.cssText=`\n\t\t\tbackground: white;\n\t\t\tpadding: 30px;\n\t\t\tborder-radius: 8px;\n\t\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n\t\t\tmax-width: 400px;\n\t\t\ttext-align: center;\n\t\t`;o.innerHTML=`\n\t\t\t<div class="epkb-loading-spinner" style="margin: 0 auto 20px; width: 40px; height: 40px;"></div>\n\t\t\t<p style="margin: 0; color: #555; font-size: 16px;">${p(t)}</p>\n\t\t`;n.appendChild(o);document.body.appendChild(n);return()=>{n.remove()}};const D=(t={})=>{const{data:n=[],allData:o=null,onServerSearch:s=null,searchFields:i=["title","name","query","message","user_name","url","item_id"],debounceDelay:a=500}=t;const{useState:r,useEffect:c,useCallback:l,useRef:d}=wp.element;const[u,p]=r("");const[f,m]=r(n);const[g,h]=r(false);const[b,y]=r("");const k=d(null);const w=d("");c((()=>{if(!u){m(n)}}),[n,u]);const x=l(((t,a=null)=>{if(!t){m(n);y("");return n}const r=t.toLowerCase();const c=a||o||n;const l=c.filter((t=>i.some((e=>{const n=t[e];if(n===null||n===undefined)return false;return n.toString().toLowerCase().includes(r)}))));m(l);if(!a){if(l.length===0&&!s){y(e("No results found","echo-knowledge-base"))}else{y("")}}return l}),[n,o,i,s]);const T=l((t=>{p(t);w.current=t;if(k.current){clearTimeout(k.current);k.current=null}if(!t){m(n);h(false);y("");return}const e=x(t);if(s){h(true);k.current=setTimeout((async()=>{if(w.current!==t)return;try{const e=await s(t);if(w.current===t){if(e&&Array.isArray(e)){x(t,e)}}}catch(e){console.error("Server search error:",e);if(w.current===t){y("")}}finally{if(w.current===t){h(false);y("")}}}),a)}}),[n,o,x,s,a]);const v=l((()=>{p("");w.current="";m(n);h(false);y("");if(k.current){clearTimeout(k.current);k.current=null}}),[n]);c((()=>()=>{if(k.current){clearTimeout(k.current)}}),[]);return{searchTerm:u,displayedData:f,isSearching:g,searchMessage:b,handleSearchChange:T,clearSearch:v}};const $=(t={})=>{const{errorText:e="Sorry, I couldn't get a response. Please reload your page and try again.",persistText:n="If the issue persists, please",linkText:o="contact support",linkUrl:s="https://www.echoknowledgebase.com/contact-us/",h:i=wp.element.createElement}=t;return i("p",null,e," ",n," ",i("a",{href:s,target:"_blank",rel:"noopener noreferrer",style:{color:"#007cba",textDecoration:"underline"}},o),".")};const _=(t={})=>{const{errorText:e="Sorry, I couldn't get a response. Please reload your page and try again.",persistText:n="If the issue persists, please",linkText:o="contact support",linkUrl:s="https://www.echoknowledgebase.com/contact-us/"}=t;return`${p(e)} ${p(n)} <a href="${p(s)}" target="_blank" rel="noopener noreferrer" style="color: #007cba; text-decoration: underline;">${p(o)}</a>.`};Object.assign(window.EPKB_AI_Util_React,{showNotification:n,showSuccess:i,showError:a,showInfo:r,showWarning:c,makeApiRequest:d,updateNonce:u,escapeHtml:p,debounce:f,throttle:m,formatDate:g,formatServerDateTime:h,deepMerge:b,isObject:y,getNestedValue:k,setNestedValue:w,isValidEmail:x,generateId:T,showConfirmDialog:v,handleSessionError:E,showLoadingDialog:C,DisclaimerRequiredMessage:S,useTableSearch:D,createAIErrorMessageElement:$,createAIErrorMessageHTML:_})})();