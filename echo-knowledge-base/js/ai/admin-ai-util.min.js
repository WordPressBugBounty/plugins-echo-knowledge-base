(function(){"use strict";const{apiFetch:t}=wp;const{__:e}=wp.i18n;window.EPKB_AI_Util_React=window.EPKB_AI_Util_React||{};const n=(t,e="info",n=1e4)=>{if(wp.data&&wp.data.dispatch("core/notices")){const i=e==="error"?"error":e;const a={type:i,isDismissible:true};if(n>0){a.autoDismiss=n}wp.data.dispatch("core/notices").createNotice(i,t,a)}else{i(t,e,n)}};const i=(t,n,i)=>{const s=a();const o=document.createElement("div");o.className=`epkb-ai-notification epkb-ai-notification-${n}`;o.innerHTML=`\n\t\t\t<div class="epkb-ai-notification-content">\n\t\t\t\t<span class="epkb-ai-notification-message">${p(t)}</span>\n\t\t\t\t<button class="epkb-ai-notification-close" aria-label="${e("Close","echo-knowledge-base")}">\n\t\t\t\t\t<span class="dashicons dashicons-dismiss"></span>\n\t\t\t\t</button>\n\t\t\t</div>\n\t\t`;const r=o.querySelector(".epkb-ai-notification-close");r.addEventListener("click",(()=>{o.classList.add("epkb-ai-notification-fade-out");setTimeout((()=>o.remove()),300)}));s.appendChild(o);if(i>0){setTimeout((()=>{if(o.parentNode){o.classList.add("epkb-ai-notification-fade-out");setTimeout((()=>o.remove()),300)}}),i)}};const a=()=>{let t=document.getElementById("epkb-ai-notifications");if(!t){t=document.createElement("div");t.id="epkb-ai-notifications";t.className="epkb-ai-notifications-container";const e=document.querySelector(".epkb-ai-tabs-nav");if(e&&e.parentNode){e.parentNode.insertBefore(t,e.nextSibling)}else{document.body.appendChild(t)}}return t};const s=(t,e=1e4)=>{n(t,"success",e)};const o=(t,e=1e4)=>{n(t,"error",e)};const r=(t,e=1e4)=>{n(t,"info",e)};const c=(t,e=1e4)=>{n(t,"warning",e)};const l={activeRequests:new Map,cancelRequest(t){const e=this.activeRequests.get(t);if(e){e.abort();this.activeRequests.delete(t)}},registerRequest(t){this.cancelRequest(t);const e=new AbortController;this.activeRequests.set(t,e);return e},completeRequest(t){this.activeRequests.delete(t)}};const d=async(n,i={})=>{const a={path:`/epkb-admin/v1/${n}`,method:"GET",headers:{"Content-Type":"application/json"}};const s={...a,...i};let r=null;let c=null;if(n==="sync-progress"&&!i.allowConcurrent){r="sync-progress";c=l.registerRequest(r);s.signal=c.signal}else if(i.signal){s.signal=i.signal}if(s.params&&s.method==="GET"){const t=new URLSearchParams(s.params).toString();s.path+=`?${t}`;delete s.params}if(s.data&&["POST","PUT","PATCH","DELETE"].includes(s.method)){s.body=JSON.stringify(s.data);delete s.data}try{const e=await t(s);if(e.new_token){u(e.new_token)}return e}catch(t){if(t.name==="AbortError"){throw t}if(t.code==="invalid_session"||t.code==="no_session"){o(e("Your session has expired. Please refresh the page.","echo-knowledge-base"))}else if(t.code==="rate_limit_exceeded"){o(e("Too many requests. Please wait a moment and try again.","echo-knowledge-base"))}else if(t.message){o(t.message)}else{o(e("An unexpected error occurred. Please try again.","echo-knowledge-base"))}throw t}finally{if(r){l.completeRequest(r)}}};const u=e=>{t.use(t.createNonceMiddleware(e));const n=document.getElementById("epkb-ai-admin-react-root");if(n&&n.dataset.epkbAiSettings){try{const t=JSON.parse(n.dataset.epkbAiSettings);t.nonce=e;n.dataset.epkbAiSettings=JSON.stringify(t)}catch(t){console.error("Failed to update nonce in settings",t)}}};const p=t=>{const e={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return t.replace(/[&<>"']/g,(t=>e[t]))};const m=(t,e)=>{let n;return function i(...a){const s=()=>{clearTimeout(n);t(...a)};clearTimeout(n);n=setTimeout(s,e)}};const g=(t,e)=>{let n;return function(...i){if(!n){t.apply(this,i);n=true;setTimeout((()=>n=false),e)}}};const b=(t,e="default")=>{const n=t instanceof Date?t:new Date(t);if(isNaN(n.getTime())){return""}const i={default:{year:"numeric",month:"short",day:"numeric"},short:{month:"numeric",day:"numeric",year:"2-digit"},long:{weekday:"long",year:"numeric",month:"long",day:"numeric"},time:{hour:"2-digit",minute:"2-digit"},datetime:{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"},full:{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:true},compact:{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:true}};if(e==="datetime"||e==="full"||e==="compact"){return n.toLocaleString(undefined,i[e]||i.default)}return n.toLocaleDateString(undefined,i[e]||i.default)};const f=(t,e="-")=>{if(!t||t==="Never"){return e}const n=t.replace(" ","T")+"Z";const i=new Date(n);if(isNaN(i.getTime())){return t}const a=new Date;const s=i.toDateString()===a.toDateString();const o=i.toLocaleTimeString(undefined,{hour:"numeric",minute:"2-digit",hour12:true}).toLowerCase();if(s){return`Today at ${o}`}const r=new Date(a);r.setDate(r.getDate()-1);if(i.toDateString()===r.toDateString()){return`Yesterday at ${o}`}const c=i.toLocaleDateString(undefined,{month:"short",day:"numeric"});return`${c} at ${o}`};const h=(t,e)=>{const n=Object.assign({},t);if(y(t)&&y(e)){Object.keys(e).forEach((i=>{if(y(e[i])){if(!(i in t)){Object.assign(n,{[i]:e[i]})}else{n[i]=h(t[i],e[i])}}else{Object.assign(n,{[i]:e[i]})}}))}return n};const y=t=>t&&typeof t==="object"&&!Array.isArray(t);const k=(t,e,n=undefined)=>e.split(".").reduce(((t,e)=>t&&t[e]!==undefined?t[e]:n),t);const w=(t,e,n)=>{const i=e.split(".");const a=i.pop();const s=i.reduce(((t,e)=>{if(!t[e]||typeof t[e]!=="object"){t[e]={}}return t[e]}),t);s[a]=n;return t};const v=t=>{const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(t)};const x=(t="epkb")=>`${t}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;const T=async(t={})=>{const{title:n=e("Confirm Action","echo-knowledge-base"),message:i=e("Are you sure you want to proceed?","echo-knowledge-base"),confirmText:a=e("Confirm","echo-knowledge-base"),cancelText:s=e("Cancel","echo-knowledge-base"),confirmButtonClass:o="epkb-ai-button-primary",requireInput:r=false,inputPlaceholder:c="",inputMatch:l=""}=t;return new Promise((t=>{const e=document.createElement("div");e.className="epkb-ai-dialog-overlay";e.style.cssText=`\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\tbottom: 0;\n\t\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tjustify-content: center;\n\t\t\t\tz-index: 100000;\n\t\t\t`;const d=document.createElement("div");d.className="epkb-ai-dialog";d.style.cssText=`\n\t\t\t\tbackground: white;\n\t\t\t\tborder-radius: 8px;\n\t\t\t\tpadding: 24px;\n\t\t\t\tmax-width: 500px;\n\t\t\t\twidth: 90%;\n\t\t\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);\n\t\t\t`;let u=`\n\t\t\t\t<h3 style="margin: 0 0 16px 0; font-size: 18px; font-weight: 600;">${p(n)}</h3>\n\t\t\t\t<p style="margin: 0 0 20px 0; color: #555; line-height: 1.5;">${p(i)}</p>\n\t\t\t`;if(r){u+=`\n\t\t\t\t\t<input type="text" \n\t\t\t\t\t\t   id="epkb-dialog-input" \n\t\t\t\t\t\t   class="epkb-ai-input" \n\t\t\t\t\t\t   placeholder="${p(c)}"\n\t\t\t\t\t\t   style="width: 100%; margin-bottom: 20px; padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">\n\t\t\t\t`}u+=`\n\t\t\t\t<div style="display: flex; justify-content: flex-end; gap: 10px;">\n\t\t\t\t\t<button class="epkb-ai-button epkb-ai-button-secondary" id="epkb-dialog-cancel">\n\t\t\t\t\t\t${p(s)}\n\t\t\t\t\t</button>\n\t\t\t\t\t<button class="epkb-ai-button ${o}" id="epkb-dialog-confirm">\n\t\t\t\t\t\t${p(a)}\n\t\t\t\t\t</button>\n\t\t\t\t</div>\n\t\t\t`;d.innerHTML=u;e.appendChild(d);document.body.appendChild(e);const m=d.querySelector("#epkb-dialog-confirm");const g=d.querySelector("#epkb-dialog-cancel");const b=d.querySelector("#epkb-dialog-input");if(b){b.focus()}const f=()=>{if(r){const e=b.value.trim();if(l&&e!==l){b.style.borderColor="#e74c3c";b.focus();return}y();t(e)}else{y();t(true)}};const h=()=>{y();t(false)};const y=()=>{document.body.removeChild(e)};m.addEventListener("click",f);g.addEventListener("click",h);e.addEventListener("click",(t=>{if(t.target===e){h()}}));if(b){b.addEventListener("keypress",(t=>{if(t.key==="Enter"){f()}}))}document.addEventListener("keydown",(function t(e){if(e.key==="Escape"){document.removeEventListener("keydown",t);h()}}))}))};const N=({onSignUp:t,i18n:e})=>{const{createElement:n}=wp.element;return n("div",{className:"epkb-ai-beta-access-message"},n("div",{className:"epkb-ai-beta-box"},n("div",{className:"epkb-ai-beta-icon"},n("span",{className:"dashicons dashicons-lock"})),n("h3",null,e.beta_access_required||"Beta Access Required"),n("p",null,e.beta_access_message||"This feature requires beta access. Please sign up for the beta program to use AI features."),n("div",{className:"epkb-ai-beta-actions"},n("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:t},e.beta_signup_button||"Sign Up for Beta"),n("a",{href:"https://www.echoknowledgebase.com/ai-features-beta/",target:"_blank",rel:"noopener noreferrer",className:"epkb-ai-button epkb-ai-button-secondary"},e.beta_learn_more||"Learn More"))))};const S=({onAccept:t,i18n:e})=>{const{createElement:n}=wp.element;return n("div",{className:"epkb-ai-disclaimer-required-message"},n("div",{className:"epkb-ai-disclaimer-box"},n("div",{className:"epkb-ai-disclaimer-icon"},n("span",{className:"dashicons dashicons-warning"})),n("h3",null,e.disclaimer_required||"Data Privacy Agreement Required"),n("p",null,e.disclaimer_message||"To use AI features, you must accept our data privacy agreement. This ensures you understand how your data will be processed by AI services."),n("div",{className:"epkb-ai-disclaimer-actions"},n("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:t},e.go_to_settings||"Go to General Settings"),n("a",{href:"https://www.echoknowledgebase.com/privacy-security-disclaimer",target:"_blank",rel:"noopener noreferrer",className:"epkb-ai-button epkb-ai-button-secondary"},e.privacy_policy||"View Privacy Policy"))))};const _=(t=e("Loading...","echo-knowledge-base"))=>{const n=document.createElement("div");n.className="epkb-ai-dialog-overlay";n.style.cssText=`\n\t\t\tposition: fixed;\n\t\t\ttop: 0;\n\t\t\tleft: 0;\n\t\t\tright: 0;\n\t\t\tbottom: 0;\n\t\t\tbackground: rgba(0, 0, 0, 0.5);\n\t\t\tdisplay: flex;\n\t\t\talign-items: center;\n\t\t\tjustify-content: center;\n\t\t\tz-index: 999999;\n\t\t`;const i=document.createElement("div");i.className="epkb-ai-dialog epkb-ai-loading-dialog";i.style.cssText=`\n\t\t\tbackground: white;\n\t\t\tpadding: 30px;\n\t\t\tborder-radius: 8px;\n\t\t\tbox-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);\n\t\t\tmax-width: 400px;\n\t\t\ttext-align: center;\n\t\t`;i.innerHTML=`\n\t\t\t<div class="epkb-loading-spinner" style="margin: 0 auto 20px; width: 40px; height: 40px;"></div>\n\t\t\t<p style="margin: 0; color: #555; font-size: 16px;">${p(t)}</p>\n\t\t`;n.appendChild(i);document.body.appendChild(n);return()=>{n.remove()}};const E=(t={})=>{const{data:n=[],allData:i=null,onServerSearch:a=null,searchFields:s=["title","name","query","message","user_name","url","item_id"],debounceDelay:o=500}=t;const{useState:r,useEffect:c,useCallback:l,useRef:d}=wp.element;const[u,p]=r("");const[m,g]=r(n);const[b,f]=r(false);const[h,y]=r("");const k=d(null);const w=d("");c((()=>{if(!u){g(n)}}),[n,u]);const v=l(((t,o=null)=>{if(!t){g(n);y("");return n}const r=t.toLowerCase();const c=o||i||n;const l=c.filter((t=>s.some((e=>{const n=t[e];if(n===null||n===undefined)return false;return n.toString().toLowerCase().includes(r)}))));g(l);if(!o){if(l.length===0&&!a){y(e("No results found","echo-knowledge-base"))}else{y("")}}return l}),[n,i,s,a]);const x=l((t=>{p(t);w.current=t;if(k.current){clearTimeout(k.current);k.current=null}if(!t){g(n);f(false);y("");return}const e=v(t);if(a){f(true);k.current=setTimeout((async()=>{if(w.current!==t)return;try{const e=await a(t);if(w.current===t){if(e&&Array.isArray(e)){v(t,e)}}}catch(e){console.error("Server search error:",e);if(w.current===t){y("")}}finally{if(w.current===t){f(false);y("")}}}),o)}}),[n,i,v,a,o]);const T=l((()=>{p("");w.current="";g(n);f(false);y("");if(k.current){clearTimeout(k.current);k.current=null}}),[n]);c((()=>()=>{if(k.current){clearTimeout(k.current)}}),[]);return{searchTerm:u,displayedData:m,isSearching:b,searchMessage:h,handleSearchChange:x,clearSearch:T}};Object.assign(window.EPKB_AI_Util_React,{showNotification:n,showSuccess:s,showError:o,showInfo:r,showWarning:c,makeApiRequest:d,updateNonce:u,escapeHtml:p,debounce:m,throttle:g,formatDate:b,formatServerDateTime:f,deepMerge:h,isObject:y,getNestedValue:k,setNestedValue:w,isValidEmail:v,generateId:x,showConfirmDialog:T,showLoadingDialog:_,BetaAccessMessage:N,DisclaimerRequiredMessage:S,useTableSearch:E})})();