(function(){"use strict";const{useState:e,useEffect:t,createElement:a}=wp.element;const{__:n}=wp.i18n;const{showError:s,showSuccess:o,makeApiRequest:i}=window.EPKB_AI_Util_React||{};const{AIAdminDashboard:c}=window.EPKB_AI_Dashboard||{};const{AIAdminGeneralSettings:l}=window.EPKB_AI_GeneralSettings||{};const{AIAdminChat:r}=window.EPKB_AI_Chat||{};const{AIAdminSearch:d}=window.EPKB_AI_Search||{};const{AIAdminTrainingData:g}=window.EPKB_AI_TrainingData||{};const{AIAdminTools:p}=window.EPKB_AI_Tools||{};const m=({setActiveTab:e})=>{const t=window.location.href.split("page=")[0];const s=t+"page=epkb-kb-ai-chat&active_tab=general-settings";return a("div",{className:"epkb-ai-api-key-missing",style:{backgroundColor:"#fee",border:"1px solid #c33",borderRadius:"4px",padding:"15px",margin:"20px 0"}},a("div",{className:"epkb-ai-error-box",style:{display:"flex",alignItems:"center"}},a("span",{className:"epkbfa epkbfa-exclamation-triangle",style:{color:"#c33",marginRight:"10px",fontSize:"24px"}}),a("div",{className:"epkb-ai-error-content"},a("h4",{style:{margin:"0 0 10px 0",color:"#c33"}},n("OpenAI API Key Required","echo-knowledge-base")),a("p",{style:{margin:"0 0 10px 0"}},n("To use AI features, you need to configure your OpenAI API key.","echo-knowledge-base")),a("a",{href:s,className:"epkb-ai-button epkb-ai-button-primary",onClick:t=>{t.preventDefault();e("general-settings");const a=new URL(window.location);a.searchParams.set("active_tab","general-settings");window.history.pushState({},"",a)}},n("Configure API Key","echo-knowledge-base")))))};const b=({settings:m})=>{const[b,w]=e(m.active_tab||"dashboard");const[u,h]=e(m.tabs_data||{});const[k,f]=e({});const y=u?.["general-settings"]?.ai_config?.ai_key&&u?.["general-settings"]?.ai_config?.ai_key.length>0;const A=u?.["general-settings"]?.ai_config?.ai_beta_code||"";const _=["EPKB-BETA-2024-AI-CHAT"];const v=_.includes(A.trim());const I=u?.["general-settings"]?.ai_config?.ai_disclaimer_accepted==="on";const E=async e=>{f(t=>({...t,[e]:true}));try{const t=await i(`ai/${e}`,{method:"GET"});if(t.success){h(a=>({...a,[e]:t.data}))}}catch(e){s(e.message||n("Failed to load tab data","echo-knowledge-base"))}finally{f(t=>({...t,[e]:false}))}};const x=e=>{const t=u[e.key]||{};const b={settings:m,tabData:t,isLoading:false,hasApiKey:y,makeApiRequest:i,showError:s,showSuccess:o,onDataChange:t=>{h(a=>({...a,[e.key]:{...a[e.key],...t}}))},onRefresh:()=>E(e.key)};switch(e.key){case"dashboard":return a(c,b);case"general-settings":return a(l,{...b,onTabSwitch:e=>{w(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"chat":return a(r,b);case"search":return a(d,b);case"training-data":return a(g,{...b,selectedCollection:C});case"tools":return a(p,b);default:return a("div",null,n("Unknown tab","echo-knowledge-base"))}};const P=m.tabs&&m.tabs.length>0?m.tabs.map(e=>({name:e.key,title:e.title,className:`epkb-ai-tab-${e.key}`,icon:e.icon})):[];if(P.length===0){return a("div",{className:"epkb-ai-admin-app"},a("div",{className:"epkb-ai-admin-error"},a("h1",null,n("AI Configuration","echo-knowledge-base")),a("p",null,n("Error: No tabs configured. Please check the configuration.","echo-knowledge-base"))))}const[N,B]=e(false);const[C,S]=e(null);const[T,K]=e(false);const R=u["training-data"]?.data_collections||[];const L=e=>{S(e);B(false);w("training-data");const t=new URL(window.location);t.searchParams.set("active_tab","training-data");t.searchParams.set("collection_id",e.id);window.history.pushState({},"",t)};const D=async()=>{if(T)return;K(true);try{let e=0;R.forEach(t=>{const a=t.name.match(/(\d+)$/);if(a){e=Math.max(e,parseInt(a[1]))}});const t=e+1;const a=n("Data Collection","echo-knowledge-base")+" "+t;const c=await i("training-collections",{method:"POST",data:{name:a,post_types:[]}});if(c.success){o(n("New training data collection created","echo-knowledge-base"));setTimeout(()=>{window.location.reload()},1e3)}else{s(c.message||n("Failed to create collection","echo-knowledge-base"));K(false)}}catch(e){s(e.message||n("Failed to create collection","echo-knowledge-base"));K(false)}};t(()=>{const e=e=>{if(!e.target.closest(".epkb-ai-training-data-dropdown")){B(false)}};if(N){document.addEventListener("click",e);return()=>document.removeEventListener("click",e)}},[N]);return a("div",{className:"epkb-ai-admin-app"},a("div",{className:"epkb-ai-admin-header"},a("h1",null,n("AI Configuration","echo-knowledge-base")," ",a("span",{className:"epkb-ai-beta-text"},n("Beta","echo-knowledge-base")))),a("div",{className:"epkb-ai-custom-tabs"},a("div",{className:"epkb-ai-tabs-nav"},P.map(e=>a("button",{key:e.name,className:`epkb-ai-tab-button ${b===e.name?"active":""}`,onClick:()=>{w(e.name);const t=new URL(window.location);t.searchParams.set("active_tab",e.name);window.history.pushState({},"",t)}},e.icon&&a("span",{className:e.icon})," ",e.title))),a("div",{className:"epkb-ai-tab-content"},x({key:b,selectedCollection:C}))))};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("epkb-ai-admin-react-root");if(e){const t=JSON.parse(e.dataset.epkbAiSettings||"{}");const n=document.getElementById("epkb-ai-initial-loader");if(n){setTimeout(()=>{n.style.display="none"},100)}if(wp.element.createRoot){const n=wp.element.createRoot(e);n.render(a(b,{settings:t}))}else{const{render:n}=wp.element;n(a(b,{settings:t}),e)}}});window.showEPKBAILoadingOverlay=function(e=null){let t=document.getElementById("epkb-ai-reload-overlay");if(!t){t=document.createElement("div");t.id="epkb-ai-reload-overlay";t.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999999; background: white; padding: 30px; border-radius: 8px; border: 3px solid #2271b1; box-shadow: 0 4px 20px rgba(0,0,0,0.25); min-width: 200px; text-align: center;";t.innerHTML=`\n\t\t\t\t<div class="epkb-ai-loading-container" style="margin: 0;">\n\t\t\t\t\t<div class="epkb-loading-spinner" style="margin: 0 auto 15px;"></div>\n\t\t\t\t\t<div class="epkb-ai-loading" id="epkb-ai-reload-message" style="margin: 0; font-size: 14px; color: #555;">${e||n("Reloading page...","echo-knowledge-base")}</div>\n\t\t\t\t</div>\n\t\t\t`;document.body.appendChild(t)}else{if(e){const t=document.getElementById("epkb-ai-reload-message");if(t){t.textContent=e}}t.style.display="block"}};window.addEventListener("beforeunload",function(e){if(!e.defaultPrevented){window.showEPKBAILoadingOverlay()}});window.EPKB_AI_App={AIAdminApp:b}})();