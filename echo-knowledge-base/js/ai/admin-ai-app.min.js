(function(){"use strict";const{useState:e,useEffect:t,createElement:a}=wp.element;const{__:s}=wp.i18n;const{showError:n,showSuccess:o,makeApiRequest:i}=window.EPKB_AI_Util_React||{};const{AIAdminDashboard:c}=window.EPKB_AI_Dashboard||{};const{AIAdminGeneralSettings:r}=window.EPKB_AI_GeneralSettings||{};const{AIAdminChat:d}=window.EPKB_AI_Chat||{};const{AIAdminSearch:l}=window.EPKB_AI_Search||{};const{AIAdminTrainingData:b}=window.EPKB_AI_TrainingData||{};const{AIAdminTools:p}=window.EPKB_AI_Tools||{};const{AIAdminPROFeatures:u}=window.EPKB_AI_PROFeatures||{};const w=({setActiveTab:e})=>{const t=window.location.href.split("page=")[0];const n=t+"page=epkb-kb-ai-chat&active_tab=general-settings";return a("div",{className:"epkb-ai-api-key-missing",style:{backgroundColor:"#fee",border:"1px solid #c33",borderRadius:"4px",padding:"15px",margin:"20px 0"}},a("div",{className:"epkb-ai-error-box",style:{display:"flex",alignItems:"center"}},a("span",{className:"epkbfa epkbfa-exclamation-triangle",style:{color:"#c33",marginRight:"10px",fontSize:"24px"}}),a("div",{className:"epkb-ai-error-content"},a("h4",{style:{margin:"0 0 10px 0",color:"#c33"}},s("OpenAI API Key Required","echo-knowledge-base")),a("p",{style:{margin:"0 0 10px 0"}},s("To use AI features, you need to configure your OpenAI API key.","echo-knowledge-base")),a("a",{href:n,className:"epkb-ai-button epkb-ai-button-primary",onClick:t=>{t.preventDefault();e("general-settings");const a=new URL(window.location);a.searchParams.set("active_tab","general-settings");window.history.pushState({},"",a)}},s("Configure API Key","echo-knowledge-base")))))};const m=({settings:w})=>{const[m,g]=e(w.active_tab||"dashboard");const[h,f]=e(w.tabs_data||{});const[k,y]=e({});const[_,A]=e(false);const[I,v]=e(false);const x=h?.["general-settings"]?.ai_config?.ai_key&&h?.["general-settings"]?.ai_config?.ai_key.length>0;t((()=>{if(_)return;if(h?.dashboard?.status){A(true);const e=h.dashboard.status.issues&&h.dashboard.status.issues.length>0;v(e);return}const e=w.tabs?.find((e=>e.key==="dashboard"));if(!e?.check_status)return;const t=async()=>{try{const e=await jQuery.ajax({url:w.ajax_url,type:"POST",data:{action:"epkb_get_ai_status",force_refresh:"true",_wpnonce_epkb_ajax_action:w.ajax_nonce}});if(e.success&&e.data){f((t=>({...t,dashboard:{...t.dashboard,status:e.data}})));const t=e.data.issues&&e.data.issues.length>0;v(t);A(true)}}catch(e){console.error("Failed to load AI status:",e)}};setTimeout(t,2e3)}),[_,h,w]);const P=async e=>{y((t=>({...t,[e]:true})));try{const t=await i(`ai/${e}`,{method:"GET"});if(t.success){f((a=>({...a,[e]:t.data})))}}catch(e){n(e.message||s("Failed to load tab data","echo-knowledge-base"))}finally{y((t=>({...t,[e]:false})))}};const S=e=>{const t=h[e.key]||{};if(t.ai_disabled){return a("div",{className:"epkb-ai-disabled-content"},a("div",{className:"epkb-ai-notice epkb-ai-notice-warning",style:{padding:"12px 15px",marginBottom:"20px",borderLeft:"4px solid #ffba00",backgroundColor:"#fff8e5"}},a("p",{style:{margin:"0"}},a("span",{className:"dashicons dashicons-info",style:{marginRight:"8px",color:"#ffba00"}}),t.instructions||s("To use AI features, please configure your API key and accept the data privacy agreement in General Settings, then enable AI Search or AI Chat.","echo-knowledge-base")," ",a("a",{href:"#",onClick:e=>{e.preventDefault();g("general-settings");const t=new URL(window.location);t.searchParams.set("active_tab","general-settings");window.history.pushState({},"",t)},style:{fontWeight:"bold",textDecoration:"underline"}},s("Go to General Settings","echo-knowledge-base")))))}const m={settings:w,tabData:t,isLoading:false,hasApiKey:x,makeApiRequest:i,showError:n,showSuccess:o,onDataChange:t=>{f((a=>({...a,[e.key]:{...a[e.key],...t}})))},onRefresh:()=>P(e.key)};switch(e.key){case"dashboard":return a(c,{...m,onTabSwitch:e=>{g(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"general-settings":return a(r,{...m,onTabSwitch:e=>{g(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"chat":return a(d,{...m,onTabSwitch:e=>{g(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"search":return a(l,{...m,onTabSwitch:e=>{g(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"training-data":return a(b,{...m,selectedCollection:C,onTabSwitch:e=>{g(e);const t=new URL(window.location);t.searchParams.set("active_tab",e);window.history.pushState({},"",t)}});case"tuning":return a(AIAdminTuning,m);case"tools":return a(p,m);case"pro-features":return a(u,m);default:return a("div",null,s("Unknown tab","echo-knowledge-base"))}};const E=w.tabs&&w.tabs.length>0?w.tabs.map((e=>({name:e.key,title:e.title,className:`epkb-ai-tab-${e.key}`,icon:e.icon,has_issues:e.key==="dashboard"?I:false,requires_ai:e.requires_ai||false,is_disabled:e.requires_ai&&!w.ai_enabled}))):[];if(E.length===0){return a("div",{className:"epkb-ai-admin-app"},a("div",{className:"epkb-ai-admin-error"},a("h1",null,s("AI Configuration","echo-knowledge-base")),a("p",null,s("Error: No tabs configured. Please check the configuration.","echo-knowledge-base"))))}const[N,B]=e(false);const[C,L]=e(null);const[R,K]=e(false);const T=h["training-data"]?.data_collections||[];const U=e=>{L(e);B(false);g("training-data");const t=new URL(window.location);t.searchParams.set("active_tab","training-data");t.searchParams.set("collection_id",e.id);window.history.pushState({},"",t)};const D=async()=>{if(R)return;K(true);try{let e=0;T.forEach((t=>{const a=t.name.match(/(\d+)$/);if(a){e=Math.max(e,parseInt(a[1]))}}));const t=e+1;const a=s("Data Collection","echo-knowledge-base")+" "+t;const c=await i("training-collections",{method:"POST",data:{name:a,post_types:[]}});if(c.success){o(s("New training data collection created","echo-knowledge-base"));setTimeout((()=>{window.location.reload()}),1e3)}else{n(c.message||s("Failed to create collection","echo-knowledge-base"));K(false)}}catch(e){n(e.message||s("Failed to create collection","echo-knowledge-base"));K(false)}};t((()=>{const e=e=>{if(!e.target.closest(".epkb-ai-training-data-dropdown")){B(false)}};if(N){document.addEventListener("click",e);return()=>document.removeEventListener("click",e)}}),[N]);return a("div",{className:"epkb-ai-admin-app"},a("div",{className:"epkb-ai-admin-header"}),a("div",{className:"epkb-ai-custom-tabs"},window.EPKB_AI_SyncContext&&window.EPKB_AI_SyncContext.Consumer?a(window.EPKB_AI_SyncContext.Consumer,null,(e=>a("div",{className:"epkb-ai-tabs-nav"},E.map((t=>a("button",{key:t.name,className:`epkb-ai-tab-button ${m===t.name?"active":""} ${t.is_disabled?"disabled":""}`,onClick:()=>{g(t.name);const a=new URL(window.location);a.searchParams.set("active_tab",t.name);window.history.pushState({},"",a);if(e&&e.setJob){e.setJob({status:"idle",total:0,processed:0,percent:0,errors:0})}},title:t.is_disabled?s("AI features must be enabled to access this tab","echo-knowledge-base"):"",style:t.is_disabled?{opacity:.6,cursor:"pointer"}:{}},t.icon&&a("span",{className:t.icon})," ",t.title,t.is_disabled&&a("span",{className:"epkbfa epkbfa-lock",style:{marginLeft:"5px",fontSize:"14px"}}),t.has_issues&&a("span",{className:"epkb-ai-tab-issue-indicator",style:{color:"#dc3545",marginLeft:"5px",fontWeight:"bold",fontSize:"24px"}},"!"))))))):a("div",{className:"epkb-ai-tabs-nav"},E.map((e=>a("button",{key:e.name,className:`epkb-ai-tab-button ${m===e.name?"active":""} ${e.is_disabled?"disabled":""}`,onClick:()=>{g(e.name);const t=new URL(window.location);t.searchParams.set("active_tab",e.name);window.history.pushState({},"",t)},title:e.is_disabled?s("AI features must be enabled to access this tab","echo-knowledge-base"):"",style:e.is_disabled?{opacity:.6,cursor:"pointer"}:{}},e.icon&&a("span",{className:e.icon})," ",e.title,e.is_disabled&&a("span",{className:"epkbfa epkbfa-lock",style:{marginLeft:"5px",fontSize:"14px"}}),e.has_issues&&a("span",{className:"epkb-ai-tab-issue-indicator",style:{color:"#dc3545",marginLeft:"5px",fontWeight:"bold",fontSize:"24px"}},"!"))))),window.EPKB_AI_SyncProgressBar&&window.EPKB_AI_SyncContext&&a(window.EPKB_AI_SyncContext.Consumer,null,(e=>{if(!e||!e.job||e.job.status==="idle"){return null}return a("div",{className:"epkb-ai-sync-message-container",style:{position:"relative",zIndex:10}},a(window.EPKB_AI_SyncProgressBar))})),a("div",{className:"epkb-ai-tab-content"},S({key:m,selectedCollection:C}))))};document.addEventListener("DOMContentLoaded",(function(){const e=document.getElementById("epkb-ai-admin-react-root");if(e){const t=JSON.parse(e.dataset.epkbAiSettings||"{}");const s=document.getElementById("epkb-ai-initial-loader");if(s){setTimeout((()=>{s.style.display="none"}),100)}const n=window.EPKB_AI_SyncProvider;const o=a(m,{settings:t});const i=n?a(n,null,o):o;if(wp.element.createRoot){const t=wp.element.createRoot(e);t.render(i)}else{const{render:t}=wp.element;t(i,e)}}}));window.showEPKBAILoadingOverlay=function(e=null){let t=document.getElementById("epkb-ai-reload-overlay");if(!t){t=document.createElement("div");t.id="epkb-ai-reload-overlay";t.style.cssText="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 999999; background: white; padding: 30px; border-radius: 8px; border: 3px solid #2271b1; box-shadow: 0 4px 20px rgba(0,0,0,0.25); min-width: 200px; text-align: center;";t.innerHTML=`\n\t\t\t\t<div class="epkb-ai-loading-container" style="margin: 0;">\n\t\t\t\t\t<div class="epkb-loading-spinner" style="margin: 0 auto 15px;"></div>\n\t\t\t\t\t<div class="epkb-ai-loading" id="epkb-ai-reload-message" style="margin: 0; font-size: 14px; color: #555;">${e||s("Reloading page...","echo-knowledge-base")}</div>\n\t\t\t\t</div>\n\t\t\t`;document.body.appendChild(t)}else{if(e){const t=document.getElementById("epkb-ai-reload-message");if(t){t.textContent=e}}t.style.display="block"}};window.addEventListener("beforeunload",(function(e){if(!e.defaultPrevented&&window.epkbAIPageInteracted){window.showEPKBAILoadingOverlay()}}));window.epkbAIPageInteracted=false;setTimeout((()=>{window.epkbAIPageInteracted=true}),1e3);window.EPKB_AI_App={AIAdminApp:m}})();