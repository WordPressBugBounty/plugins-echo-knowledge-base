(function(){"use strict";const{useState:e,useEffect:o,useCallback:t,createElement:a,Fragment:n}=wp.element;const{__:i}=wp.i18n;const s=({articleData:s,makeApiRequest:l,showSuccess:r,showError:d})=>{const[c,p]=e(null);const[g,b]=e(true);const[f,u]=e("tags");o((()=>{const e=async()=>{if(!s||!s.id){b(false);return}b(true);try{const e=localStorage.getItem(`epkb_analysis_details_${s.id}`);if(e){const o=JSON.parse(e);if(o.timestamp&&Date.now()-o.timestamp<36e5){p(o.data);b(false);return}}const o=await l("content-analysis-details",{params:{article_id:s.id,kb_id:1}});if(o&&o.data){const e=o.data;p(e);localStorage.setItem(`epkb_analysis_details_${s.id}`,JSON.stringify({data:e,timestamp:Date.now()}))}}catch(e){console.error("Error fetching analysis details:",e);const o={score:s.score,importance:s.importance,scoreComponents:s.scoreComponents||[],title:s.title,last_analyzed:s.last_analyzed,status:s.status||s.display_status};p(o)}finally{b(false)}};e()}),[s,l]);const m=t((async e=>{try{const o=await l("content-analysis-tag-add",{method:"POST",data:{article_id:s.id,tag_name:e,kb_id:1}});if(o&&o.success){r(i("Tag added successfully","echo-knowledge-base"));localStorage.removeItem(`epkb_analysis_details_${s.id}`);setTimeout((()=>{window.location.reload()}),1e3)}else{d(i("Failed to add tag","echo-knowledge-base"))}}catch(e){console.error("Error adding tag:",e);d(i("Failed to add tag","echo-knowledge-base"))}}),[s,l,r,d]);const x=t((async e=>{try{const o=await l("content-analysis-tag-remove",{method:"POST",data:{article_id:s.id,tag_id:e,kb_id:1}});if(o&&o.success){r(i("Tag removed successfully","echo-knowledge-base"));localStorage.removeItem(`epkb_analysis_details_${s.id}`);setTimeout((()=>{window.location.reload()}),1e3)}else{d(i("Failed to remove tag","echo-knowledge-base"))}}catch(e){console.error("Error removing tag:",e);d(i("Failed to remove tag","echo-knowledge-base"))}}),[s,l,r,d]);const h=t((async e=>{try{let o=0;for(const t of e){const e=await l("content-analysis-tag-remove",{method:"POST",data:{article_id:s.id,tag_id:t.id,kb_id:1}});if(e&&e.success){o++}}if(o>0){r(`${o} tags removed successfully`);localStorage.removeItem(`epkb_analysis_details_${s.id}`);setTimeout((()=>{window.location.reload()}),1500)}else{d(i("Failed to remove tags","echo-knowledge-base"))}}catch(e){console.error("Error removing tags:",e);d(i("Failed to remove tags","echo-knowledge-base"))}}),[s,l,r,d]);const k=t((async(e,o)=>{try{const t=await l("content-analysis-tag-edit",{method:"POST",data:{article_id:s.id,tag_id:e,new_name:o,kb_id:1}});if(t&&t.success){r(i("Tag updated successfully","echo-knowledge-base"));localStorage.removeItem(`epkb_analysis_details_${s.id}`);setTimeout((()=>{window.location.reload()}),1e3)}else{d(i("Failed to update tag","echo-knowledge-base"))}}catch(e){console.error("Error updating tag:",e);d(i("Failed to update tag","echo-knowledge-base"))}}),[s,l,r,d]);const y=(e,o)=>{const t=parseInt(e)||0;let n="";let i="";if(t>=80){n="#46b450";i="rgba(70, 180, 80, 0.1)"}else if(t>=60){n="#f0ad4e";i="rgba(240, 173, 78, 0.1)"}else{n="#d54e21";i="rgba(213, 78, 33, 0.1)"}return a("div",{style:{display:"inline-flex",flexDirection:"row",alignItems:"center",gap:"10px",padding:"10px 15px",borderRadius:"8px",backgroundColor:i,border:`2px solid ${n}`,minWidth:"120px"}},a("div",{style:{fontSize:"12px",color:"#666"}},o+":"),a("div",{style:{fontSize:"24px",fontWeight:"bold",color:n}},e+"%"))};return a("div",{className:"epkb-ai-analysis-details-container",style:{padding:"20px"}},g?a("div",{className:"epkb-ai-analysis-details-loading",style:{padding:"40px",textAlign:"center"}},a("div",{className:"spinner is-active",style:{float:"none"}}),a("p",null,i("Loading analysis details...","echo-knowledge-base"))):!c?a("div",{className:"epkb-ai-analysis-details-empty",style:{padding:"40px",textAlign:"center"}},a("p",null,i("No analysis details available for this article.","echo-knowledge-base"))):a(n,null,a("div",{className:"epkb-ai-details-nav",style:{marginBottom:"20px",marginLeft:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"}},a("div",{style:{display:"inline-flex",gap:"0",border:"1px solid #E5E6E7",backgroundColor:"#FFFFFF",borderRadius:"8px",overflow:"hidden"}},["tags","coming-soon"].map(((e,o)=>a("button",{key:e,className:`epkb-ai-section-tab ${f===e?"active":""}`,onClick:()=>u(e),style:{padding:"12px 24px",border:"none",borderRight:o===0?"1px solid #E5E6E7":"none",backgroundColor:f===e?"#F0F8FF":"#FFFFFF",borderBottom:f===e?"3px solid #0073AA":"3px solid transparent",color:f===e?"#0073AA":"#555555",cursor:"pointer",fontSize:"14px",fontWeight:f===e?"600":"400",transition:"all 0.2s ease"},onMouseEnter:o=>{if(f!==e){o.target.style.backgroundColor="#F0F8FF";o.target.style.color="#0073AA"}},onMouseLeave:o=>{if(f!==e){o.target.style.backgroundColor="#FFFFFF";o.target.style.color="#555555"}}},e==="tags"?(()=>{const e=c&&c.scoreComponents||s&&s.scoreComponents||[];const o=e.find((e=>e.name==="Tags Usage"));if(o&&o.value&&o.value!=="-"&&o.value!=="Analyzing..."){const e=parseInt(o.value)||0;let t="#666";if(e>=80){t="#46b450"}else if(e>=60){t="#f0ad4e"}else{t="#d54e21"}return a("span",null,i("Tags","echo-knowledge-base"),"  ",a("span",{style:{color:t,fontWeight:"bold",marginLeft:"4px"}},`(${o.value}%)`))}return i("Tags","echo-knowledge-base")})():i("Coming Soon","echo-knowledge-base"))))),a("div",{style:{display:"flex",gap:"20px",alignItems:"center",marginRight:"20px"}},y(c.score||s.score,i("Overall Score","echo-knowledge-base")),a("div",{style:{display:"flex",flexDirection:"column",justifyContent:"center",minWidth:"150px"}},a("div",{style:{fontSize:"12px",color:"#666",marginBottom:"8px"}},i("Article Importance","echo-knowledge-base")),a("div",{style:{position:"relative",width:"150px",height:"20px",backgroundColor:"#e0e0e0",borderRadius:"10px",overflow:"hidden"}},a("div",{style:{position:"absolute",left:0,top:0,height:"100%",width:`${c.importance||s.importance}%`,background:"linear-gradient(90deg, #667EEA, #764BA2)",transition:"width 0.3s ease"}}),a("div",{style:{position:"absolute",width:"100%",textAlign:"center",lineHeight:"20px",color:"#fff",fontWeight:"bold",fontSize:"12px"}},`${c.importance||s.importance}%`))))),a("div",{className:"epkb-ai-details-content",style:{marginLeft:"20px"}},f==="coming-soon"&&a("div",{className:"epkb-ai-coming-soon-section",style:{textAlign:"center",padding:"60px 20px",color:"#666"}},a("div",{style:{fontSize:"48px",marginBottom:"20px",opacity:"0.3"}},"ðŸš€"),a("h3",{style:{fontSize:"24px",marginBottom:"10px",color:"#333"}},i("Coming Soon","echo-knowledge-base")),a("p",{style:{fontSize:"16px",maxWidth:"400px",margin:"0 auto"}},i("We're working on exciting new features to enhance your content analysis experience. Stay tuned!","echo-knowledge-base"))),f==="tags"&&a("div",{className:"epkb-ai-tags-section"},a(n,null,c.current_tags&&c.current_tags.length>0?(()=>{const e={not_found:{title:i("Tag Not Found in Article Content","echo-knowledge-base"),tags:[],color:"#dc2626",bgColor:"#fef2f2",borderColor:"#fca5a5",actions:["edit","remove"],description:i("These tags do not appear anywhere in the article content. Consider adding relevant content or removing the tags.","echo-knowledge-base")},weak_relevance:{title:i("Weak Relevance - Low Occurrences","echo-knowledge-base"),tags:[],color:"#ea580c",bgColor:"#fff7ed",borderColor:"#fdba74",actions:["edit_article","enhance_content","edit","remove"],description:i("These tags appear infrequently in the content. Consider adding more relevant content or replacing with better tags.","echo-knowledge-base")},duplicate:{title:i("Similar or Duplicate Tags","echo-knowledge-base"),tags:[],color:"#a16207",bgColor:"#fef9c3",borderColor:"#fde047",actions:["merge","remove"],description:i("These tags are similar or duplicates. Consider merging them or keeping only the most relevant one.","echo-knowledge-base")},format:{title:i("Formatting Issues","echo-knowledge-base"),tags:[],color:"#4338ca",bgColor:"#eef2ff",borderColor:"#a5b4fc",actions:["edit","fix_format"],description:i("These tags have formatting issues like incorrect capitalization, special characters, or length problems.","echo-knowledge-base")},good:{title:i("Well-Formatted and Relevant","echo-knowledge-base"),tags:[],color:"#059669",bgColor:"#ecfdf5",borderColor:"#86efac",actions:[],description:i("These tags are properly formatted and relevant to the content. No action needed.","echo-knowledge-base")}};c.current_tags.forEach((o=>{const t={id:o.id||o.term_id,name:o.name||o,slug:o.slug,original:o};let a=false;if(o.issues&&o.issues.length>0){o.issues.forEach((o=>{if(o.includes("not found in content")||o.includes("Tag not found in article content")){e["not_found"].tags.push(t);a=true}else if(o.includes("Weak relevance")||o.includes("low occurrences")){if(!a){e["weak_relevance"].tags.push(t);a=true}}else if(o.includes("Similar or duplicate")||o.includes("duplicate")){if(!a){e["duplicate"].tags.push(t);a=true}}else if(o.includes("too short")||o.includes("too long")||o.includes("too many words")||o.includes("special characters")||o.includes("All caps")){if(!a){e["format"].tags.push(t);a=true}}}))}if(!a){e["good"].tags.push(t)}}));return a("div",{className:"epkb-tags-issues-list"},Object.entries(e).map((([e,o])=>{if(o.tags.length===0)return null;return a("div",{key:e,className:"epkb-issue-group",style:{marginBottom:"25px",padding:"20px",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}},a("h4",{style:{fontSize:"15px",fontWeight:"600",marginBottom:"10px",color:"#1e293b",margin:"0 0 10px 0"}},o.title+` (${o.tags.length} ${o.tags.length===1?"tag":"tags"})`),o.description&&a("p",{style:{fontSize:"13px",color:"#666",marginBottom:"15px",lineHeight:"1.5"}},o.description),a("div",{className:"epkb-issue-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"10px"}},o.tags.map((e=>a("div",{key:e.id,className:"epkb-issue-tag-item",style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"6px 12px",backgroundColor:"#f5f5f5",borderRadius:"4px",border:"1px solid #ddd",fontSize:"13px"}},a("span",{style:{fontWeight:"500",color:"#1e293b"}},e.name),o.actions.length>0&&a("div",{style:{display:"flex",gap:"4px",marginLeft:"16px",flexWrap:"wrap"}},o.actions.includes("edit_article")&&a("button",{onClick:()=>{window.open(s.edit_link||`/wp-admin/post.php?post=${s.id}&action=edit`,"_blank")},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#0073aa",color:"#fff",border:"none",borderRadius:"3px",title:i("Edit article to add content about this tag","echo-knowledge-base")}},i("Edit Article","echo-knowledge-base")),o.actions.includes("add_content")&&a("button",{onClick:()=>{const o=`Add a section about "${e.name}" to make this tag more relevant.`;if(confirm(i(`Suggestion: ${o}\n\nOpen article editor now?`,"echo-knowledge-base"))){window.open(s.edit_link||`/wp-admin/post.php?post=${s.id}&action=edit`,"_blank")}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#7c3aed",color:"#fff",border:"none",borderRadius:"3px"}},i("Add Content","echo-knowledge-base")),o.actions.includes("enhance_content")&&a("button",{onClick:()=>{const o=`Enhance content about "${e.name}" to improve tag relevance.`;if(confirm(i(`Suggestion: ${o}\n\nOpen article editor now?`,"echo-knowledge-base"))){window.open(s.edit_link||`/wp-admin/post.php?post=${s.id}&action=edit`,"_blank")}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#16a34a",color:"#fff",border:"none",borderRadius:"3px"}},i("Enhance","echo-knowledge-base")),o.actions.includes("merge")&&a("button",{onClick:()=>{const t=o.tags.filter((o=>o.id!==e.id));if(t.length>0){const o=t.map((e=>e.name)).join(", ");const a=prompt(i(`Merge with similar tags (${o})?\nEnter the tag name to keep:`,"echo-knowledge-base"),e.name);if(a){alert(i("Merge functionality will be implemented soon.","echo-knowledge-base"))}}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#eab308",color:"#fff",border:"none",borderRadius:"3px"}},i("Merge","echo-knowledge-base")),o.actions.includes("fix_format")&&a("button",{onClick:()=>{let o=e.name;if(o.length>4&&o===o.toUpperCase()){o=o.charAt(0).toUpperCase()+o.slice(1).toLowerCase()}o=o.replace(/[^a-zA-Z0-9\s-]/g,"");if(o.length>30){o=o.substring(0,30).trim()}const t=prompt(i("Auto-fixed tag name:","echo-knowledge-base"),o);if(t&&t!==e.name){k(e.id,t)}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#6366f1",color:"#fff",border:"none",borderRadius:"3px"}},i("Fix Format","echo-knowledge-base")),o.actions.includes("edit")&&a("button",{onClick:()=>{const o=prompt(i("Edit tag name:","echo-knowledge-base"),e.name);if(o&&o!==e.name){k(e.id,o)}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#2271b1",color:"#fff",border:"none",borderRadius:"3px"}},i("Edit Tag","echo-knowledge-base")),o.actions.includes("remove")&&a("button",{onClick:()=>{if(confirm(i("Are you sure you want to remove this tag?","echo-knowledge-base"))){x(e.id)}},style:{padding:"2px 6px",fontSize:"11px",cursor:"pointer",backgroundColor:"#dc3545",color:"#fff",border:"none",borderRadius:"3px"}},i("Remove","echo-knowledge-base"))))))),e==="not_found"&&o.tags.length>1&&a("div",{style:{marginTop:"15px",display:"flex",gap:"8px",flexWrap:"wrap"}},a("button",{className:"button",onClick:()=>{const e=o.tags.map((e=>e.name)).join(", ");if(confirm(`Open article editor to add content for these ${o.tags.length} tags?\n\nTags: ${e}`)){window.open(s.edit_link||`/wp-admin/post.php?post=${s.id}&action=edit`,"_blank")}},style:{backgroundColor:"#0073aa",color:"#fff",border:"none",fontSize:"12px",padding:"4px 12px"}},i("Edit Article to Add Missing Content","echo-knowledge-base"))))})))})():a("p",{style:{color:"#666",marginBottom:"45px"}},i("No tags assigned to this article.","echo-knowledge-base")),c.suggested_tags&&c.suggested_tags.length>0&&a("div",{className:"epkb-suggested-tags-section",style:{marginBottom:"25px",padding:"20px",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}},a("h4",{style:{fontSize:"15px",fontWeight:"600",margin:"0 0 10px 0",color:"#1e293b"}},i("AI Suggested Tags","echo-knowledge-base")),a("p",{style:{color:"#666",marginBottom:"15px"}},i("Based on content analysis, these tags might improve discoverability:","echo-knowledge-base")),a("div",{className:"epkb-suggested-tags-list",style:{display:"flex",flexWrap:"wrap",gap:"10px"}},c.suggested_tags.map(((e,o)=>a("div",{key:o,className:"epkb-suggested-tag-item",style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"5px 10px",backgroundColor:"#e7f5ff",borderRadius:"4px",border:"1px solid #0073aa"}},a("span",{className:"suggested-tag-name"},e),a("button",{className:"epkb-tag-add",onClick:()=>m(e),style:{padding:"2px 8px",fontSize:"12px",cursor:"pointer",backgroundColor:"#28a745",color:"#fff",border:"none",borderRadius:"2px"}},i("Add","echo-knowledge-base"))))))),a("div",{className:"epkb-add-tag-section",style:{padding:"20px",backgroundColor:"#ffffff",border:"1px solid #e5e7eb",borderRadius:"6px",boxShadow:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"}},a("h4",{style:{fontSize:"15px",fontWeight:"600",margin:"0 0 15px 0",color:"#1e293b"}},i("Add New Tag","echo-knowledge-base")),a("div",{className:"epkb-add-tag-form",style:{display:"flex",gap:"10px",alignItems:"center"}},a("input",{type:"text",className:"epkb-new-tag-input",placeholder:i("Enter tag name","echo-knowledge-base"),style:{padding:"6px 10px",border:"1px solid #ddd",borderRadius:"4px",flex:"1",maxWidth:"300px"},onKeyDown:e=>{if(e.key==="Enter"){const o=e.target;if(o.value.trim()){m(o.value.trim());o.value=""}}}}),a("button",{className:"button button-primary",onClick:()=>{const e=document.querySelector(".epkb-new-tag-input");if(e&&e.value.trim()){m(e.value.trim());e.value=""}}},i("Add Tag","echo-knowledge-base"))))))),a("div",{className:"epkb-ai-details-actions",style:{marginTop:"30px",padding:"20px",backgroundColor:"#f8f9fa",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center"}},a("div",{style:{display:"flex",gap:"10px"}},a("button",{className:"button button-primary",onClick:()=>window.open(s.edit_link||`/wp-admin/post.php?post=${s.id}&action=edit`,"_blank")},i("Edit Article","echo-knowledge-base")),a("button",{className:"button",onClick:async()=>{try{const e=await l("content-analysis-analyze",{method:"POST",data:{article_ids:[s.id],kb_id:1}});if(e&&e.success){r(i("Analysis started successfully","echo-knowledge-base"));localStorage.removeItem(`epkb_analysis_details_${s.id}`);setTimeout((()=>{window.location.reload()}),2e3)}}catch(e){d(i("Failed to start analysis","echo-knowledge-base"))}}},i("Re-analyze Article","echo-knowledge-base"))),a("a",{href:s.view_link||`/?p=${s.id}`,target:"_blank",className:"button",style:{textDecoration:"none"}},i("View Article","echo-knowledge-base")))))};window.EPKB_AI_ContentAnalysisDetails=s})();