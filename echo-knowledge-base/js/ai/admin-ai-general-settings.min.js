!function(){"use strict";const{useState:e,useEffect:a,createElement:i}=wp.element,{__:t}=wp.i18n,{showError:s,showSuccess:l,makeApiRequest:n}=window.EPKB_AI_Util_React||{},c=({settings:e,sections:a,onChange:n,onSave:c,isSaving:o})=>i("form",{className:"epkb-ai-settings-container",onSubmit:e=>{e.preventDefault(),c&&c()}},Object.entries(a).map(([a,c])=>i("div",{key:a,className:`epkb-ai-settings-section epkb-ai-settings-section--${a}`},i("div",{className:"epkb-ai-settings-section-header"},c.icon&&i("i",{className:c.icon}),i("div",{className:"epkb-ai-header-text"},i("h3",null,c.title))),i("div",{className:"epkb-ai-settings-section-content"},Object.entries(c.fields).map(([c,o])=>((a,c,o)=>{const p=e.hasOwnProperty(a)?e[a]:c.value||"",d=`epkb-ai-${o}-${a}`;if(!(a=>!a.dependency||e[a.dependency.field]===a.dependency.value)(c))return null;switch(c.type){case"toggle":return i("div",{className:"epkb-ai-field epkb-ai-field-toggle",key:a},i("label",{className:"epkb-ai-toggle-label",htmlFor:d},i("input",{id:d,type:"checkbox",checked:"on"===p,onChange:e=>n(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-toggle-text"},c.label)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"password":return i("div",{className:"epkb-ai-field epkb-ai-field-password",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("input",{id:d,type:"password",className:"epkb-ai-input",value:p||"",placeholder:c.placeholder||"",onChange:e=>n(a,e.target.value),required:c.required,autoComplete:"off"}),c.description&&i("p",{className:"epkb-ai-field-description",dangerouslySetInnerHTML:{__html:c.description}}));case"text":return i("div",{className:"epkb-ai-field epkb-ai-field-text",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("input",{id:d,type:"text",className:"epkb-ai-input",value:p||"",placeholder:c.placeholder||"",onChange:e=>n(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"select":return i("div",{className:"epkb-ai-field epkb-ai-field-select",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("select",{id:d,className:"epkb-ai-select",value:p,onChange:e=>n(a,e.target.value)},Object.entries(c.options||{}).map(([e,a])=>i("option",{key:e,value:e},a))),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"number":return i("div",{className:"epkb-ai-field epkb-ai-field-number",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("div",{className:"epkb-ai-input-group"},i("input",{id:d,type:"number",className:"epkb-ai-input",value:p||"",min:c.min,max:c.max,step:c.step||1,onChange:e=>n(a,parseInt(e.target.value)||0)}),c.suffix&&i("span",{className:"epkb-ai-input-suffix"},c.suffix)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"textarea":return i("div",{className:"epkb-ai-field epkb-ai-field-textarea",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("textarea",{id:d,className:"epkb-ai-textarea",value:p||"",rows:c.rows||3,placeholder:c.placeholder||"",onChange:e=>n(a,e.target.value)}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"checkboxes":const e="object"==typeof p?p:{};return i("div",{className:"epkb-ai-field epkb-ai-field-checkboxes",key:a},i("label",{className:"epkb-ai-field-label"},c.label),i("div",{className:"epkb-ai-checkboxes-group"},Object.entries(c.options||{}).map(([t,s])=>i("label",{key:t,className:"epkb-ai-checkbox-label"},i("input",{type:"checkbox",checked:"on"===e[t],onChange:i=>{const s={...e};s[t]=i.target.checked?"on":"off",n(a,s)}}),i("span",{className:"epkb-ai-checkbox-text"},s)))),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"email":return i("div",{className:"epkb-ai-field epkb-ai-field-email",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("input",{id:d,type:"email",className:"epkb-ai-input",value:p||"",placeholder:c.placeholder||"",onChange:e=>n(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"time":return i("div",{className:"epkb-ai-field epkb-ai-field-time",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:d},c.label),i("input",{id:d,type:"time",className:"epkb-ai-input",value:p||"",placeholder:c.placeholder||"",onChange:e=>n(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"button":return i("div",{className:"epkb-ai-field epkb-ai-field-button",key:a},c.label&&i("label",{className:"epkb-ai-field-label"},c.label),i("button",{type:"button",className:`epkb-ai-button ${c.button_class||""}`,onClick:async()=>{if("epkb-ai-test-email-btn"===c.button_class){const e=event.target;e.disabled=!0,e.textContent=t("Sending...","echo-knowledge-base");try{const{apiFetch:e}=wp,a="undefined"!=typeof wpApiSettings&&wpApiSettings.nonce||jQuery("#_wpnonce_epkb_ajax_action").val()||jQuery('input[name="_wpnonce_epkb_ajax_action"]').val()||jQuery('meta[name="wp-api-nonce"]').attr("content"),i=await e({path:"/aipro-admin/v1/email/test",method:"POST",headers:{"X-WP-Nonce":a||"","Content-Type":"application/json"}});if(i&&"success"===i.status)l(i.message||t("Test email sent successfully","echo-knowledge-base"));else if(i){const e=i.message||t("Failed to send test email","echo-knowledge-base");s(e)}else s(t("Failed to send test email","echo-knowledge-base"))}catch(e){console.error("Test email error:",e);let a=t("Failed to send test email. Please check your connection.","echo-knowledge-base");e.message?a=e.message:e.responseJSON&&e.responseJSON.message&&(a=e.responseJSON.message),s(a)}finally{e.disabled=!1,e.textContent=c.button_text}}}},c.button_text),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"checkbox":return"ai_disclaimer_accepted"===a&&c.description?i("div",{className:"epkb-ai-field epkb-ai-field-disclaimer",key:a,ref:e=>{if(e&&!e._initialized){e._initialized=!0;const i=e=>{"checkbox"===e.target.type&&"ai_disclaimer_accepted"===e.target.name&&n(a,e.target.checked?"on":"off")};e._changeHandler&&e.removeEventListener("change",e._changeHandler),e.addEventListener("change",i),e._changeHandler=i,setTimeout(()=>{const i=e.querySelector('input[name="ai_disclaimer_accepted"]');i&&(i.checked="on"===p,(i.checked&&"on"!==p||!i.checked&&"on"===p)&&n(a,i.checked?"on":"off"))},0)}}},i("div",{className:"epkb-ai-field-html-content",dangerouslySetInnerHTML:{__html:c.description}})):i("div",{className:"epkb-ai-field epkb-ai-field-checkbox",key:a},i("label",{className:"epkb-ai-checkbox-label",htmlFor:d},i("input",{id:d,type:"checkbox",checked:"on"===p,onChange:e=>n(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-checkbox-text"},c.label)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));default:return null}})(c,o,a))))),i("div",{className:"epkb-ai-settings-footer"},i("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:c,disabled:o},t(o?"Saving...":"Save Settings","echo-knowledge-base"))));window.EPKB_AI_GeneralSettings=window.EPKB_AI_GeneralSettings||{},window.EPKB_AI_GeneralSettings.AIAdminGeneralSettings=({settings:o,tabData:p,isLoading:d,onDataChange:r,onTabSwitch:b})=>{const[m,k]=e(!1),[u,f]=e({});a(()=>{if(p&&p.ai_config){const e={...p.ai_config,ai_disclaimer_accepted:p.ai_config.ai_disclaimer_accepted||"off"};f(e)}},[p]);return i("div",{className:"epkb-ai-general-settings-container"},i("div",{className:"epkb-ai-general-settings-content"},i(c,{settings:u,sections:p?.settings_sections||{},onChange:(e,a)=>{f(i=>({...i,[e]:a}))},onSave:async()=>{k(!0);try{if((await n("ai/settings",{method:"POST",data:{settings:u}})).success){l(t("Settings saved successfully","echo-knowledge-base")),r({ai_config:u});const e=p?.ai_config||{},a=(e.ai_key||"")!==(u.ai_key||""),i=(e.ai_disclaimer_accepted||"off")!==(u.ai_disclaimer_accepted||"off");(a||i)&&setTimeout(()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","general-settings"),window.location.href=e.toString()},1e3)}}catch(e){s(e.message||t("Failed to save settings","echo-knowledge-base"))}finally{k(!1)}},isSaving:m})))}}();