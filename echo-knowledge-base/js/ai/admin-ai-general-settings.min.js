(function(){"use strict";const{useState:e,useEffect:a,createElement:i}=wp.element;const{__:t}=wp.i18n;const{showError:s,showSuccess:n,makeApiRequest:l,SetupStepsGuide:c}=window.EPKB_AI_Util_React||{};const o=({settings:e,sections:a,onChange:l,onSave:c,isSaving:o})=>{const d=(a,c,o)=>{const d=e.hasOwnProperty(a)?e[a]:c.value||"";const r=`epkb-ai-${o}-${a}`;const p=a=>{if(!a.dependency)return true;const i=e[a.dependency.field];return i===a.dependency.value};if(!p(c)){return null}switch(c.type){case"toggle":return i("div",{className:"epkb-ai-field epkb-ai-field-toggle",key:a},i("label",{className:"epkb-ai-toggle-label",htmlFor:r},i("input",{id:r,type:"checkbox",checked:d==="on",onChange:e=>l(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-toggle-text"},c.label)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"password":return i("div",{className:"epkb-ai-field epkb-ai-field-password",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("input",{id:r,type:"password",className:"epkb-ai-input",value:d||"",placeholder:c.placeholder||"",onChange:e=>l(a,e.target.value),required:c.required,autoComplete:"off"}),c.description&&i("p",{className:"epkb-ai-field-description",dangerouslySetInnerHTML:{__html:c.description}}));case"text":return i("div",{className:"epkb-ai-field epkb-ai-field-text",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("input",{id:r,type:"text",className:"epkb-ai-input",value:d||"",placeholder:c.placeholder||"",onChange:e=>l(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"select":return i("div",{className:"epkb-ai-field epkb-ai-field-select",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("select",{id:r,className:"epkb-ai-select",value:d,onChange:e=>l(a,e.target.value)},Object.entries(c.options||{}).map((([e,a])=>i("option",{key:e,value:e},a)))),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"number":return i("div",{className:"epkb-ai-field epkb-ai-field-number",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("div",{className:"epkb-ai-input-group"},i("input",{id:r,type:"number",className:"epkb-ai-input",value:d||"",min:c.min,max:c.max,step:c.step||1,onChange:e=>l(a,parseInt(e.target.value)||0)}),c.suffix&&i("span",{className:"epkb-ai-input-suffix"},c.suffix)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"textarea":return i("div",{className:"epkb-ai-field epkb-ai-field-textarea",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("textarea",{id:r,className:"epkb-ai-textarea",value:d||"",rows:c.rows||3,placeholder:c.placeholder||"",onChange:e=>l(a,e.target.value)}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"checkboxes":const e=typeof d==="object"?d:{};return i("div",{className:"epkb-ai-field epkb-ai-field-checkboxes",key:a},i("label",{className:"epkb-ai-field-label"},c.label),i("div",{className:"epkb-ai-checkboxes-group"},Object.entries(c.options||{}).map((([t,s])=>i("label",{key:t,className:"epkb-ai-checkbox-label"},i("input",{type:"checkbox",checked:e[t]==="on",onChange:i=>{const s={...e};s[t]=i.target.checked?"on":"off";l(a,s)}}),i("span",{className:"epkb-ai-checkbox-text"},s))))),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"email":return i("div",{className:"epkb-ai-field epkb-ai-field-email",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("input",{id:r,type:"email",className:"epkb-ai-input",value:d||"",placeholder:c.placeholder||"",onChange:e=>l(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"time":return i("div",{className:"epkb-ai-field epkb-ai-field-time",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:r},c.label),i("input",{id:r,type:"time",className:"epkb-ai-input",value:d||"",placeholder:c.placeholder||"",onChange:e=>l(a,e.target.value),required:c.required}),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"button":return i("div",{className:"epkb-ai-field epkb-ai-field-button",key:a},c.label&&i("label",{className:"epkb-ai-field-label"},c.label),i("button",{type:"button",className:`epkb-ai-button ${c.button_class||""}`,onClick:async()=>{if(c.button_class==="epkb-ai-test-email-btn"){const e=event.target;e.disabled=true;e.textContent=t("Sending...","echo-knowledge-base");try{const{apiFetch:e}=wp;const a=typeof wpApiSettings!=="undefined"&&wpApiSettings.nonce||jQuery("#_wpnonce_epkb_ajax_action").val()||jQuery('input[name="_wpnonce_epkb_ajax_action"]').val()||jQuery('meta[name="wp-api-nonce"]').attr("content");const i=await e({path:"/aipro-admin/v1/email/test",method:"POST",headers:{"X-WP-Nonce":a||"","Content-Type":"application/json"}});if(i&&i.status==="success"){n(i.message||t("Test email sent successfully","echo-knowledge-base"))}else if(i){const e=i.message||t("Failed to send test email","echo-knowledge-base");s(e)}else{s(t("Failed to send test email","echo-knowledge-base"))}}catch(e){console.error("Test email error:",e);let a=t("Failed to send test email. Please check your connection.","echo-knowledge-base");if(e.message){a=e.message}else if(e.responseJSON&&e.responseJSON.message){a=e.responseJSON.message}s(a)}finally{e.disabled=false;e.textContent=c.button_text}}}},c.button_text),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));case"checkbox":if(a==="ai_disclaimer_accepted"&&c.description){return i("div",{className:"epkb-ai-field epkb-ai-field-disclaimer",key:a,ref:e=>{if(e&&!e._initialized){e._initialized=true;const i=e=>{if(e.target.type==="checkbox"&&e.target.name==="ai_disclaimer_accepted"){l(a,e.target.checked?"on":"off")}};if(e._changeHandler){e.removeEventListener("change",e._changeHandler)}e.addEventListener("change",i);e._changeHandler=i;setTimeout((()=>{const i=e.querySelector('input[name="ai_disclaimer_accepted"]');if(i){i.checked=d==="on";if(i.checked&&d!=="on"||!i.checked&&d==="on"){l(a,i.checked?"on":"off")}}}),0)}}},i("div",{className:"epkb-ai-field-html-content",dangerouslySetInnerHTML:{__html:c.description}}))}return i("div",{className:"epkb-ai-field epkb-ai-field-checkbox",key:a},i("label",{className:"epkb-ai-checkbox-label",htmlFor:r},i("input",{id:r,type:"checkbox",checked:d==="on",onChange:e=>l(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-checkbox-text"},c.label)),c.description&&i("p",{className:"epkb-ai-field-description"},c.description));default:return null}};return i("form",{className:"epkb-ai-settings-container",onSubmit:e=>{e.preventDefault();if(c)c()}},i("div",{className:"epkb-ai-settings-header"},i("button",{type:"button",className:"epkb-ai-button epkb-ai-button-primary",onClick:c,disabled:o},o?t("Saving...","echo-knowledge-base"):t("Save Settings","echo-knowledge-base"))),i("div",{className:"epkb-ai-settings-sections-wrapper"},Object.entries(a).map((([e,a])=>i("div",{key:e,className:`epkb-ai-settings-section epkb-ai-settings-section--${e}`},i("div",{className:"epkb-ai-settings-section-header"},a.icon&&i("i",{className:a.icon}),i("div",{className:"epkb-ai-header-text"},i("h3",null,a.title))),i("div",{className:"epkb-ai-settings-section-content"},Object.entries(a.fields).map((([a,i])=>d(a,i,e)))))))),i("div",{className:"epkb-ai-settings-footer"},i("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:c,disabled:o},o?t("Saving...","echo-knowledge-base"):t("Save Settings","echo-knowledge-base"))))};const d=({settings:d,tabData:r,isLoading:p,onDataChange:b,onTabSwitch:k})=>{const[m,u]=e(false);const[g,f]=e({});const[h,v]=e(false);const[N,_]=e(null);a((()=>{if(r&&r.ai_config){const e={...r.ai_config,ai_disclaimer_accepted:r.ai_config.ai_disclaimer_accepted||"off"};f(e)}}),[r]);const w=(e,a)=>{if(e==="ai_provider"&&a!==g.ai_provider){_(a);v(true);return}f((i=>({...i,[e]:a})))};const y=()=>{f((e=>({...e,ai_provider:N})));v(false);_(null)};const S=()=>{v(false);_(null)};const x=async()=>{u(true);try{const e=await l("ai/settings",{method:"POST",data:{settings:g}});if(e.success){n(t("Settings saved successfully","echo-knowledge-base"));b({ai_config:g});const e=r?.ai_config||{};const a=(e.ai_provider||"")!==(g.ai_provider||"");const i=(e.ai_chatgpt_key||"")!==(g.ai_chatgpt_key||"");const s=(e.ai_gemini_key||"")!==(g.ai_gemini_key||"");const l=(e.ai_disclaimer_accepted||"off")!==(g.ai_disclaimer_accepted||"off");if(a||i||s||l){setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","general-settings");window.location.href=e.toString()}),1e3)}}}catch(e){s(e.message||t("Failed to save settings","echo-knowledge-base"))}finally{u(false)}};const C=h&&i("div",{className:"epkb-ai-dialog-overlay"},i("div",{className:"epkb-ai-dialog"},i("div",{className:"epkb-ai-dialog-header"},i("h3",null,t("Change AI Provider?","echo-knowledge-base")),i("button",{className:"epkb-ai-dialog-close",onClick:S,"aria-label":t("Close","echo-knowledge-base")},"Ã—")),i("div",{className:"epkb-ai-dialog-content"},i("p",null,t("Switching AI providers will affect your AI Search and AI Chat settings:","echo-knowledge-base")),i("ul",null,i("li",null,t("Training Data Collections are provider-specific and do not transfer between providers.","echo-knowledge-base")),i("li",null,t("You will need to create and train new collections for the new provider.","echo-knowledge-base")),i("li",null,t("AI Search and AI Chat will only show collections for the selected provider.","echo-knowledge-base")),i("li",null,t("Your existing collections will be preserved and available if you switch back.","echo-knowledge-base")))),i("div",{className:"epkb-ai-dialog-actions"},i("button",{className:"epkb-ai-button epkb-ai-button-secondary",onClick:S},t("Cancel","echo-knowledge-base")),i("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:y},t("Change Provider","echo-knowledge-base")))));return i("div",{className:"epkb-ai-general-settings-container"},C,c&&i(c,{setupSteps:r?.setup_steps,onTabSwitch:k}),i("div",{className:"epkb-ai-general-settings-content"},i(o,{settings:g,sections:r?.settings_sections||{},onChange:w,onSave:x,isSaving:m})))};window.EPKB_AI_GeneralSettings=window.EPKB_AI_GeneralSettings||{};window.EPKB_AI_GeneralSettings.AIAdminGeneralSettings=d})();