(function(){"use strict";const{useState:e,useEffect:a,createElement:i}=wp.element;const{__:t}=wp.i18n;const{showError:s,showSuccess:n,makeApiRequest:c}=window.EPKB_AI_Util_React||{};const l=({settings:e,sections:a,onChange:s,onSave:n,isSaving:c})=>{const l=(a,t,n)=>{const c=e.hasOwnProperty(a)?e[a]:t.value||"";const l=`epkb-ai-${n}-${a}`;const o=a=>{if(!a.dependency)return true;const i=e[a.dependency.field];return i===a.dependency.value};if(!o(t)){return null}switch(t.type){case"toggle":return i("div",{className:"epkb-ai-field epkb-ai-field-toggle",key:a},i("label",{className:"epkb-ai-toggle-label",htmlFor:l},i("input",{id:l,type:"checkbox",checked:c==="on",onChange:e=>s(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-toggle-text"},t.label)),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"password":return i("div",{className:"epkb-ai-field epkb-ai-field-password",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:l},t.label),i("input",{id:l,type:"password",className:"epkb-ai-input",value:c||"",placeholder:t.placeholder||"",onChange:e=>s(a,e.target.value),required:t.required,autoComplete:"off"}),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"text":return i("div",{className:"epkb-ai-field epkb-ai-field-text",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:l},t.label),i("input",{id:l,type:"text",className:"epkb-ai-input",value:c||"",placeholder:t.placeholder||"",onChange:e=>s(a,e.target.value),required:t.required}),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"select":return i("div",{className:"epkb-ai-field epkb-ai-field-select",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:l},t.label),i("select",{id:l,className:"epkb-ai-select",value:c,onChange:e=>s(a,e.target.value)},Object.entries(t.options||{}).map((([e,a])=>i("option",{key:e,value:e},a)))),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"number":return i("div",{className:"epkb-ai-field epkb-ai-field-number",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:l},t.label),i("div",{className:"epkb-ai-input-group"},i("input",{id:l,type:"number",className:"epkb-ai-input",value:c||"",min:t.min,max:t.max,step:t.step||1,onChange:e=>s(a,parseInt(e.target.value)||0)}),t.suffix&&i("span",{className:"epkb-ai-input-suffix"},t.suffix)),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"textarea":return i("div",{className:"epkb-ai-field epkb-ai-field-textarea",key:a},i("label",{className:"epkb-ai-field-label",htmlFor:l},t.label),i("textarea",{id:l,className:"epkb-ai-textarea",value:c||"",rows:t.rows||3,placeholder:t.placeholder||"",onChange:e=>s(a,e.target.value)}),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"checkboxes":const e=typeof c==="object"?c:{};return i("div",{className:"epkb-ai-field epkb-ai-field-checkboxes",key:a},i("label",{className:"epkb-ai-field-label"},t.label),i("div",{className:"epkb-ai-checkboxes-group"},Object.entries(t.options||{}).map((([t,n])=>i("label",{key:t,className:"epkb-ai-checkbox-label"},i("input",{type:"checkbox",checked:e[t]==="on",onChange:i=>{const n={...e};n[t]=i.target.checked?"on":"off";s(a,n)}}),i("span",{className:"epkb-ai-checkbox-text"},n))))),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));case"checkbox":if(a==="ai_disclaimer_accepted"&&t.description){return i("div",{className:"epkb-ai-field epkb-ai-field-disclaimer",key:a,ref:e=>{if(e&&!e._initialized){e._initialized=true;const i=e=>{if(e.target.type==="checkbox"&&e.target.name==="ai_disclaimer_accepted"){s(a,e.target.checked?"on":"off")}};if(e._changeHandler){e.removeEventListener("change",e._changeHandler)}e.addEventListener("change",i);e._changeHandler=i;setTimeout((()=>{const i=e.querySelector('input[name="ai_disclaimer_accepted"]');if(i){i.checked=c==="on";if(i.checked&&c!=="on"||!i.checked&&c==="on"){s(a,i.checked?"on":"off")}}}),0)}}},i("div",{className:"epkb-ai-field-html-content",dangerouslySetInnerHTML:{__html:t.description}}))}return i("div",{className:"epkb-ai-field epkb-ai-field-checkbox",key:a},i("label",{className:"epkb-ai-checkbox-label",htmlFor:l},i("input",{id:l,type:"checkbox",checked:c==="on",onChange:e=>s(a,e.target.checked?"on":"off")}),i("span",{className:"epkb-ai-checkbox-text"},t.label)),t.description&&i("p",{className:"epkb-ai-field-description"},t.description));default:return null}};return i("form",{className:"epkb-ai-settings-container",onSubmit:e=>{e.preventDefault();if(n)n()}},Object.entries(a).map((([e,a])=>i("div",{key:e,className:`epkb-ai-settings-section epkb-ai-settings-section--${e}`},i("div",{className:"epkb-ai-settings-section-header"},a.icon&&i("i",{className:a.icon}),i("div",{className:"epkb-ai-header-text"},i("h3",null,a.title))),i("div",{className:"epkb-ai-settings-section-content"},Object.entries(a.fields).map((([a,i])=>l(a,i,e))))))),i("div",{className:"epkb-ai-settings-footer"},i("button",{className:"epkb-ai-button epkb-ai-button-primary",onClick:n,disabled:c},c?t("Saving...","echo-knowledge-base"):t("Save Settings","echo-knowledge-base"))))};const o=({settings:o,tabData:d,isLoading:r,onDataChange:p,onTabSwitch:b})=>{const[k,m]=e(false);const[f,g]=e({});a((()=>{if(d&&d.ai_config){const e={...d.ai_config,ai_disclaimer_accepted:d.ai_config.ai_disclaimer_accepted||"off"};g(e)}}),[d]);const u=(e,a)=>{g((i=>({...i,[e]:a})))};const h=async()=>{m(true);try{const e=await c("ai/settings",{method:"POST",data:{settings:f}});if(e.success){n(t("Settings saved successfully","echo-knowledge-base"));p({ai_config:f});const e=f.ai_key&&f.ai_key.length>0;const a=f.ai_disclaimer_accepted==="on";const i=d?.ai_config||{};const s=i.ai_disclaimer_accepted==="on";const c=i.ai_key&&i.ai_key.length>0;const l=!s&&a||!c&&e;const o=f.ai_chat_enabled==="on";const r=f.ai_search_enabled==="on";setTimeout((()=>{const e=new URL(window.location.href);e.searchParams.set("active_tab","general-settings");window.location.href=e.toString()}),1e3)}}catch(e){s(e.message||t("Failed to save settings","echo-knowledge-base"))}finally{m(false)}};return i("div",{className:"epkb-ai-general-settings-container"},i("div",{className:"epkb-ai-general-settings-content"},i(l,{settings:f,sections:d?.settings_sections||{},onChange:u,onSave:h,isSaving:k})))};window.EPKB_AI_GeneralSettings=window.EPKB_AI_GeneralSettings||{};window.EPKB_AI_GeneralSettings.AIAdminGeneralSettings=o})();